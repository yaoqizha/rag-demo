const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AboutView-CUqCdqnX.js","assets/AboutView-C6Dx7pxG.css"])))=>i.map(i=>d[i]);
var $p=Object.defineProperty;var Lp=(n,e,t)=>e in n?$p(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var wn=(n,e,t)=>Lp(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.4.34
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Du(n,e){const t=new Set(n.split(","));return r=>t.has(r)}const ye={},Cr=[],pt=()=>{},Mp=()=>!1,Ua=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Uu=n=>n.startsWith("onUpdate:"),Be=Object.assign,Bu=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},Fp=Object.prototype.hasOwnProperty,se=(n,e)=>Fp.call(n,e),K=Array.isArray,Ir=n=>Ba(n)==="[object Map]",Hd=n=>Ba(n)==="[object Set]",X=n=>typeof n=="function",Te=n=>typeof n=="string",Un=n=>typeof n=="symbol",be=n=>n!==null&&typeof n=="object",Zd=n=>(be(n)||X(n))&&X(n.then)&&X(n.catch),Vd=Object.prototype.toString,Ba=n=>Vd.call(n),Dp=n=>Ba(n).slice(8,-1),qd=n=>Ba(n)==="[object Object]",zu=n=>Te(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,_s=Du(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),za=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},Up=/-(\w)/g,ir=za(n=>n.replace(Up,(e,t)=>t?t.toUpperCase():"")),Bp=/\B([A-Z])/g,fr=za(n=>n.replace(Bp,"-$1").toLowerCase()),Wd=za(n=>n.charAt(0).toUpperCase()+n.slice(1)),go=za(n=>n?`on${Wd(n)}`:""),$n=(n,e)=>!Object.is(n,e),Oi=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},Kd=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},Go=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Zc;const Jd=()=>Zc||(Zc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Hu(n){if(K(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=Te(r)?Vp(r):Hu(r);if(s)for(const i in s)e[i]=s[i]}return e}else if(Te(n)||be(n))return n}const zp=/;(?![^(]*\))/g,Hp=/:([^]+)/,Zp=/\/\*[^]*?\*\//g;function Vp(n){const e={};return n.replace(Zp,"").split(zp).forEach(t=>{if(t){const r=t.split(Hp);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Zu(n){let e="";if(Te(n))e=n;else if(K(n))for(let t=0;t<n.length;t++){const r=Zu(n[t]);r&&(e+=r+" ")}else if(be(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const qp="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Wp=Du(qp);function Gd(n){return!!n||n===""}const Xd=n=>!!(n&&n.__v_isRef===!0),Kn=n=>Te(n)?n:n==null?"":K(n)||be(n)&&(n.toString===Vd||!X(n.toString))?Xd(n)?Kn(n.value):JSON.stringify(n,Qd,2):String(n),Qd=(n,e)=>Xd(e)?Qd(n,e.value):Ir(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s],i)=>(t[_o(r,i)+" =>"]=s,t),{})}:Hd(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>_o(t))}:Un(e)?_o(e):be(e)&&!K(e)&&!qd(e)?String(e):e,_o=(n,e="")=>{var t;return Un(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.4.34
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ot;class Yd{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Ot,!e&&Ot&&(this.index=(Ot.scopes||(Ot.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const t=Ot;try{return Ot=this,e()}finally{Ot=t}}}on(){Ot=this}off(){Ot=this.parent}stop(e){if(this._active){let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.scopes)for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this._active=!1}}}function Kp(n){return new Yd(n)}function Jp(n,e=Ot){e&&e.active&&e.effects.push(n)}function Gp(){return Ot}let Yn;class Vu{constructor(e,t,r,s){this.fn=e,this.trigger=t,this.scheduler=r,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,Jp(this,s)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Bn();for(let e=0;e<this._depsLength;e++){const t=this.deps[e];if(t.computed&&(Xp(t.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),zn()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=Nn,t=Yn;try{return Nn=!0,Yn=this,this._runnings++,Vc(this),this.fn()}finally{qc(this),this._runnings--,Yn=t,Nn=e}}stop(){this.active&&(Vc(this),qc(this),this.onStop&&this.onStop(),this.active=!1)}}function Xp(n){return n.value}function Vc(n){n._trackId++,n._depsLength=0}function qc(n){if(n.deps.length>n._depsLength){for(let e=n._depsLength;e<n.deps.length;e++)eh(n.deps[e],n);n.deps.length=n._depsLength}}function eh(n,e){const t=n.get(e);t!==void 0&&e._trackId!==t&&(n.delete(e),n.size===0&&n.cleanup())}let Nn=!0,Xo=0;const th=[];function Bn(){th.push(Nn),Nn=!1}function zn(){const n=th.pop();Nn=n===void 0?!0:n}function qu(){Xo++}function Wu(){for(Xo--;!Xo&&Qo.length;)Qo.shift()()}function nh(n,e,t){if(e.get(n)!==n._trackId){e.set(n,n._trackId);const r=n.deps[n._depsLength];r!==e?(r&&eh(r,n),n.deps[n._depsLength++]=e):n._depsLength++}}const Qo=[];function rh(n,e,t){qu();for(const r of n.keys()){let s;r._dirtyLevel<e&&(s??(s=n.get(r)===r._trackId))&&(r._shouldSchedule||(r._shouldSchedule=r._dirtyLevel===0),r._dirtyLevel=e),r._shouldSchedule&&(s??(s=n.get(r)===r._trackId))&&(r.trigger(),(!r._runnings||r.allowRecurse)&&r._dirtyLevel!==2&&(r._shouldSchedule=!1,r.scheduler&&Qo.push(r.scheduler)))}Wu()}const sh=(n,e)=>{const t=new Map;return t.cleanup=n,t.computed=e,t},Yo=new WeakMap,er=Symbol(""),eu=Symbol("");function tt(n,e,t){if(Nn&&Yn){let r=Yo.get(n);r||Yo.set(n,r=new Map);let s=r.get(t);s||r.set(t,s=sh(()=>r.delete(t))),nh(Yn,s)}}function fn(n,e,t,r,s,i){const a=Yo.get(n);if(!a)return;let o=[];if(e==="clear")o=[...a.values()];else if(t==="length"&&K(n)){const u=Number(r);a.forEach((c,l)=>{(l==="length"||!Un(l)&&l>=u)&&o.push(c)})}else switch(t!==void 0&&o.push(a.get(t)),e){case"add":K(n)?zu(t)&&o.push(a.get("length")):(o.push(a.get(er)),Ir(n)&&o.push(a.get(eu)));break;case"delete":K(n)||(o.push(a.get(er)),Ir(n)&&o.push(a.get(eu)));break;case"set":Ir(n)&&o.push(a.get(er));break}qu();for(const u of o)u&&rh(u,4);Wu()}const Qp=Du("__proto__,__v_isRef,__isVue"),ih=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Un)),Wc=Yp();function Yp(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...t){const r=ue(this);for(let i=0,a=this.length;i<a;i++)tt(r,"get",i+"");const s=r[e](...t);return s===-1||s===!1?r[e](...t.map(ue)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...t){Bn(),qu();const r=ue(this)[e].apply(this,t);return Wu(),zn(),r}}),n}function em(n){Un(n)||(n=String(n));const e=ue(this);return tt(e,"has",n),e.hasOwnProperty(n)}class ah{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(s?i?fm:lh:i?ch:uh).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const a=K(e);if(!s){if(a&&se(Wc,t))return Reflect.get(Wc,t,r);if(t==="hasOwnProperty")return em}const o=Reflect.get(e,t,r);return(Un(t)?ih.has(t):Qp(t))||(s||tt(e,"get",t),i)?o:nt(o)?a&&zu(t)?o:o.value:be(o)?s?hh(o):Za(o):o}}class oh extends ah{constructor(e=!1){super(!1,e)}set(e,t,r,s){let i=e[t];if(!this._isShallow){const u=ar(i);if(!Fr(r)&&!ar(r)&&(i=ue(i),r=ue(r)),!K(e)&&nt(i)&&!nt(r))return u?!1:(i.value=r,!0)}const a=K(e)&&zu(t)?Number(t)<e.length:se(e,t),o=Reflect.set(e,t,r,s);return e===ue(s)&&(a?$n(r,i)&&fn(e,"set",t,r):fn(e,"add",t,r)),o}deleteProperty(e,t){const r=se(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&r&&fn(e,"delete",t,void 0),s}has(e,t){const r=Reflect.has(e,t);return(!Un(t)||!ih.has(t))&&tt(e,"has",t),r}ownKeys(e){return tt(e,"iterate",K(e)?"length":er),Reflect.ownKeys(e)}}class tm extends ah{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const nm=new oh,rm=new tm,sm=new oh(!0);const Ku=n=>n,Ha=n=>Reflect.getPrototypeOf(n);function li(n,e,t=!1,r=!1){n=n.__v_raw;const s=ue(n),i=ue(e);t||($n(e,i)&&tt(s,"get",e),tt(s,"get",i));const{has:a}=Ha(s),o=r?Ku:t?Xu:Cs;if(a.call(s,e))return o(n.get(e));if(a.call(s,i))return o(n.get(i));n!==s&&n.get(e)}function di(n,e=!1){const t=this.__v_raw,r=ue(t),s=ue(n);return e||($n(n,s)&&tt(r,"has",n),tt(r,"has",s)),n===s?t.has(n):t.has(n)||t.has(s)}function hi(n,e=!1){return n=n.__v_raw,!e&&tt(ue(n),"iterate",er),Reflect.get(n,"size",n)}function Kc(n,e=!1){!e&&!Fr(n)&&!ar(n)&&(n=ue(n));const t=ue(this);return Ha(t).has.call(t,n)||(t.add(n),fn(t,"add",n,n)),this}function Jc(n,e,t=!1){!t&&!Fr(e)&&!ar(e)&&(e=ue(e));const r=ue(this),{has:s,get:i}=Ha(r);let a=s.call(r,n);a||(n=ue(n),a=s.call(r,n));const o=i.call(r,n);return r.set(n,e),a?$n(e,o)&&fn(r,"set",n,e):fn(r,"add",n,e),this}function Gc(n){const e=ue(this),{has:t,get:r}=Ha(e);let s=t.call(e,n);s||(n=ue(n),s=t.call(e,n)),r&&r.call(e,n);const i=e.delete(n);return s&&fn(e,"delete",n,void 0),i}function Xc(){const n=ue(this),e=n.size!==0,t=n.clear();return e&&fn(n,"clear",void 0,void 0),t}function fi(n,e){return function(r,s){const i=this,a=i.__v_raw,o=ue(a),u=e?Ku:n?Xu:Cs;return!n&&tt(o,"iterate",er),a.forEach((c,l)=>r.call(s,u(c),u(l),i))}}function pi(n,e,t){return function(...r){const s=this.__v_raw,i=ue(s),a=Ir(i),o=n==="entries"||n===Symbol.iterator&&a,u=n==="keys"&&a,c=s[n](...r),l=t?Ku:e?Xu:Cs;return!e&&tt(i,"iterate",u?eu:er),{next(){const{value:d,done:h}=c.next();return h?{value:d,done:h}:{value:o?[l(d[0]),l(d[1])]:l(d),done:h}},[Symbol.iterator](){return this}}}}function vn(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function im(){const n={get(i){return li(this,i)},get size(){return hi(this)},has:di,add:Kc,set:Jc,delete:Gc,clear:Xc,forEach:fi(!1,!1)},e={get(i){return li(this,i,!1,!0)},get size(){return hi(this)},has:di,add(i){return Kc.call(this,i,!0)},set(i,a){return Jc.call(this,i,a,!0)},delete:Gc,clear:Xc,forEach:fi(!1,!0)},t={get(i){return li(this,i,!0)},get size(){return hi(this,!0)},has(i){return di.call(this,i,!0)},add:vn("add"),set:vn("set"),delete:vn("delete"),clear:vn("clear"),forEach:fi(!0,!1)},r={get(i){return li(this,i,!0,!0)},get size(){return hi(this,!0)},has(i){return di.call(this,i,!0)},add:vn("add"),set:vn("set"),delete:vn("delete"),clear:vn("clear"),forEach:fi(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(i=>{n[i]=pi(i,!1,!1),t[i]=pi(i,!0,!1),e[i]=pi(i,!1,!0),r[i]=pi(i,!0,!0)}),[n,t,e,r]}const[am,om,um,cm]=im();function Ju(n,e){const t=e?n?cm:um:n?om:am;return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(se(t,s)&&s in r?t:r,s,i)}const lm={get:Ju(!1,!1)},dm={get:Ju(!1,!0)},hm={get:Ju(!0,!1)};const uh=new WeakMap,ch=new WeakMap,lh=new WeakMap,fm=new WeakMap;function pm(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function mm(n){return n.__v_skip||!Object.isExtensible(n)?0:pm(Dp(n))}function Za(n){return ar(n)?n:Gu(n,!1,nm,lm,uh)}function dh(n){return Gu(n,!1,sm,dm,ch)}function hh(n){return Gu(n,!0,rm,hm,lh)}function Gu(n,e,t,r,s){if(!be(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=s.get(n);if(i)return i;const a=mm(n);if(a===0)return n;const o=new Proxy(n,a===2?r:t);return s.set(n,o),o}function ys(n){return ar(n)?ys(n.__v_raw):!!(n&&n.__v_isReactive)}function ar(n){return!!(n&&n.__v_isReadonly)}function Fr(n){return!!(n&&n.__v_isShallow)}function fh(n){return n?!!n.__v_raw:!1}function ue(n){const e=n&&n.__v_raw;return e?ue(e):n}function ph(n){return Object.isExtensible(n)&&Kd(n,"__v_skip",!0),n}const Cs=n=>be(n)?Za(n):n,Xu=n=>be(n)?hh(n):n;class mh{constructor(e,t,r,s){this.getter=e,this._setter=t,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Vu(()=>e(this._value),()=>Si(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=r}get value(){const e=ue(this);return(!e._cacheable||e.effect.dirty)&&$n(e._value,e._value=e.effect.run())&&Si(e,4),gh(e),e.effect._dirtyLevel>=2&&Si(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function gm(n,e,t=!1){let r,s;const i=X(n);return i?(r=n,s=pt):(r=n.get,s=n.set),new mh(r,s,i||!s,t)}function gh(n){var e;Nn&&Yn&&(n=ue(n),nh(Yn,(e=n.dep)!=null?e:n.dep=sh(()=>n.dep=void 0,n instanceof mh?n:void 0)))}function Si(n,e=4,t,r){n=ue(n);const s=n.dep;s&&rh(s,e)}function nt(n){return!!(n&&n.__v_isRef===!0)}function cn(n){return _h(n,!1)}function _m(n){return _h(n,!0)}function _h(n,e){return nt(n)?n:new ym(n,e)}class ym{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:ue(e),this._value=t?e:Cs(e)}get value(){return gh(this),this._value}set value(e){const t=this.__v_isShallow||Fr(e)||ar(e);e=t?e:ue(e),$n(e,this._rawValue)&&(this._rawValue,this._rawValue=e,this._value=t?e:Cs(e),Si(this,4))}}function tr(n){return nt(n)?n.value:n}const bm={get:(n,e,t)=>tr(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return nt(s)&&!nt(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function yh(n){return ys(n)?n:new Proxy(n,bm)}/**
* @vue/runtime-core v3.4.34
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function jn(n,e,t,r){try{return r?n(...r):n()}catch(s){Va(s,e,t)}}function It(n,e,t,r){if(X(n)){const s=jn(n,e,t,r);return s&&Zd(s)&&s.catch(i=>{Va(i,e,t)}),s}if(K(n)){const s=[];for(let i=0;i<n.length;i++)s.push(It(n[i],e,t,r));return s}}function Va(n,e,t,r=!0){const s=e?e.vnode:null;if(e){let i=e.parent;const a=e.proxy,o=`https://vuejs.org/error-reference/#runtime-${t}`;for(;i;){const c=i.ec;if(c){for(let l=0;l<c.length;l++)if(c[l](n,a,o)===!1)return}i=i.parent}const u=e.appContext.config.errorHandler;if(u){Bn(),jn(u,null,10,[n,a,o]),zn();return}}wm(n,t,s,r)}function wm(n,e,t,r=!0){console.error(n)}let Is=!1,tu=!1;const Ue=[];let Vt=0;const Rr=[];let On=null,Jn=0;const bh=Promise.resolve();let Qu=null;function wh(n){const e=Qu||bh;return n?e.then(this?n.bind(this):n):e}function vm(n){let e=Vt+1,t=Ue.length;for(;e<t;){const r=e+t>>>1,s=Ue[r],i=Rs(s);i<n||i===n&&s.pre?e=r+1:t=r}return e}function Yu(n){(!Ue.length||!Ue.includes(n,Is&&n.allowRecurse?Vt+1:Vt))&&(n.id==null?Ue.push(n):Ue.splice(vm(n.id),0,n),vh())}function vh(){!Is&&!tu&&(tu=!0,Qu=bh.then(Ah))}function Em(n){const e=Ue.indexOf(n);e>Vt&&Ue.splice(e,1)}function Am(n){K(n)?Rr.push(...n):(!On||!On.includes(n,n.allowRecurse?Jn+1:Jn))&&Rr.push(n),vh()}function Qc(n,e,t=Is?Vt+1:0){for(;t<Ue.length;t++){const r=Ue[t];if(r&&r.pre){if(n&&r.id!==n.uid)continue;Ue.splice(t,1),t--,r()}}}function Eh(n){if(Rr.length){const e=[...new Set(Rr)].sort((t,r)=>Rs(t)-Rs(r));if(Rr.length=0,On){On.push(...e);return}for(On=e,Jn=0;Jn<On.length;Jn++){const t=On[Jn];t.active!==!1&&t()}On=null,Jn=0}}const Rs=n=>n.id==null?1/0:n.id,xm=(n,e)=>{const t=Rs(n)-Rs(e);if(t===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return t};function Ah(n){tu=!1,Is=!0,Ue.sort(xm);try{for(Vt=0;Vt<Ue.length;Vt++){const e=Ue[Vt];e&&e.active!==!1&&jn(e,e.i,e.i?15:14)}}finally{Vt=0,Ue.length=0,Eh(),Is=!1,Qu=null,(Ue.length||Rr.length)&&Ah()}}let mt=null,qa=null;function Vi(n){const e=mt;return mt=n,qa=n&&n.type.__scopeId||null,e}function xh(n){qa=n}function Oh(){qa=null}function Om(n,e=mt,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&cl(-1);const i=Vi(e);let a;try{a=n(...s)}finally{Vi(i),r._d&&cl(1)}return a};return r._n=!0,r._c=!0,r._d=!0,r}function Sm(n,e){if(mt===null)return n;const t=Xa(mt),r=n.dirs||(n.dirs=[]);for(let s=0;s<e.length;s++){let[i,a,o,u=ye]=e[s];i&&(X(i)&&(i={mounted:i,updated:i}),i.deep&&Cn(a),r.push({dir:i,instance:t,value:a,oldValue:void 0,arg:o,modifiers:u}))}return n}function Vn(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let a=0;a<s.length;a++){const o=s[a];i&&(o.oldValue=i[a].value);let u=o.dir[r];u&&(Bn(),It(u,t,8,[n.el,o,n,e]),zn())}}function Sh(n,e){n.shapeFlag&6&&n.component?Sh(n.component.subTree,e):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}/*! #__NO_SIDE_EFFECTS__ */function Ph(n,e){return X(n)?Be({name:n.name},e,{setup:n}):n}const Pi=n=>!!n.type.__asyncLoader,Th=n=>n.type.__isKeepAlive;function Pm(n,e){kh(n,"a",e)}function Tm(n,e){kh(n,"da",e)}function kh(n,e,t=Ve){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Wa(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Th(s.parent.vnode)&&km(r,e,t,s),s=s.parent}}function km(n,e,t,r){const s=Wa(e,n,r,!0);Ih(()=>{Bu(r[e],s)},t)}function Wa(n,e,t=Ve,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...a)=>{Bn();const o=Ys(t),u=It(e,t,n,a);return o(),zn(),u});return r?s.unshift(i):s.push(i),i}}const _n=n=>(e,t=Ve)=>{(!Ga||n==="sp")&&Wa(n,(...r)=>e(...r),t)},Cm=_n("bm"),Ch=_n("m"),Im=_n("bu"),Rm=_n("u"),Nm=_n("bum"),Ih=_n("um"),jm=_n("sp"),$m=_n("rtg"),Lm=_n("rtc");function Mm(n,e=Ve){Wa("ec",n,e)}const Fm=Symbol.for("v-ndc");function Dm(n,e,t,r){let s;const i=t;if(K(n)||Te(n)){s=new Array(n.length);for(let a=0,o=n.length;a<o;a++)s[a]=e(n[a],a,void 0,i)}else if(typeof n=="number"){s=new Array(n);for(let a=0;a<n;a++)s[a]=e(a+1,a,void 0,i)}else if(be(n))if(n[Symbol.iterator])s=Array.from(n,(a,o)=>e(a,o,void 0,i));else{const a=Object.keys(n);s=new Array(a.length);for(let o=0,u=a.length;o<u;o++){const c=a[o];s[o]=e(n[c],c,o,i)}}else s=[];return s}const nu=n=>n?Xh(n)?Xa(n):nu(n.parent):null,bs=Be(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>nu(n.parent),$root:n=>nu(n.root),$emit:n=>n.emit,$options:n=>ec(n),$forceUpdate:n=>n.f||(n.f=()=>{n.effect.dirty=!0,Yu(n.update)}),$nextTick:n=>n.n||(n.n=wh.bind(n.proxy)),$watch:n=>ug.bind(n)}),yo=(n,e)=>n!==ye&&!n.__isScriptSetup&&se(n,e),Um={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:s,props:i,accessCache:a,type:o,appContext:u}=n;let c;if(e[0]!=="$"){const f=a[e];if(f!==void 0)switch(f){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(yo(r,e))return a[e]=1,r[e];if(s!==ye&&se(s,e))return a[e]=2,s[e];if((c=n.propsOptions[0])&&se(c,e))return a[e]=3,i[e];if(t!==ye&&se(t,e))return a[e]=4,t[e];ru&&(a[e]=0)}}const l=bs[e];let d,h;if(l)return e==="$attrs"&&tt(n.attrs,"get",""),l(n);if((d=o.__cssModules)&&(d=d[e]))return d;if(t!==ye&&se(t,e))return a[e]=4,t[e];if(h=u.config.globalProperties,se(h,e))return h[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return yo(s,e)?(s[e]=t,!0):r!==ye&&se(r,e)?(r[e]=t,!0):se(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},a){let o;return!!t[a]||n!==ye&&se(n,a)||yo(e,a)||(o=i[0])&&se(o,a)||se(r,a)||se(bs,a)||se(s.config.globalProperties,a)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:se(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Yc(n){return K(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let ru=!0;function Bm(n){const e=ec(n),t=n.proxy,r=n.ctx;ru=!1,e.beforeCreate&&el(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:a,watch:o,provide:u,inject:c,created:l,beforeMount:d,mounted:h,beforeUpdate:f,updated:p,activated:y,deactivated:_,beforeDestroy:b,beforeUnmount:E,destroyed:v,unmounted:L,render:U,renderTracked:R,renderTriggered:q,errorCaptured:Ae,serverPrefetch:me,expose:Me,inheritAttrs:yn,components:Zn,directives:Mt,filters:Qr}=e;if(c&&zm(c,r,null),a)for(const pe in a){const ae=a[pe];X(ae)&&(r[pe]=ae.bind(t))}if(s){const pe=s.call(t,t);be(pe)&&(n.data=Za(pe))}if(ru=!0,i)for(const pe in i){const ae=i[pe],en=X(ae)?ae.bind(t,t):X(ae.get)?ae.get.bind(t,t):pt,bn=!X(ae)&&X(ae.set)?ae.set.bind(t):pt,Ft=Tt({get:en,set:bn});Object.defineProperty(r,pe,{enumerable:!0,configurable:!0,get:()=>Ft.value,set:Ge=>Ft.value=Ge})}if(o)for(const pe in o)Rh(o[pe],r,t,pe);if(u){const pe=X(u)?u.call(t):u;Reflect.ownKeys(pe).forEach(ae=>{Ti(ae,pe[ae])})}l&&el(l,n,"c");function ke(pe,ae){K(ae)?ae.forEach(en=>pe(en.bind(t))):ae&&pe(ae.bind(t))}if(ke(Cm,d),ke(Ch,h),ke(Im,f),ke(Rm,p),ke(Pm,y),ke(Tm,_),ke(Mm,Ae),ke(Lm,R),ke($m,q),ke(Nm,E),ke(Ih,L),ke(jm,me),K(Me))if(Me.length){const pe=n.exposed||(n.exposed={});Me.forEach(ae=>{Object.defineProperty(pe,ae,{get:()=>t[ae],set:en=>t[ae]=en})})}else n.exposed||(n.exposed={});U&&n.render===pt&&(n.render=U),yn!=null&&(n.inheritAttrs=yn),Zn&&(n.components=Zn),Mt&&(n.directives=Mt)}function zm(n,e,t=pt){K(n)&&(n=su(n));for(const r in n){const s=n[r];let i;be(s)?"default"in s?i=pn(s.from||r,s.default,!0):i=pn(s.from||r):i=pn(s),nt(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:a=>i.value=a}):e[r]=i}}function el(n,e,t){It(K(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Rh(n,e,t,r){const s=r.includes(".")?qh(t,r):()=>t[r];if(Te(n)){const i=e[n];X(i)&&vs(s,i)}else if(X(n))vs(s,n.bind(t));else if(be(n))if(K(n))n.forEach(i=>Rh(i,e,t,r));else{const i=X(n.handler)?n.handler.bind(t):e[n.handler];X(i)&&vs(s,i,n)}}function ec(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:a}}=n.appContext,o=i.get(e);let u;return o?u=o:!s.length&&!t&&!r?u=e:(u={},s.length&&s.forEach(c=>qi(u,c,a,!0)),qi(u,e,a)),be(e)&&i.set(e,u),u}function qi(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&qi(n,i,t,!0),s&&s.forEach(a=>qi(n,a,t,!0));for(const a in e)if(!(r&&a==="expose")){const o=Hm[a]||t&&t[a];n[a]=o?o(n[a],e[a]):e[a]}return n}const Hm={data:tl,props:nl,emits:nl,methods:rs,computed:rs,beforeCreate:Ze,created:Ze,beforeMount:Ze,mounted:Ze,beforeUpdate:Ze,updated:Ze,beforeDestroy:Ze,beforeUnmount:Ze,destroyed:Ze,unmounted:Ze,activated:Ze,deactivated:Ze,errorCaptured:Ze,serverPrefetch:Ze,components:rs,directives:rs,watch:Vm,provide:tl,inject:Zm};function tl(n,e){return e?n?function(){return Be(X(n)?n.call(this,this):n,X(e)?e.call(this,this):e)}:e:n}function Zm(n,e){return rs(su(n),su(e))}function su(n){if(K(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Ze(n,e){return n?[...new Set([].concat(n,e))]:e}function rs(n,e){return n?Be(Object.create(null),n,e):e}function nl(n,e){return n?K(n)&&K(e)?[...new Set([...n,...e])]:Be(Object.create(null),Yc(n),Yc(e??{})):e}function Vm(n,e){if(!n)return e;if(!e)return n;const t=Be(Object.create(null),n);for(const r in e)t[r]=Ze(n[r],e[r]);return t}function Nh(){return{app:null,config:{isNativeTag:Mp,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let qm=0;function Wm(n,e){return function(r,s=null){X(r)||(r=Be({},r)),s!=null&&!be(s)&&(s=null);const i=Nh(),a=new WeakSet;let o=!1;const u=i.app={_uid:qm++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:kg,get config(){return i.config},set config(c){},use(c,...l){return a.has(c)||(c&&X(c.install)?(a.add(c),c.install(u,...l)):X(c)&&(a.add(c),c(u,...l))),u},mixin(c){return i.mixins.includes(c)||i.mixins.push(c),u},component(c,l){return l?(i.components[c]=l,u):i.components[c]},directive(c,l){return l?(i.directives[c]=l,u):i.directives[c]},mount(c,l,d){if(!o){const h=Ye(r,s);return h.appContext=i,d===!0?d="svg":d===!1&&(d=void 0),l&&e?e(h,c):n(h,c,d),o=!0,u._container=c,c.__vue_app__=u,Xa(h.component)}},unmount(){o&&(n(null,u._container),delete u._container.__vue_app__)},provide(c,l){return i.provides[c]=l,u},runWithContext(c){const l=ws;ws=u;try{return c()}finally{ws=l}}};return u}}let ws=null;function Ti(n,e){if(Ve){let t=Ve.provides;const r=Ve.parent&&Ve.parent.provides;r===t&&(t=Ve.provides=Object.create(r)),t[n]=e}}function pn(n,e,t=!1){const r=Ve||mt;if(r||ws){const s=r?r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:ws._context.provides;if(s&&n in s)return s[n];if(arguments.length>1)return t&&X(e)?e.call(r&&r.proxy):e}}const jh={},$h=()=>Object.create(jh),Lh=n=>Object.getPrototypeOf(n)===jh;function Km(n,e,t,r=!1){const s={},i=$h();n.propsDefaults=Object.create(null),Mh(n,e,s,i);for(const a in n.propsOptions[0])a in s||(s[a]=void 0);t?n.props=r?s:dh(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function Jm(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:a}}=n,o=ue(s),[u]=n.propsOptions;let c=!1;if((r||a>0)&&!(a&16)){if(a&8){const l=n.vnode.dynamicProps;for(let d=0;d<l.length;d++){let h=l[d];if(Ka(n.emitsOptions,h))continue;const f=e[h];if(u)if(se(i,h))f!==i[h]&&(i[h]=f,c=!0);else{const p=ir(h);s[p]=iu(u,o,p,f,n,!1)}else f!==i[h]&&(i[h]=f,c=!0)}}}else{Mh(n,e,s,i)&&(c=!0);let l;for(const d in o)(!e||!se(e,d)&&((l=fr(d))===d||!se(e,l)))&&(u?t&&(t[d]!==void 0||t[l]!==void 0)&&(s[d]=iu(u,o,d,void 0,n,!0)):delete s[d]);if(i!==o)for(const d in i)(!e||!se(e,d))&&(delete i[d],c=!0)}c&&fn(n.attrs,"set","")}function Mh(n,e,t,r){const[s,i]=n.propsOptions;let a=!1,o;if(e)for(let u in e){if(_s(u))continue;const c=e[u];let l;s&&se(s,l=ir(u))?!i||!i.includes(l)?t[l]=c:(o||(o={}))[l]=c:Ka(n.emitsOptions,u)||(!(u in r)||c!==r[u])&&(r[u]=c,a=!0)}if(i){const u=ue(t),c=o||ye;for(let l=0;l<i.length;l++){const d=i[l];t[d]=iu(s,u,d,c[d],n,!se(c,d))}}return a}function iu(n,e,t,r,s,i){const a=n[t];if(a!=null){const o=se(a,"default");if(o&&r===void 0){const u=a.default;if(a.type!==Function&&!a.skipFactory&&X(u)){const{propsDefaults:c}=s;if(t in c)r=c[t];else{const l=Ys(s);r=c[t]=u.call(null,e),l()}}else r=u}a[0]&&(i&&!o?r=!1:a[1]&&(r===""||r===fr(t))&&(r=!0))}return r}const Gm=new WeakMap;function Fh(n,e,t=!1){const r=t?Gm:e.propsCache,s=r.get(n);if(s)return s;const i=n.props,a={},o=[];let u=!1;if(!X(n)){const l=d=>{u=!0;const[h,f]=Fh(d,e,!0);Be(a,h),f&&o.push(...f)};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}if(!i&&!u)return be(n)&&r.set(n,Cr),Cr;if(K(i))for(let l=0;l<i.length;l++){const d=ir(i[l]);rl(d)&&(a[d]=ye)}else if(i)for(const l in i){const d=ir(l);if(rl(d)){const h=i[l],f=a[d]=K(h)||X(h)?{type:h}:Be({},h);if(f){const p=al(Boolean,f.type),y=al(String,f.type);f[0]=p>-1,f[1]=y<0||p<y,(p>-1||se(f,"default"))&&o.push(d)}}}const c=[a,o];return be(n)&&r.set(n,c),c}function rl(n){return n[0]!=="$"&&!_s(n)}function sl(n){return n===null?"null":typeof n=="function"?n.name||"":typeof n=="object"&&n.constructor&&n.constructor.name||""}function il(n,e){return sl(n)===sl(e)}function al(n,e){return K(e)?e.findIndex(t=>il(t,n)):X(e)&&il(e,n)?0:-1}const Dh=n=>n[0]==="_"||n==="$stable",tc=n=>K(n)?n.map(Zt):[Zt(n)],Xm=(n,e,t)=>{if(e._n)return e;const r=Om((...s)=>tc(e(...s)),t);return r._c=!1,r},Uh=(n,e,t)=>{const r=n._ctx;for(const s in n){if(Dh(s))continue;const i=n[s];if(X(i))e[s]=Xm(s,i,r);else if(i!=null){const a=tc(i);e[s]=()=>a}}},Bh=(n,e)=>{const t=tc(e);n.slots.default=()=>t},zh=(n,e,t)=>{for(const r in e)(t||r!=="_")&&(n[r]=e[r])},Qm=(n,e,t)=>{const r=n.slots=$h();if(n.vnode.shapeFlag&32){const s=e._;s?(zh(r,e,t),t&&Kd(r,"_",s,!0)):Uh(e,r)}else e&&Bh(n,e)},Ym=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,a=ye;if(r.shapeFlag&32){const o=e._;o?t&&o===1?i=!1:zh(s,e,t):(i=!e.$stable,Uh(e,s)),a=e}else e&&(Bh(n,e),a={default:1});if(i)for(const o in s)!Dh(o)&&a[o]==null&&delete s[o]};function au(n,e,t,r,s=!1){if(K(n)){n.forEach((h,f)=>au(h,e&&(K(e)?e[f]:e),t,r,s));return}if(Pi(r)&&!s)return;const i=r.shapeFlag&4?Xa(r.component):r.el,a=s?null:i,{i:o,r:u}=n,c=e&&e.r,l=o.refs===ye?o.refs={}:o.refs,d=o.setupState;if(c!=null&&c!==u&&(Te(c)?(l[c]=null,se(d,c)&&(d[c]=null)):nt(c)&&(c.value=null)),X(u))jn(u,o,12,[a,l]);else{const h=Te(u),f=nt(u);if(h||f){const p=()=>{if(n.f){const y=h?se(d,u)?d[u]:l[u]:u.value;s?K(y)&&Bu(y,i):K(y)?y.includes(i)||y.push(i):h?(l[u]=[i],se(d,u)&&(d[u]=l[u])):(u.value=[i],n.k&&(l[n.k]=u.value))}else h?(l[u]=a,se(d,u)&&(d[u]=a)):f&&(u.value=a,n.k&&(l[n.k]=a))};a?(p.id=-1,Qe(p,t)):p()}}}const eg=Symbol("_vte"),tg=n=>n.__isTeleport,Qe=gg;function ng(n){return rg(n)}function rg(n,e){const t=Jd();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:a,createText:o,createComment:u,setText:c,setElementText:l,parentNode:d,nextSibling:h,setScopeId:f=pt,insertStaticContent:p}=n,y=(m,g,w,O=null,A=null,T=null,N=void 0,C=null,I=!!g.dynamicChildren)=>{if(m===g)return;m&&!es(m,g)&&(O=x(m),Ge(m,A,T,!0),m=null),g.patchFlag===-2&&(I=!1,g.dynamicChildren=null);const{type:S,ref:D,shapeFlag:V}=g;switch(S){case Ja:_(m,g,w,O);break;case or:b(m,g,w,O);break;case vo:m==null&&E(g,w,O,N);break;case Ht:Zn(m,g,w,O,A,T,N,C,I);break;default:V&1?U(m,g,w,O,A,T,N,C,I):V&6?Mt(m,g,w,O,A,T,N,C,I):(V&64||V&128)&&S.process(m,g,w,O,A,T,N,C,I,B)}D!=null&&A&&au(D,m&&m.ref,T,g||m,!g)},_=(m,g,w,O)=>{if(m==null)r(g.el=o(g.children),w,O);else{const A=g.el=m.el;g.children!==m.children&&c(A,g.children)}},b=(m,g,w,O)=>{m==null?r(g.el=u(g.children||""),w,O):g.el=m.el},E=(m,g,w,O)=>{[m.el,m.anchor]=p(m.children,g,w,O,m.el,m.anchor)},v=({el:m,anchor:g},w,O)=>{let A;for(;m&&m!==g;)A=h(m),r(m,w,O),m=A;r(g,w,O)},L=({el:m,anchor:g})=>{let w;for(;m&&m!==g;)w=h(m),s(m),m=w;s(g)},U=(m,g,w,O,A,T,N,C,I)=>{g.type==="svg"?N="svg":g.type==="math"&&(N="mathml"),m==null?R(g,w,O,A,T,N,C,I):me(m,g,A,T,N,C,I)},R=(m,g,w,O,A,T,N,C)=>{let I,S;const{props:D,shapeFlag:V,transition:H,dirs:J}=m;if(I=m.el=a(m.type,T,D&&D.is,D),V&8?l(I,m.children):V&16&&Ae(m.children,I,null,O,A,bo(m,T),N,C),J&&Vn(m,null,O,"created"),q(I,m,m.scopeId,N,O),D){for(const _e in D)_e!=="value"&&!_s(_e)&&i(I,_e,null,D[_e],T,O);"value"in D&&i(I,"value",null,D.value,T),(S=D.onVnodeBeforeMount)&&Ut(S,O,m)}J&&Vn(m,null,O,"beforeMount");const ee=sg(A,H);ee&&H.beforeEnter(I),r(I,g,w),((S=D&&D.onVnodeMounted)||ee||J)&&Qe(()=>{S&&Ut(S,O,m),ee&&H.enter(I),J&&Vn(m,null,O,"mounted")},A)},q=(m,g,w,O,A)=>{if(w&&f(m,w),O)for(let T=0;T<O.length;T++)f(m,O[T]);if(A){let T=A.subTree;if(g===T){const N=A.vnode;q(m,N,N.scopeId,N.slotScopeIds,A.parent)}}},Ae=(m,g,w,O,A,T,N,C,I=0)=>{for(let S=I;S<m.length;S++){const D=m[S]=C?Sn(m[S]):Zt(m[S]);y(null,D,g,w,O,A,T,N,C)}},me=(m,g,w,O,A,T,N)=>{const C=g.el=m.el;let{patchFlag:I,dynamicChildren:S,dirs:D}=g;I|=m.patchFlag&16;const V=m.props||ye,H=g.props||ye;let J;if(w&&qn(w,!1),(J=H.onVnodeBeforeUpdate)&&Ut(J,w,g,m),D&&Vn(g,m,w,"beforeUpdate"),w&&qn(w,!0),(V.innerHTML&&H.innerHTML==null||V.textContent&&H.textContent==null)&&l(C,""),S?Me(m.dynamicChildren,S,C,w,O,bo(g,A),T):N||ae(m,g,C,null,w,O,bo(g,A),T,!1),I>0){if(I&16)yn(C,V,H,w,A);else if(I&2&&V.class!==H.class&&i(C,"class",null,H.class,A),I&4&&i(C,"style",V.style,H.style,A),I&8){const ee=g.dynamicProps;for(let _e=0;_e<ee.length;_e++){const oe=ee[_e],Ce=V[oe],_t=H[oe];(_t!==Ce||oe==="value")&&i(C,oe,Ce,_t,A,w)}}I&1&&m.children!==g.children&&l(C,g.children)}else!N&&S==null&&yn(C,V,H,w,A);((J=H.onVnodeUpdated)||D)&&Qe(()=>{J&&Ut(J,w,g,m),D&&Vn(g,m,w,"updated")},O)},Me=(m,g,w,O,A,T,N)=>{for(let C=0;C<g.length;C++){const I=m[C],S=g[C],D=I.el&&(I.type===Ht||!es(I,S)||I.shapeFlag&70)?d(I.el):w;y(I,S,D,null,O,A,T,N,!0)}},yn=(m,g,w,O,A)=>{if(g!==w){if(g!==ye)for(const T in g)!_s(T)&&!(T in w)&&i(m,T,g[T],null,A,O);for(const T in w){if(_s(T))continue;const N=w[T],C=g[T];N!==C&&T!=="value"&&i(m,T,C,N,A,O)}"value"in w&&i(m,"value",g.value,w.value,A)}},Zn=(m,g,w,O,A,T,N,C,I)=>{const S=g.el=m?m.el:o(""),D=g.anchor=m?m.anchor:o("");let{patchFlag:V,dynamicChildren:H,slotScopeIds:J}=g;J&&(C=C?C.concat(J):J),m==null?(r(S,w,O),r(D,w,O),Ae(g.children||[],w,D,A,T,N,C,I)):V>0&&V&64&&H&&m.dynamicChildren?(Me(m.dynamicChildren,H,w,A,T,N,C),(g.key!=null||A&&g===A.subTree)&&Hh(m,g,!0)):ae(m,g,w,D,A,T,N,C,I)},Mt=(m,g,w,O,A,T,N,C,I)=>{g.slotScopeIds=C,m==null?g.shapeFlag&512?A.ctx.activate(g,w,O,N,I):Qr(g,w,O,A,T,N,I):mr(m,g,I)},Qr=(m,g,w,O,A,T,N)=>{const C=m.component=Ag(m,O,A);if(Th(m)&&(C.ctx.renderer=B),xg(C,!1,N),C.asyncDep){if(A&&A.registerDep(C,ke,N),!m.el){const I=C.subTree=Ye(or);b(null,I,g,w)}}else ke(C,m,g,w,A,T,N)},mr=(m,g,w)=>{const O=g.component=m.component;if(fg(m,g,w))if(O.asyncDep&&!O.asyncResolved){pe(O,g,w);return}else O.next=g,Em(O.update),O.effect.dirty=!0,O.update();else g.el=m.el,O.vnode=g},ke=(m,g,w,O,A,T,N)=>{const C=()=>{if(m.isMounted){let{next:D,bu:V,u:H,parent:J,vnode:ee}=m;{const yr=Zh(m);if(yr){D&&(D.el=ee.el,pe(m,D,N)),yr.asyncDep.then(()=>{m.isUnmounted||C()});return}}let _e=D,oe;qn(m,!1),D?(D.el=ee.el,pe(m,D,N)):D=ee,V&&Oi(V),(oe=D.props&&D.props.onVnodeBeforeUpdate)&&Ut(oe,J,D,ee),qn(m,!0);const Ce=wo(m),_t=m.subTree;m.subTree=Ce,y(_t,Ce,d(_t.el),x(_t),m,A,T),D.el=Ce.el,_e===null&&pg(m,Ce.el),H&&Qe(H,A),(oe=D.props&&D.props.onVnodeUpdated)&&Qe(()=>Ut(oe,J,D,ee),A)}else{let D;const{el:V,props:H}=g,{bm:J,m:ee,parent:_e}=m,oe=Pi(g);if(qn(m,!1),J&&Oi(J),!oe&&(D=H&&H.onVnodeBeforeMount)&&Ut(D,_e,g),qn(m,!0),V&&we){const Ce=()=>{m.subTree=wo(m),we(V,m.subTree,m,A,null)};oe?g.type.__asyncLoader().then(()=>!m.isUnmounted&&Ce()):Ce()}else{const Ce=m.subTree=wo(m);y(null,Ce,w,O,m,A,T),g.el=Ce.el}if(ee&&Qe(ee,A),!oe&&(D=H&&H.onVnodeMounted)){const Ce=g;Qe(()=>Ut(D,_e,Ce),A)}(g.shapeFlag&256||_e&&Pi(_e.vnode)&&_e.vnode.shapeFlag&256)&&m.a&&Qe(m.a,A),m.isMounted=!0,g=w=O=null}},I=m.effect=new Vu(C,pt,()=>Yu(S),m.scope),S=m.update=()=>{I.dirty&&I.run()};S.i=m,S.id=m.uid,qn(m,!0),S()},pe=(m,g,w)=>{g.component=m;const O=m.vnode.props;m.vnode=g,m.next=null,Jm(m,g.props,O,w),Ym(m,g.children,w),Bn(),Qc(m),zn()},ae=(m,g,w,O,A,T,N,C,I=!1)=>{const S=m&&m.children,D=m?m.shapeFlag:0,V=g.children,{patchFlag:H,shapeFlag:J}=g;if(H>0){if(H&128){bn(S,V,w,O,A,T,N,C,I);return}else if(H&256){en(S,V,w,O,A,T,N,C,I);return}}J&8?(D&16&&dt(S,A,T),V!==S&&l(w,V)):D&16?J&16?bn(S,V,w,O,A,T,N,C,I):dt(S,A,T,!0):(D&8&&l(w,""),J&16&&Ae(V,w,O,A,T,N,C,I))},en=(m,g,w,O,A,T,N,C,I)=>{m=m||Cr,g=g||Cr;const S=m.length,D=g.length,V=Math.min(S,D);let H;for(H=0;H<V;H++){const J=g[H]=I?Sn(g[H]):Zt(g[H]);y(m[H],J,w,null,A,T,N,C,I)}S>D?dt(m,A,T,!0,!1,V):Ae(g,w,O,A,T,N,C,I,V)},bn=(m,g,w,O,A,T,N,C,I)=>{let S=0;const D=g.length;let V=m.length-1,H=D-1;for(;S<=V&&S<=H;){const J=m[S],ee=g[S]=I?Sn(g[S]):Zt(g[S]);if(es(J,ee))y(J,ee,w,null,A,T,N,C,I);else break;S++}for(;S<=V&&S<=H;){const J=m[V],ee=g[H]=I?Sn(g[H]):Zt(g[H]);if(es(J,ee))y(J,ee,w,null,A,T,N,C,I);else break;V--,H--}if(S>V){if(S<=H){const J=H+1,ee=J<D?g[J].el:O;for(;S<=H;)y(null,g[S]=I?Sn(g[S]):Zt(g[S]),w,ee,A,T,N,C,I),S++}}else if(S>H)for(;S<=V;)Ge(m[S],A,T,!0),S++;else{const J=S,ee=S,_e=new Map;for(S=ee;S<=H;S++){const rt=g[S]=I?Sn(g[S]):Zt(g[S]);rt.key!=null&&_e.set(rt.key,S)}let oe,Ce=0;const _t=H-ee+1;let yr=!1,Bc=0;const Yr=new Array(_t);for(S=0;S<_t;S++)Yr[S]=0;for(S=J;S<=V;S++){const rt=m[S];if(Ce>=_t){Ge(rt,A,T,!0);continue}let Dt;if(rt.key!=null)Dt=_e.get(rt.key);else for(oe=ee;oe<=H;oe++)if(Yr[oe-ee]===0&&es(rt,g[oe])){Dt=oe;break}Dt===void 0?Ge(rt,A,T,!0):(Yr[Dt-ee]=S+1,Dt>=Bc?Bc=Dt:yr=!0,y(rt,g[Dt],w,null,A,T,N,C,I),Ce++)}const zc=yr?ig(Yr):Cr;for(oe=zc.length-1,S=_t-1;S>=0;S--){const rt=ee+S,Dt=g[rt],Hc=rt+1<D?g[rt+1].el:O;Yr[S]===0?y(null,Dt,w,Hc,A,T,N,C,I):yr&&(oe<0||S!==zc[oe]?Ft(Dt,w,Hc,2):oe--)}}},Ft=(m,g,w,O,A=null)=>{const{el:T,type:N,transition:C,children:I,shapeFlag:S}=m;if(S&6){Ft(m.component.subTree,g,w,O);return}if(S&128){m.suspense.move(g,w,O);return}if(S&64){N.move(m,g,w,B);return}if(N===Ht){r(T,g,w);for(let V=0;V<I.length;V++)Ft(I[V],g,w,O);r(m.anchor,g,w);return}if(N===vo){v(m,g,w);return}if(O!==2&&S&1&&C)if(O===0)C.beforeEnter(T),r(T,g,w),Qe(()=>C.enter(T),A);else{const{leave:V,delayLeave:H,afterLeave:J}=C,ee=()=>r(T,g,w),_e=()=>{V(T,()=>{ee(),J&&J()})};H?H(T,ee,_e):_e()}else r(T,g,w)},Ge=(m,g,w,O=!1,A=!1)=>{const{type:T,props:N,ref:C,children:I,dynamicChildren:S,shapeFlag:D,patchFlag:V,dirs:H,cacheIndex:J}=m;if(V===-2&&(A=!1),C!=null&&au(C,null,w,m,!0),J!=null&&(g.renderCache[J]=void 0),D&256){g.ctx.deactivate(m);return}const ee=D&1&&H,_e=!Pi(m);let oe;if(_e&&(oe=N&&N.onVnodeBeforeUnmount)&&Ut(oe,g,m),D&6)ci(m.component,w,O);else{if(D&128){m.suspense.unmount(w,O);return}ee&&Vn(m,null,g,"beforeUnmount"),D&64?m.type.remove(m,g,w,B,O):S&&!S.hasOnce&&(T!==Ht||V>0&&V&64)?dt(S,g,w,!1,!0):(T===Ht&&V&384||!A&&D&16)&&dt(I,g,w),O&&gr(m)}(_e&&(oe=N&&N.onVnodeUnmounted)||ee)&&Qe(()=>{oe&&Ut(oe,g,m),ee&&Vn(m,null,g,"unmounted")},w)},gr=m=>{const{type:g,el:w,anchor:O,transition:A}=m;if(g===Ht){_r(w,O);return}if(g===vo){L(m);return}const T=()=>{s(w),A&&!A.persisted&&A.afterLeave&&A.afterLeave()};if(m.shapeFlag&1&&A&&!A.persisted){const{leave:N,delayLeave:C}=A,I=()=>N(w,T);C?C(m.el,T,I):I()}else T()},_r=(m,g)=>{let w;for(;m!==g;)w=h(m),s(m),m=w;s(g)},ci=(m,g,w)=>{const{bum:O,scope:A,update:T,subTree:N,um:C,m:I,a:S}=m;ol(I),ol(S),O&&Oi(O),A.stop(),T&&(T.active=!1,Ge(N,m,g,w)),C&&Qe(C,g),Qe(()=>{m.isUnmounted=!0},g),g&&g.pendingBranch&&!g.isUnmounted&&m.asyncDep&&!m.asyncResolved&&m.suspenseId===g.pendingId&&(g.deps--,g.deps===0&&g.resolve())},dt=(m,g,w,O=!1,A=!1,T=0)=>{for(let N=T;N<m.length;N++)Ge(m[N],g,w,O,A)},x=m=>{if(m.shapeFlag&6)return x(m.component.subTree);if(m.shapeFlag&128)return m.suspense.next();const g=h(m.anchor||m.el),w=g&&g[eg];return w?h(w):g};let F=!1;const j=(m,g,w)=>{m==null?g._vnode&&Ge(g._vnode,null,null,!0):y(g._vnode||null,m,g,null,null,null,w),F||(F=!0,Qc(),Eh(),F=!1),g._vnode=m},B={p:y,um:Ge,m:Ft,r:gr,mt:Qr,mc:Ae,pc:ae,pbc:Me,n:x,o:n};let ce,we;return{render:j,hydrate:ce,createApp:Wm(j,ce)}}function bo({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function qn({effect:n,update:e},t){n.allowRecurse=e.allowRecurse=t}function sg(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function Hh(n,e,t=!1){const r=n.children,s=e.children;if(K(r)&&K(s))for(let i=0;i<r.length;i++){const a=r[i];let o=s[i];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=s[i]=Sn(s[i]),o.el=a.el),!t&&o.patchFlag!==-2&&Hh(a,o)),o.type===Ja&&(o.el=a.el)}}function ig(n){const e=n.slice(),t=[0];let r,s,i,a,o;const u=n.length;for(r=0;r<u;r++){const c=n[r];if(c!==0){if(s=t[t.length-1],n[s]<c){e[r]=s,t.push(r);continue}for(i=0,a=t.length-1;i<a;)o=i+a>>1,n[t[o]]<c?i=o+1:a=o;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,a=t[i-1];i-- >0;)t[i]=a,a=e[a];return t}function Zh(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Zh(e)}function ol(n){if(n)for(let e=0;e<n.length;e++)n[e].active=!1}const ag=Symbol.for("v-scx"),og=()=>pn(ag),mi={};function vs(n,e,t){return Vh(n,e,t)}function Vh(n,e,{immediate:t,deep:r,flush:s,once:i,onTrack:a,onTrigger:o}=ye){if(e&&i){const R=e;e=(...q)=>{R(...q),U()}}const u=Ve,c=R=>r===!0?R:Cn(R,r===!1?1:void 0);let l,d=!1,h=!1;if(nt(n)?(l=()=>n.value,d=Fr(n)):ys(n)?(l=()=>c(n),d=!0):K(n)?(h=!0,d=n.some(R=>ys(R)||Fr(R)),l=()=>n.map(R=>{if(nt(R))return R.value;if(ys(R))return c(R);if(X(R))return jn(R,u,2)})):X(n)?e?l=()=>jn(n,u,2):l=()=>(f&&f(),It(n,u,3,[p])):l=pt,e&&r){const R=l;l=()=>Cn(R())}let f,p=R=>{f=v.onStop=()=>{jn(R,u,4),f=v.onStop=void 0}},y;if(Ga)if(p=pt,e?t&&It(e,u,3,[l(),h?[]:void 0,p]):l(),s==="sync"){const R=og();y=R.__watcherHandles||(R.__watcherHandles=[])}else return pt;let _=h?new Array(n.length).fill(mi):mi;const b=()=>{if(!(!v.active||!v.dirty))if(e){const R=v.run();(r||d||(h?R.some((q,Ae)=>$n(q,_[Ae])):$n(R,_)))&&(f&&f(),It(e,u,3,[R,_===mi?void 0:h&&_[0]===mi?[]:_,p]),_=R)}else v.run()};b.allowRecurse=!!e;let E;s==="sync"?E=b:s==="post"?E=()=>Qe(b,u&&u.suspense):(b.pre=!0,u&&(b.id=u.uid),E=()=>Yu(b));const v=new Vu(l,pt,E),L=Gp(),U=()=>{v.stop(),L&&Bu(L.effects,v)};return e?t?b():_=v.run():s==="post"?Qe(v.run.bind(v),u&&u.suspense):v.run(),y&&y.push(U),U}function ug(n,e,t){const r=this.proxy,s=Te(n)?n.includes(".")?qh(r,n):()=>r[n]:n.bind(r,r);let i;X(e)?i=e:(i=e.handler,t=e);const a=Ys(this),o=Vh(s,i.bind(r),t);return a(),o}function qh(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}function Cn(n,e=1/0,t){if(e<=0||!be(n)||n.__v_skip||(t=t||new Set,t.has(n)))return n;if(t.add(n),e--,nt(n))Cn(n.value,e,t);else if(K(n))for(let r=0;r<n.length;r++)Cn(n[r],e,t);else if(Hd(n)||Ir(n))n.forEach(r=>{Cn(r,e,t)});else if(qd(n)){for(const r in n)Cn(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Cn(n[r],e,t)}return n}const cg=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${ir(e)}Modifiers`]||n[`${fr(e)}Modifiers`];function lg(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||ye;let s=t;const i=e.startsWith("update:"),a=i&&cg(r,e.slice(7));a&&(a.trim&&(s=t.map(l=>Te(l)?l.trim():l)),a.number&&(s=t.map(Go)));let o,u=r[o=go(e)]||r[o=go(ir(e))];!u&&i&&(u=r[o=go(fr(e))]),u&&It(u,n,6,s);const c=r[o+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[o])return;n.emitted[o]=!0,It(c,n,6,s)}}function Wh(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let a={},o=!1;if(!X(n)){const u=c=>{const l=Wh(c,e,!0);l&&(o=!0,Be(a,l))};!t&&e.mixins.length&&e.mixins.forEach(u),n.extends&&u(n.extends),n.mixins&&n.mixins.forEach(u)}return!i&&!o?(be(n)&&r.set(n,null),null):(K(i)?i.forEach(u=>a[u]=null):Be(a,i),be(n)&&r.set(n,a),a)}function Ka(n,e){return!n||!Ua(e)?!1:(e=e.slice(2).replace(/Once$/,""),se(n,e[0].toLowerCase()+e.slice(1))||se(n,fr(e))||se(n,e))}function wo(n){const{type:e,vnode:t,proxy:r,withProxy:s,propsOptions:[i],slots:a,attrs:o,emit:u,render:c,renderCache:l,props:d,data:h,setupState:f,ctx:p,inheritAttrs:y}=n,_=Vi(n);let b,E;try{if(t.shapeFlag&4){const L=s||r,U=L;b=Zt(c.call(U,L,l,d,f,h,p)),E=o}else{const L=e;b=Zt(L.length>1?L(d,{attrs:o,slots:a,emit:u}):L(d,null)),E=e.props?o:dg(o)}}catch(L){Es.length=0,Va(L,n,1),b=Ye(or)}let v=b;if(E&&y!==!1){const L=Object.keys(E),{shapeFlag:U}=v;L.length&&U&7&&(i&&L.some(Uu)&&(E=hg(E,i)),v=Dr(v,E,!1,!0))}return t.dirs&&(v=Dr(v,null,!1,!0),v.dirs=v.dirs?v.dirs.concat(t.dirs):t.dirs),t.transition&&(v.transition=t.transition),b=v,Vi(_),b}const dg=n=>{let e;for(const t in n)(t==="class"||t==="style"||Ua(t))&&((e||(e={}))[t]=n[t]);return e},hg=(n,e)=>{const t={};for(const r in n)(!Uu(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function fg(n,e,t){const{props:r,children:s,component:i}=n,{props:a,children:o,patchFlag:u}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&u>=0){if(u&1024)return!0;if(u&16)return r?ul(r,a,c):!!a;if(u&8){const l=e.dynamicProps;for(let d=0;d<l.length;d++){const h=l[d];if(a[h]!==r[h]&&!Ka(c,h))return!0}}}else return(s||o)&&(!o||!o.$stable)?!0:r===a?!1:r?a?ul(r,a,c):!0:!!a;return!1}function ul(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Ka(t,i))return!0}return!1}function pg({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const mg=n=>n.__isSuspense;function gg(n,e){e&&e.pendingBranch?K(n)?e.effects.push(...n):e.effects.push(n):Am(n)}const Ht=Symbol.for("v-fgt"),Ja=Symbol.for("v-txt"),or=Symbol.for("v-cmt"),vo=Symbol.for("v-stc"),Es=[];let at=null;function St(n=!1){Es.push(at=n?null:[])}function _g(){Es.pop(),at=Es[Es.length-1]||null}let Ns=1;function cl(n){Ns+=n,n<0&&at&&(at.hasOnce=!0)}function Kh(n){return n.dynamicChildren=Ns>0?at||Cr:null,_g(),Ns>0&&at&&at.push(n),n}function sn(n,e,t,r,s,i){return Kh(xe(n,e,t,r,s,i,!0))}function Jh(n,e,t,r,s){return Kh(Ye(n,e,t,r,s,!0))}function ou(n){return n?n.__v_isVNode===!0:!1}function es(n,e){return n.type===e.type&&n.key===e.key}const Gh=({key:n})=>n??null,ki=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Te(n)||nt(n)||X(n)?{i:mt,r:n,k:e,f:!!t}:n:null);function xe(n,e=null,t=null,r=0,s=null,i=n===Ht?0:1,a=!1,o=!1){const u={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Gh(e),ref:e&&ki(e),scopeId:qa,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:mt};return o?(nc(u,t),i&128&&n.normalize(u)):t&&(u.shapeFlag|=Te(t)?8:16),Ns>0&&!a&&at&&(u.patchFlag>0||i&6)&&u.patchFlag!==32&&at.push(u),u}const Ye=yg;function yg(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===Fm)&&(n=or),ou(n)){const o=Dr(n,e,!0);return t&&nc(o,t),Ns>0&&!i&&at&&(o.shapeFlag&6?at[at.indexOf(n)]=o:at.push(o)),o.patchFlag=-2,o}if(Tg(n)&&(n=n.__vccOpts),e){e=bg(e);let{class:o,style:u}=e;o&&!Te(o)&&(e.class=Zu(o)),be(u)&&(fh(u)&&!K(u)&&(u=Be({},u)),e.style=Hu(u))}const a=Te(n)?1:mg(n)?128:tg(n)?64:be(n)?4:X(n)?2:0;return xe(n,e,t,r,s,a,i,!0)}function bg(n){return n?fh(n)||Lh(n)?Be({},n):n:null}function Dr(n,e,t=!1,r=!1){const{props:s,ref:i,patchFlag:a,children:o,transition:u}=n,c=e?wg(s||{},e):s,l={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&Gh(c),ref:e&&e.ref?t&&i?K(i)?i.concat(ki(e)):[i,ki(e)]:ki(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:o,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Ht?a===-1?16:a|16:a,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:u,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Dr(n.ssContent),ssFallback:n.ssFallback&&Dr(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return u&&r&&Sh(l,u.clone(l)),l}function Ci(n=" ",e=0){return Ye(Ja,null,n,e)}function Eo(n="",e=!1){return e?(St(),Jh(or,null,n)):Ye(or,null,n)}function Zt(n){return n==null||typeof n=="boolean"?Ye(or):K(n)?Ye(Ht,null,n.slice()):typeof n=="object"?Sn(n):Ye(Ja,null,String(n))}function Sn(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Dr(n)}function nc(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(K(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),nc(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!Lh(e)?e._ctx=mt:s===3&&mt&&(mt.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else X(e)?(e={default:e,_ctx:mt},t=32):(e=String(e),r&64?(t=16,e=[Ci(e)]):t=8);n.children=e,n.shapeFlag|=t}function wg(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=Zu([e.class,r.class]));else if(s==="style")e.style=Hu([e.style,r.style]);else if(Ua(s)){const i=e[s],a=r[s];a&&i!==a&&!(K(i)&&i.includes(a))&&(e[s]=i?[].concat(i,a):a)}else s!==""&&(e[s]=r[s])}return e}function Ut(n,e,t,r=null){It(n,e,7,[t,r])}const vg=Nh();let Eg=0;function Ag(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||vg,i={uid:Eg++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new Yd(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Fh(r,s),emitsOptions:Wh(r,s),emit:null,emitted:null,propsDefaults:ye,inheritAttrs:r.inheritAttrs,ctx:ye,data:ye,props:ye,attrs:ye,slots:ye,refs:ye,setupState:ye,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=lg.bind(null,i),n.ce&&n.ce(i),i}let Ve=null,Wi,uu;{const n=Jd(),e=(t,r)=>{let s;return(s=n[t])||(s=n[t]=[]),s.push(r),i=>{s.length>1?s.forEach(a=>a(i)):s[0](i)}};Wi=e("__VUE_INSTANCE_SETTERS__",t=>Ve=t),uu=e("__VUE_SSR_SETTERS__",t=>Ga=t)}const Ys=n=>{const e=Ve;return Wi(n),n.scope.on(),()=>{n.scope.off(),Wi(e)}},ll=()=>{Ve&&Ve.scope.off(),Wi(null)};function Xh(n){return n.vnode.shapeFlag&4}let Ga=!1;function xg(n,e=!1,t=!1){e&&uu(e);const{props:r,children:s}=n.vnode,i=Xh(n);Km(n,r,i,e),Qm(n,s,t);const a=i?Og(n,e):void 0;return e&&uu(!1),a}function Og(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,Um);const{setup:r}=t;if(r){const s=n.setupContext=r.length>1?Pg(n):null,i=Ys(n);Bn();const a=jn(r,n,0,[n.props,s]);if(zn(),i(),Zd(a)){if(a.then(ll,ll),e)return a.then(o=>{dl(n,o,e)}).catch(o=>{Va(o,n,0)});n.asyncDep=a}else dl(n,a,e)}else Qh(n,e)}function dl(n,e,t){X(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:be(e)&&(n.setupState=yh(e)),Qh(n,t)}let hl;function Qh(n,e,t){const r=n.type;if(!n.render){if(!e&&hl&&!r.render){const s=r.template||ec(n).template;if(s){const{isCustomElement:i,compilerOptions:a}=n.appContext.config,{delimiters:o,compilerOptions:u}=r,c=Be(Be({isCustomElement:i,delimiters:o},a),u);r.render=hl(s,c)}}n.render=r.render||pt}{const s=Ys(n);Bn();try{Bm(n)}finally{zn(),s()}}}const Sg={get(n,e){return tt(n,"get",""),n[e]}};function Pg(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,Sg),slots:n.slots,emit:n.emit,expose:e}}function Xa(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(yh(ph(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in bs)return bs[t](n)},has(e,t){return t in e||t in bs}})):n.proxy}function Tg(n){return X(n)&&"__vccOpts"in n}const Tt=(n,e)=>gm(n,e,Ga);function Yh(n,e,t){const r=arguments.length;return r===2?be(e)&&!K(e)?ou(e)?Ye(n,null,[e]):Ye(n,e):Ye(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&ou(t)&&(t=[t]),Ye(n,e,t))}const kg="3.4.34";/**
* @vue/runtime-dom v3.4.34
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Cg="http://www.w3.org/2000/svg",Ig="http://www.w3.org/1998/Math/MathML",ln=typeof document<"u"?document:null,fl=ln&&ln.createElement("template"),Rg={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e==="svg"?ln.createElementNS(Cg,n):e==="mathml"?ln.createElementNS(Ig,n):t?ln.createElement(n,{is:t}):ln.createElement(n);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>ln.createTextNode(n),createComment:n=>ln.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>ln.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const a=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{fl.innerHTML=r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n;const o=fl.content;if(r==="svg"||r==="mathml"){const u=o.firstChild;for(;u.firstChild;)o.appendChild(u.firstChild);o.removeChild(u)}e.insertBefore(o,t)}return[a?a.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Ng=Symbol("_vtc");function jg(n,e,t){const r=n[Ng];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const pl=Symbol("_vod"),$g=Symbol("_vsh"),Lg=Symbol(""),Mg=/(^|;)\s*display\s*:/;function Fg(n,e,t){const r=n.style,s=Te(t);let i=!1;if(t&&!s){if(e)if(Te(e))for(const a of e.split(";")){const o=a.slice(0,a.indexOf(":")).trim();t[o]==null&&Ii(r,o,"")}else for(const a in e)t[a]==null&&Ii(r,a,"");for(const a in t)a==="display"&&(i=!0),Ii(r,a,t[a])}else if(s){if(e!==t){const a=r[Lg];a&&(t+=";"+a),r.cssText=t,i=Mg.test(t)}}else e&&n.removeAttribute("style");pl in n&&(n[pl]=i?r.display:"",n[$g]&&(r.display="none"))}const ml=/\s*!important$/;function Ii(n,e,t){if(K(t))t.forEach(r=>Ii(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=Dg(n,e);ml.test(t)?n.setProperty(fr(r),t.replace(ml,""),"important"):n[r]=t}}const gl=["Webkit","Moz","ms"],Ao={};function Dg(n,e){const t=Ao[e];if(t)return t;let r=ir(e);if(r!=="filter"&&r in n)return Ao[e]=r;r=Wd(r);for(let s=0;s<gl.length;s++){const i=gl[s]+r;if(i in n)return Ao[e]=i}return e}const _l="http://www.w3.org/1999/xlink";function yl(n,e,t,r,s,i=Wp(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(_l,e.slice(6,e.length)):n.setAttributeNS(_l,e,t):t==null||i&&!Gd(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Un(t)?String(t):t)}function Ug(n,e,t,r){if(e==="innerHTML"||e==="textContent"){if(t==null)return;n[e]=t;return}const s=n.tagName;if(e==="value"&&s!=="PROGRESS"&&!s.includes("-")){const a=s==="OPTION"?n.getAttribute("value")||"":n.value,o=t==null?"":String(t);(a!==o||!("_value"in n))&&(n.value=o),t==null&&n.removeAttribute(e),n._value=t;return}let i=!1;if(t===""||t==null){const a=typeof n[e];a==="boolean"?t=Gd(t):t==null&&a==="string"?(t="",i=!0):a==="number"&&(t=0,i=!0)}try{n[e]=t}catch{}i&&n.removeAttribute(e)}function vr(n,e,t,r){n.addEventListener(e,t,r)}function Bg(n,e,t,r){n.removeEventListener(e,t,r)}const bl=Symbol("_vei");function zg(n,e,t,r,s=null){const i=n[bl]||(n[bl]={}),a=i[e];if(r&&a)a.value=r;else{const[o,u]=Hg(e);if(r){const c=i[e]=qg(r,s);vr(n,o,c,u)}else a&&(Bg(n,o,a,u),i[e]=void 0)}}const wl=/(?:Once|Passive|Capture)$/;function Hg(n){let e;if(wl.test(n)){e={};let r;for(;r=n.match(wl);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):fr(n.slice(2)),e]}let xo=0;const Zg=Promise.resolve(),Vg=()=>xo||(Zg.then(()=>xo=0),xo=Date.now());function qg(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;It(Wg(r,t.value),e,5,[r])};return t.value=n,t.attached=Vg(),t}function Wg(n,e){if(K(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const vl=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,Kg=(n,e,t,r,s,i)=>{const a=s==="svg";e==="class"?jg(n,r,a):e==="style"?Fg(n,t,r):Ua(e)?Uu(e)||zg(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Jg(n,e,r,a))?(Ug(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&yl(n,e,r,a,i,e!=="value")):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),yl(n,e,r,a))};function Jg(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&vl(e)&&X(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return vl(e)&&Te(t)?!1:e in n}const El=n=>{const e=n.props["onUpdate:modelValue"]||!1;return K(e)?t=>Oi(e,t):e};function Gg(n){n.target.composing=!0}function Al(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Oo=Symbol("_assign"),Xg={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n[Oo]=El(s);const i=r||s.props&&s.props.type==="number";vr(n,e?"change":"input",a=>{if(a.target.composing)return;let o=n.value;t&&(o=o.trim()),i&&(o=Go(o)),n[Oo](o)}),t&&vr(n,"change",()=>{n.value=n.value.trim()}),e||(vr(n,"compositionstart",Gg),vr(n,"compositionend",Al),vr(n,"change",Al))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:s,number:i}},a){if(n[Oo]=El(a),n.composing)return;const o=(i||n.type==="number")&&!/^0\d/.test(n.value)?Go(n.value):n.value,u=e??"";o!==u&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||s&&n.value.trim()===u)||(n.value=u))}},Qg=Be({patchProp:Kg},Rg);let xl;function Yg(){return xl||(xl=ng(Qg))}const e_=(...n)=>{const e=Yg().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=n_(r);if(!s)return;const i=e._component;!X(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.innerHTML="";const a=t(s,!1,t_(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),a},e};function t_(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function n_(n){return Te(n)?document.querySelector(n):n}var r_=!1;/*!
 * pinia v2.2.0
 * (c) 2024 Eduardo San Martin Morote
 * @license MIT
 */const s_=Symbol();var Ol;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(Ol||(Ol={}));function i_(){const n=Kp(!0),e=n.run(()=>cn({}));let t=[],r=[];const s=ph({install(i){s._a=i,i.provide(s_,s),i.config.globalProperties.$pinia=s,r.forEach(a=>t.push(a)),r=[]},use(i){return!this._a&&!r_?r.push(i):t.push(i),this},_p:t,_a:null,_e:n,_s:new Map,state:e});return s}/*!
  * vue-router v4.4.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Er=typeof document<"u";function a_(n){return n.__esModule||n[Symbol.toStringTag]==="Module"}const le=Object.assign;function So(n,e){const t={};for(const r in e){const s=e[r];t[r]=Nt(s)?s.map(n):n(s)}return t}const As=()=>{},Nt=Array.isArray,ef=/#/g,o_=/&/g,u_=/\//g,c_=/=/g,l_=/\?/g,tf=/\+/g,d_=/%5B/g,h_=/%5D/g,nf=/%5E/g,f_=/%60/g,rf=/%7B/g,p_=/%7C/g,sf=/%7D/g,m_=/%20/g;function rc(n){return encodeURI(""+n).replace(p_,"|").replace(d_,"[").replace(h_,"]")}function g_(n){return rc(n).replace(rf,"{").replace(sf,"}").replace(nf,"^")}function cu(n){return rc(n).replace(tf,"%2B").replace(m_,"+").replace(ef,"%23").replace(o_,"%26").replace(f_,"`").replace(rf,"{").replace(sf,"}").replace(nf,"^")}function __(n){return cu(n).replace(c_,"%3D")}function y_(n){return rc(n).replace(ef,"%23").replace(l_,"%3F")}function b_(n){return n==null?"":y_(n).replace(u_,"%2F")}function js(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const w_=/\/$/,v_=n=>n.replace(w_,"");function Po(n,e,t="/"){let r,s={},i="",a="";const o=e.indexOf("#");let u=e.indexOf("?");return o<u&&o>=0&&(u=-1),u>-1&&(r=e.slice(0,u),i=e.slice(u+1,o>-1?o:e.length),s=n(i)),o>-1&&(r=r||e.slice(0,o),a=e.slice(o,e.length)),r=O_(r??e,t),{fullPath:r+(i&&"?")+i+a,path:r,query:s,hash:js(a)}}function E_(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Sl(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function A_(n,e,t){const r=e.matched.length-1,s=t.matched.length-1;return r>-1&&r===s&&Ur(e.matched[r],t.matched[s])&&af(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function Ur(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function af(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!x_(n[t],e[t]))return!1;return!0}function x_(n,e){return Nt(n)?Pl(n,e):Nt(e)?Pl(e,n):n===e}function Pl(n,e){return Nt(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function O_(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),s=r[r.length-1];(s===".."||s===".")&&r.push("");let i=t.length-1,a,o;for(a=0;a<r.length;a++)if(o=r[a],o!==".")if(o==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(a).join("/")}const En={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var $s;(function(n){n.pop="pop",n.push="push"})($s||($s={}));var xs;(function(n){n.back="back",n.forward="forward",n.unknown=""})(xs||(xs={}));function S_(n){if(!n)if(Er){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),v_(n)}const P_=/^[^#]+#/;function T_(n,e){return n.replace(P_,"#")+e}function k_(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const Qa=()=>({left:window.scrollX,top:window.scrollY});function C_(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=k_(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Tl(n,e){return(history.state?history.state.position-e:-1)+n}const lu=new Map;function I_(n,e){lu.set(n,e)}function R_(n){const e=lu.get(n);return lu.delete(n),e}let N_=()=>location.protocol+"//"+location.host;function of(n,e){const{pathname:t,search:r,hash:s}=e,i=n.indexOf("#");if(i>-1){let o=s.includes(n.slice(i))?n.slice(i).length:1,u=s.slice(o);return u[0]!=="/"&&(u="/"+u),Sl(u,"")}return Sl(t,n)+r+s}function j_(n,e,t,r){let s=[],i=[],a=null;const o=({state:h})=>{const f=of(n,location),p=t.value,y=e.value;let _=0;if(h){if(t.value=f,e.value=h,a&&a===p){a=null;return}_=y?h.position-y.position:0}else r(f);s.forEach(b=>{b(t.value,p,{delta:_,type:$s.pop,direction:_?_>0?xs.forward:xs.back:xs.unknown})})};function u(){a=t.value}function c(h){s.push(h);const f=()=>{const p=s.indexOf(h);p>-1&&s.splice(p,1)};return i.push(f),f}function l(){const{history:h}=window;h.state&&h.replaceState(le({},h.state,{scroll:Qa()}),"")}function d(){for(const h of i)h();i=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",l)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",l,{passive:!0}),{pauseListeners:u,listen:c,destroy:d}}function kl(n,e,t,r=!1,s=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:s?Qa():null}}function $_(n){const{history:e,location:t}=window,r={value:of(n,t)},s={value:e.state};s.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(u,c,l){const d=n.indexOf("#"),h=d>-1?(t.host&&document.querySelector("base")?n:n.slice(d))+u:N_()+n+u;try{e[l?"replaceState":"pushState"](c,"",h),s.value=c}catch(f){console.error(f),t[l?"replace":"assign"](h)}}function a(u,c){const l=le({},e.state,kl(s.value.back,u,s.value.forward,!0),c,{position:s.value.position});i(u,l,!0),r.value=u}function o(u,c){const l=le({},s.value,e.state,{forward:u,scroll:Qa()});i(l.current,l,!0);const d=le({},kl(r.value,u,null),{position:l.position+1},c);i(u,d,!1),r.value=u}return{location:r,state:s,push:o,replace:a}}function L_(n){n=S_(n);const e=$_(n),t=j_(n,e.state,e.location,e.replace);function r(i,a=!0){a||t.pauseListeners(),history.go(i)}const s=le({location:"",base:n,go:r,createHref:T_.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function M_(n){return typeof n=="string"||n&&typeof n=="object"}function uf(n){return typeof n=="string"||typeof n=="symbol"}const cf=Symbol("");var Cl;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(Cl||(Cl={}));function Br(n,e){return le(new Error,{type:n,[cf]:!0},e)}function tn(n,e){return n instanceof Error&&cf in n&&(e==null||!!(n.type&e))}const Il="[^/]+?",F_={sensitive:!1,strict:!1,start:!0,end:!0},D_=/[.+*?^${}()[\]/\\]/g;function U_(n,e){const t=le({},F_,e),r=[];let s=t.start?"^":"";const i=[];for(const c of n){const l=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let d=0;d<c.length;d++){const h=c[d];let f=40+(t.sensitive?.25:0);if(h.type===0)d||(s+="/"),s+=h.value.replace(D_,"\\$&"),f+=40;else if(h.type===1){const{value:p,repeatable:y,optional:_,regexp:b}=h;i.push({name:p,repeatable:y,optional:_});const E=b||Il;if(E!==Il){f+=10;try{new RegExp(`(${E})`)}catch(L){throw new Error(`Invalid custom RegExp for param "${p}" (${E}): `+L.message)}}let v=y?`((?:${E})(?:/(?:${E}))*)`:`(${E})`;d||(v=_&&c.length<2?`(?:/${v})`:"/"+v),_&&(v+="?"),s+=v,f+=20,_&&(f+=-8),y&&(f+=-20),E===".*"&&(f+=-50)}l.push(f)}r.push(l)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&(s+="(?:/|$)");const a=new RegExp(s,t.sensitive?"":"i");function o(c){const l=c.match(a),d={};if(!l)return null;for(let h=1;h<l.length;h++){const f=l[h]||"",p=i[h-1];d[p.name]=f&&p.repeatable?f.split("/"):f}return d}function u(c){let l="",d=!1;for(const h of n){(!d||!l.endsWith("/"))&&(l+="/"),d=!1;for(const f of h)if(f.type===0)l+=f.value;else if(f.type===1){const{value:p,repeatable:y,optional:_}=f,b=p in c?c[p]:"";if(Nt(b)&&!y)throw new Error(`Provided param "${p}" is an array but it is not repeatable (* or + modifiers)`);const E=Nt(b)?b.join("/"):b;if(!E)if(_)h.length<2&&(l.endsWith("/")?l=l.slice(0,-1):d=!0);else throw new Error(`Missing required param "${p}"`);l+=E}}return l||"/"}return{re:a,score:r,keys:i,parse:o,stringify:u}}function B_(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===80?-1:1:n.length>e.length?e.length===1&&e[0]===80?1:-1:0}function lf(n,e){let t=0;const r=n.score,s=e.score;for(;t<r.length&&t<s.length;){const i=B_(r[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-r.length)===1){if(Rl(r))return 1;if(Rl(s))return-1}return s.length-r.length}function Rl(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const z_={type:0,value:""},H_=/[a-zA-Z0-9_]/;function Z_(n){if(!n)return[[]];if(n==="/")return[[z_]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(f){throw new Error(`ERR (${t})/"${c}": ${f}`)}let t=0,r=t;const s=[];let i;function a(){i&&s.push(i),i=[]}let o=0,u,c="",l="";function d(){c&&(t===0?i.push({type:0,value:c}):t===1||t===2||t===3?(i.length>1&&(u==="*"||u==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:c,regexp:l,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):e("Invalid state to consume buffer"),c="")}function h(){c+=u}for(;o<n.length;){if(u=n[o++],u==="\\"&&t!==2){r=t,t=4;continue}switch(t){case 0:u==="/"?(c&&d(),a()):u===":"?(d(),t=1):h();break;case 4:h(),t=r;break;case 1:u==="("?t=2:H_.test(u)?h():(d(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&o--);break;case 2:u===")"?l[l.length-1]=="\\"?l=l.slice(0,-1)+u:t=3:l+=u;break;case 3:d(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&o--,l="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),d(),a(),s}function V_(n,e,t){const r=U_(Z_(n.path),t),s=le(r,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function q_(n,e){const t=[],r=new Map;e=$l({strict:!1,end:!0,sensitive:!1},e);function s(d){return r.get(d)}function i(d,h,f){const p=!f,y=W_(d);y.aliasOf=f&&f.record;const _=$l(e,d),b=[y];if("alias"in d){const L=typeof d.alias=="string"?[d.alias]:d.alias;for(const U of L)b.push(le({},y,{components:f?f.record.components:y.components,path:U,aliasOf:f?f.record:y}))}let E,v;for(const L of b){const{path:U}=L;if(h&&U[0]!=="/"){const R=h.record.path,q=R[R.length-1]==="/"?"":"/";L.path=h.record.path+(U&&q+U)}if(E=V_(L,h,_),f?f.alias.push(E):(v=v||E,v!==E&&v.alias.push(E),p&&d.name&&!jl(E)&&a(d.name)),df(E)&&u(E),y.children){const R=y.children;for(let q=0;q<R.length;q++)i(R[q],E,f&&f.children[q])}f=f||E}return v?()=>{a(v)}:As}function a(d){if(uf(d)){const h=r.get(d);h&&(r.delete(d),t.splice(t.indexOf(h),1),h.children.forEach(a),h.alias.forEach(a))}else{const h=t.indexOf(d);h>-1&&(t.splice(h,1),d.record.name&&r.delete(d.record.name),d.children.forEach(a),d.alias.forEach(a))}}function o(){return t}function u(d){const h=G_(d,t);t.splice(h,0,d),d.record.name&&!jl(d)&&r.set(d.record.name,d)}function c(d,h){let f,p={},y,_;if("name"in d&&d.name){if(f=r.get(d.name),!f)throw Br(1,{location:d});_=f.record.name,p=le(Nl(h.params,f.keys.filter(v=>!v.optional).concat(f.parent?f.parent.keys.filter(v=>v.optional):[]).map(v=>v.name)),d.params&&Nl(d.params,f.keys.map(v=>v.name))),y=f.stringify(p)}else if(d.path!=null)y=d.path,f=t.find(v=>v.re.test(y)),f&&(p=f.parse(y),_=f.record.name);else{if(f=h.name?r.get(h.name):t.find(v=>v.re.test(h.path)),!f)throw Br(1,{location:d,currentLocation:h});_=f.record.name,p=le({},h.params,d.params),y=f.stringify(p)}const b=[];let E=f;for(;E;)b.unshift(E.record),E=E.parent;return{name:_,path:y,params:p,matched:b,meta:J_(b)}}n.forEach(d=>i(d));function l(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:a,clearRoutes:l,getRoutes:o,getRecordMatcher:s}}function Nl(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function W_(n){return{path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:void 0,beforeEnter:n.beforeEnter,props:K_(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}}}function K_(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function jl(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function J_(n){return n.reduce((e,t)=>le(e,t.meta),{})}function $l(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}function G_(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;lf(n,e[i])<0?r=i:t=i+1}const s=X_(n);return s&&(r=e.lastIndexOf(s,r-1)),r}function X_(n){let e=n;for(;e=e.parent;)if(df(e)&&lf(n,e)===0)return e}function df({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function Q_(n){const e={};if(n===""||n==="?")return e;const r=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<r.length;++s){const i=r[s].replace(tf," "),a=i.indexOf("="),o=js(a<0?i:i.slice(0,a)),u=a<0?null:js(i.slice(a+1));if(o in e){let c=e[o];Nt(c)||(c=e[o]=[c]),c.push(u)}else e[o]=u}return e}function Ll(n){let e="";for(let t in n){const r=n[t];if(t=__(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Nt(r)?r.map(i=>i&&cu(i)):[r&&cu(r)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function Y_(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Nt(r)?r.map(s=>s==null?null:""+s):r==null?r:""+r)}return e}const ey=Symbol(""),Ml=Symbol(""),sc=Symbol(""),hf=Symbol(""),du=Symbol("");function ts(){let n=[];function e(r){return n.push(r),()=>{const s=n.indexOf(r);s>-1&&n.splice(s,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Pn(n,e,t,r,s,i=a=>a()){const a=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise((o,u)=>{const c=h=>{h===!1?u(Br(4,{from:t,to:e})):h instanceof Error?u(h):M_(h)?u(Br(2,{from:e,to:h})):(a&&r.enterCallbacks[s]===a&&typeof h=="function"&&a.push(h),o())},l=i(()=>n.call(r&&r.instances[s],e,t,c));let d=Promise.resolve(l);n.length<3&&(d=d.then(c)),d.catch(h=>u(h))})}function To(n,e,t,r,s=i=>i()){const i=[];for(const a of n)for(const o in a.components){let u=a.components[o];if(!(e!=="beforeRouteEnter"&&!a.instances[o]))if(ty(u)){const l=(u.__vccOpts||u)[e];l&&i.push(Pn(l,t,r,a,o,s))}else{let c=u();i.push(()=>c.then(l=>{if(!l)return Promise.reject(new Error(`Couldn't resolve component "${o}" at "${a.path}"`));const d=a_(l)?l.default:l;a.components[o]=d;const f=(d.__vccOpts||d)[e];return f&&Pn(f,t,r,a,o,s)()}))}}return i}function ty(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function Fl(n){const e=pn(sc),t=pn(hf),r=Tt(()=>{const u=tr(n.to);return e.resolve(u)}),s=Tt(()=>{const{matched:u}=r.value,{length:c}=u,l=u[c-1],d=t.matched;if(!l||!d.length)return-1;const h=d.findIndex(Ur.bind(null,l));if(h>-1)return h;const f=Dl(u[c-2]);return c>1&&Dl(l)===f&&d[d.length-1].path!==f?d.findIndex(Ur.bind(null,u[c-2])):h}),i=Tt(()=>s.value>-1&&iy(t.params,r.value.params)),a=Tt(()=>s.value>-1&&s.value===t.matched.length-1&&af(t.params,r.value.params));function o(u={}){return sy(u)?e[tr(n.replace)?"replace":"push"](tr(n.to)).catch(As):Promise.resolve()}return{route:r,href:Tt(()=>r.value.href),isActive:i,isExactActive:a,navigate:o}}const ny=Ph({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Fl,setup(n,{slots:e}){const t=Za(Fl(n)),{options:r}=pn(sc),s=Tt(()=>({[Ul(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[Ul(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&e.default(t);return n.custom?i:Yh("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),ry=ny;function sy(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function iy(n,e){for(const t in e){const r=e[t],s=n[t];if(typeof r=="string"){if(r!==s)return!1}else if(!Nt(s)||s.length!==r.length||r.some((i,a)=>i!==s[a]))return!1}return!0}function Dl(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const Ul=(n,e,t)=>n??e??t,ay=Ph({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=pn(du),s=Tt(()=>n.route||r.value),i=pn(Ml,0),a=Tt(()=>{let c=tr(i);const{matched:l}=s.value;let d;for(;(d=l[c])&&!d.components;)c++;return c}),o=Tt(()=>s.value.matched[a.value]);Ti(Ml,Tt(()=>a.value+1)),Ti(ey,o),Ti(du,s);const u=cn();return vs(()=>[u.value,o.value,n.name],([c,l,d],[h,f,p])=>{l&&(l.instances[d]=c,f&&f!==l&&c&&c===h&&(l.leaveGuards.size||(l.leaveGuards=f.leaveGuards),l.updateGuards.size||(l.updateGuards=f.updateGuards))),c&&l&&(!f||!Ur(l,f)||!h)&&(l.enterCallbacks[d]||[]).forEach(y=>y(c))},{flush:"post"}),()=>{const c=s.value,l=n.name,d=o.value,h=d&&d.components[l];if(!h)return Bl(t.default,{Component:h,route:c});const f=d.props[l],p=f?f===!0?c.params:typeof f=="function"?f(c):f:null,_=Yh(h,le({},p,e,{onVnodeUnmounted:b=>{b.component.isUnmounted&&(d.instances[l]=null)},ref:u}));return Bl(t.default,{Component:_,route:c})||_}}});function Bl(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const ff=ay;function oy(n){const e=q_(n.routes,n),t=n.parseQuery||Q_,r=n.stringifyQuery||Ll,s=n.history,i=ts(),a=ts(),o=ts(),u=_m(En);let c=En;Er&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const l=So.bind(null,x=>""+x),d=So.bind(null,b_),h=So.bind(null,js);function f(x,F){let j,B;return uf(x)?(j=e.getRecordMatcher(x),B=F):B=x,e.addRoute(B,j)}function p(x){const F=e.getRecordMatcher(x);F&&e.removeRoute(F)}function y(){return e.getRoutes().map(x=>x.record)}function _(x){return!!e.getRecordMatcher(x)}function b(x,F){if(F=le({},F||u.value),typeof x=="string"){const g=Po(t,x,F.path),w=e.resolve({path:g.path},F),O=s.createHref(g.fullPath);return le(g,w,{params:h(w.params),hash:js(g.hash),redirectedFrom:void 0,href:O})}let j;if(x.path!=null)j=le({},x,{path:Po(t,x.path,F.path).path});else{const g=le({},x.params);for(const w in g)g[w]==null&&delete g[w];j=le({},x,{params:d(g)}),F.params=d(F.params)}const B=e.resolve(j,F),ce=x.hash||"";B.params=l(h(B.params));const we=E_(r,le({},x,{hash:g_(ce),path:B.path})),m=s.createHref(we);return le({fullPath:we,hash:ce,query:r===Ll?Y_(x.query):x.query||{}},B,{redirectedFrom:void 0,href:m})}function E(x){return typeof x=="string"?Po(t,x,u.value.path):le({},x)}function v(x,F){if(c!==x)return Br(8,{from:F,to:x})}function L(x){return q(x)}function U(x){return L(le(E(x),{replace:!0}))}function R(x){const F=x.matched[x.matched.length-1];if(F&&F.redirect){const{redirect:j}=F;let B=typeof j=="function"?j(x):j;return typeof B=="string"&&(B=B.includes("?")||B.includes("#")?B=E(B):{path:B},B.params={}),le({query:x.query,hash:x.hash,params:B.path!=null?{}:x.params},B)}}function q(x,F){const j=c=b(x),B=u.value,ce=x.state,we=x.force,m=x.replace===!0,g=R(j);if(g)return q(le(E(g),{state:typeof g=="object"?le({},ce,g.state):ce,force:we,replace:m}),F||j);const w=j;w.redirectedFrom=F;let O;return!we&&A_(r,B,j)&&(O=Br(16,{to:w,from:B}),Ft(B,B,!0,!1)),(O?Promise.resolve(O):Me(w,B)).catch(A=>tn(A)?tn(A,2)?A:bn(A):ae(A,w,B)).then(A=>{if(A){if(tn(A,2))return q(le({replace:m},E(A.to),{state:typeof A.to=="object"?le({},ce,A.to.state):ce,force:we}),F||w)}else A=Zn(w,B,!0,m,ce);return yn(w,B,A),A})}function Ae(x,F){const j=v(x,F);return j?Promise.reject(j):Promise.resolve()}function me(x){const F=_r.values().next().value;return F&&typeof F.runWithContext=="function"?F.runWithContext(x):x()}function Me(x,F){let j;const[B,ce,we]=uy(x,F);j=To(B.reverse(),"beforeRouteLeave",x,F);for(const g of B)g.leaveGuards.forEach(w=>{j.push(Pn(w,x,F))});const m=Ae.bind(null,x,F);return j.push(m),dt(j).then(()=>{j=[];for(const g of i.list())j.push(Pn(g,x,F));return j.push(m),dt(j)}).then(()=>{j=To(ce,"beforeRouteUpdate",x,F);for(const g of ce)g.updateGuards.forEach(w=>{j.push(Pn(w,x,F))});return j.push(m),dt(j)}).then(()=>{j=[];for(const g of we)if(g.beforeEnter)if(Nt(g.beforeEnter))for(const w of g.beforeEnter)j.push(Pn(w,x,F));else j.push(Pn(g.beforeEnter,x,F));return j.push(m),dt(j)}).then(()=>(x.matched.forEach(g=>g.enterCallbacks={}),j=To(we,"beforeRouteEnter",x,F,me),j.push(m),dt(j))).then(()=>{j=[];for(const g of a.list())j.push(Pn(g,x,F));return j.push(m),dt(j)}).catch(g=>tn(g,8)?g:Promise.reject(g))}function yn(x,F,j){o.list().forEach(B=>me(()=>B(x,F,j)))}function Zn(x,F,j,B,ce){const we=v(x,F);if(we)return we;const m=F===En,g=Er?history.state:{};j&&(B||m?s.replace(x.fullPath,le({scroll:m&&g&&g.scroll},ce)):s.push(x.fullPath,ce)),u.value=x,Ft(x,F,j,m),bn()}let Mt;function Qr(){Mt||(Mt=s.listen((x,F,j)=>{if(!ci.listening)return;const B=b(x),ce=R(B);if(ce){q(le(ce,{replace:!0}),B).catch(As);return}c=B;const we=u.value;Er&&I_(Tl(we.fullPath,j.delta),Qa()),Me(B,we).catch(m=>tn(m,12)?m:tn(m,2)?(q(m.to,B).then(g=>{tn(g,20)&&!j.delta&&j.type===$s.pop&&s.go(-1,!1)}).catch(As),Promise.reject()):(j.delta&&s.go(-j.delta,!1),ae(m,B,we))).then(m=>{m=m||Zn(B,we,!1),m&&(j.delta&&!tn(m,8)?s.go(-j.delta,!1):j.type===$s.pop&&tn(m,20)&&s.go(-1,!1)),yn(B,we,m)}).catch(As)}))}let mr=ts(),ke=ts(),pe;function ae(x,F,j){bn(x);const B=ke.list();return B.length?B.forEach(ce=>ce(x,F,j)):console.error(x),Promise.reject(x)}function en(){return pe&&u.value!==En?Promise.resolve():new Promise((x,F)=>{mr.add([x,F])})}function bn(x){return pe||(pe=!x,Qr(),mr.list().forEach(([F,j])=>x?j(x):F()),mr.reset()),x}function Ft(x,F,j,B){const{scrollBehavior:ce}=n;if(!Er||!ce)return Promise.resolve();const we=!j&&R_(Tl(x.fullPath,0))||(B||!j)&&history.state&&history.state.scroll||null;return wh().then(()=>ce(x,F,we)).then(m=>m&&C_(m)).catch(m=>ae(m,x,F))}const Ge=x=>s.go(x);let gr;const _r=new Set,ci={currentRoute:u,listening:!0,addRoute:f,removeRoute:p,clearRoutes:e.clearRoutes,hasRoute:_,getRoutes:y,resolve:b,options:n,push:L,replace:U,go:Ge,back:()=>Ge(-1),forward:()=>Ge(1),beforeEach:i.add,beforeResolve:a.add,afterEach:o.add,onError:ke.add,isReady:en,install(x){const F=this;x.component("RouterLink",ry),x.component("RouterView",ff),x.config.globalProperties.$router=F,Object.defineProperty(x.config.globalProperties,"$route",{enumerable:!0,get:()=>tr(u)}),Er&&!gr&&u.value===En&&(gr=!0,L(s.location).catch(ce=>{}));const j={};for(const ce in En)Object.defineProperty(j,ce,{get:()=>u.value[ce],enumerable:!0});x.provide(sc,F),x.provide(hf,dh(j)),x.provide(du,u);const B=x.unmount;_r.add(x),x.unmount=function(){_r.delete(x),_r.size<1&&(c=En,Mt&&Mt(),Mt=null,u.value=En,gr=!1,pe=!1),B()}}};function dt(x){return x.reduce((F,j)=>F.then(()=>me(j)),Promise.resolve())}return ci}function uy(n,e){const t=[],r=[],s=[],i=Math.max(e.matched.length,n.matched.length);for(let a=0;a<i;a++){const o=e.matched[a];o&&(n.matched.find(c=>Ur(c,o))?r.push(o):t.push(o));const u=n.matched[a];u&&(e.matched.find(c=>Ur(c,u))||s.push(u))}return[t,r,s]}const cy={__name:"App",setup(n){return(e,t)=>(St(),Jh(tr(ff)))}},ly="modulepreload",dy=function(n){return"/rag-demo/"+n},zl={},hy=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.all(t.map(o=>{if(o=dy(o),o in zl)return;zl[o]=!0;const u=o.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${c}`))return;const l=document.createElement("link");if(l.rel=u?"stylesheet":ly,u||(l.as="script",l.crossOrigin=""),l.href=o,a&&l.setAttribute("nonce",a),document.head.appendChild(l),u)return new Promise((d,h)=>{l.addEventListener("load",d),l.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${o}`)))})}))}return s.then(()=>e()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})},Ar="4.53.2";let Hl=!1,Os,pf,mf,hu,gf,_f,yf,bf,wf;function fy(n,e={auto:!1}){if(Hl)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Os)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Os}'\``);Hl=e.auto,Os=n.kind,pf=n.fetch,mf=n.FormData,hu=n.File,gf=n.ReadableStream,_f=n.getMultipartRequestOptions,yf=n.getDefaultAgent,bf=n.fileFromPath,wf=n.isFsReadStream}class py{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function my({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import … from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new py(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Os||fy(my(),{auto:!0});class Wt{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of gy(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(o&&o.error)throw new We(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(a.event=="error")throw new We(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Wt(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new ur,o=vf(e);for await(const u of o)for(const c of a.decode(u))yield c;for(const u of a.flush())yield u}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Wt(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Wt(()=>s(e),this.controller),new Wt(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new gf({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*gy(n,e){if(!n.body)throw e.abort(),new ne("Attempted to iterate over a response with no body");const t=new by,r=new ur,s=vf(n.body);for await(const i of _y(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*_y(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=yy(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function yy(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class by{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=wy(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}class ur{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=ur.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(ur.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ne(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ne(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ne("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}ur.NEWLINE_CHARS=new Set([`
`,"\r"]);ur.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function wy(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function vf(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Ef=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Af=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&ic(n),ic=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",vy=n=>Af(n)||Ef(n)||wf(n);async function xf(n,e,t){var s;if(n=await n,t??(t=Af(n)?{lastModified:n.lastModified,type:n.type}:{}),Ef(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new hu([i],e,t)}const r=await Ey(n);if(e||(e=xy(n)??"unknown_file"),!t.type){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new hu(r,e,t)}async function Ey(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(ic(n))e.push(await n.arrayBuffer());else if(Oy(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Ay(n)}`);return e}function Ay(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function xy(n){var e;return ko(n.name)||ko(n.filename)||((e=ko(n.path))==null?void 0:e.split(/[\\/]/).pop())}const ko=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Oy=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Zl=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",zr=async n=>{const e=await Sy(n.body);return _f(e,n)},Sy=async n=>{const e=new mf;return await Promise.all(Object.entries(n||{}).map(([t,r])=>fu(e,t,r))),e},fu=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(vy(t)){const r=await xf(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>fu(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>fu(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Nr={},Py=function(n,e,t,r,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t},Ty=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},gi;async function Of(n){const{response:e}=n;if(n.options.stream)return jr("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Wt.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return jr("response",e.status,e.url,e.headers,i),i}const s=await e.text();return jr("response",e.status,e.url,e.headers,s),s}class Ya extends Promise{constructor(e,t=Of){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Ya(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ky{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Co("maxRetries",t),this.timeout=Co("timeout",r),this.httpAgent=s,this.fetch=i??pf}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...$y(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Dy()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&ic(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){var p;const{method:t,path:r,query:s,headers:i={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Zl(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(a),u=this.buildURL(r,s);"timeout"in e&&Co("timeout",e.timeout);const c=e.timeout??this.timeout,l=e.httpAgent??this.httpAgent??yf(u),d=c+1e3;typeof((p=l==null?void 0:l.options)==null?void 0:p.timeout)=="number"&&d>(l.options.timeout??0)&&(l.options.timeout=d),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const h=this.buildHeaders({options:e,headers:i,contentLength:o});return{req:{method:t,...a&&{body:a},headers:h,...l&&{agent:l},signal:e.signal??null},url:u,timeout:c}}buildHeaders({options:e,headers:t,contentLength:r}){const s={};r&&(s["content-length"]=r);const i=this.defaultHeaders(e);return Kl(s,i),Kl(s,t),Zl(e.body)&&Os!=="node"&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return We.generate(e,t,r,s)}request(e,t=null){return new Ya(this.makeRequest(e,t))}async makeRequest(e,t){var l,d;const r=await e;t==null&&(t=r.maxRetries??this.maxRetries),await this.prepareOptions(r);const{req:s,url:i,timeout:a}=this.buildRequest(r);if(await this.prepareRequest(s,{url:i,options:r}),jr("request",i,r,s.headers),(l=r.signal)!=null&&l.aborted)throw new et;const o=new AbortController,u=await this.fetchWithTimeout(i,s,a,o).catch(pu);if(u instanceof Error){if((d=r.signal)!=null&&d.aborted)throw new et;if(t)return this.retryRequest(r,t);throw u.name==="AbortError"?new eo:new ti({cause:u})}const c=Iy(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){const b=`retrying, ${t} attempts remaining`;return jr(`response (error; ${b})`,u.status,i,c),this.retryRequest(r,t,c)}const h=await u.text().catch(b=>pu(b).message),f=Ly(h),p=f?void 0:h;throw jr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,c,p),this.makeStatusError(u.status,f,p,c)}return{response:u,options:r,controller:o}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Cy(this,r,e)}buildURL(e,t){const r=Fy(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Pf(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new ne(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await ei(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ar}`}}class Sf{constructor(e,t,r,s){gi.set(this,void 0),Py(this,gi,e),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ne("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Ty(this,gi,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(gi=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Cy extends Ya{constructor(e,t,r){super(t,async s=>new r(e,s.response,await Of(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Iy=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Ry={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ct=n=>typeof n=="object"&&n!==null&&!Pf(n)&&Object.keys(n).every(e=>Tf(Ry,e)),Ny=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":ql(Deno.build.os),"X-Stainless-Arch":Vl(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":ql(process.platform),"X-Stainless-Arch":Vl(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=jy();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ar,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function jy(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Vl=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",ql=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Wl;const $y=()=>Wl??(Wl=Ny()),Ly=n=>{try{return JSON.parse(n)}catch{return}},My=new RegExp("^(?:[a-z]+:)?//","i"),Fy=n=>My.test(n),ei=n=>new Promise(e=>setTimeout(e,n)),Co=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ne(`${n} must be an integer`);if(e<0)throw new ne(`${n} must be a positive integer`);return e},pu=n=>n instanceof Error?n:new Error(n),_i=n=>{var e,t,r,s;if(typeof process<"u")return((e=Nr==null?void 0:Nr[n])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(r=(t=Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:s.trim()};function Pf(n){if(!n)return!0;for(const e in n)return!1;return!0}function Tf(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Kl(n,e){for(const t in e){if(!Tf(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function jr(n,...e){typeof process<"u"&&(Nr==null?void 0:Nr.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}const Dy=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Uy=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Jl(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}let ne=class extends Error{},We=class mu extends ne{constructor(e,t,r,s){super(`${mu.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"];const i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e)return new ti({cause:pu(t)});const i=t==null?void 0:t.error;return e===400?new ac(e,i,r,s):e===401?new oc(e,i,r,s):e===403?new uc(e,i,r,s):e===404?new cc(e,i,r,s):e===409?new lc(e,i,r,s):e===422?new dc(e,i,r,s):e===429?new hc(e,i,r,s):e>=500?new fc(e,i,r,s):new mu(e,i,r,s)}},et=class extends We{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},ti=class extends We{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},eo=class extends ti{constructor({message:e}={}){super({message:e??"Request timed out."})}},ac=class extends We{constructor(){super(...arguments),this.status=400}},oc=class extends We{constructor(){super(...arguments),this.status=401}},uc=class extends We{constructor(){super(...arguments),this.status=403}},cc=class extends We{constructor(){super(...arguments),this.status=404}},lc=class extends We{constructor(){super(...arguments),this.status=409}},dc=class extends We{constructor(){super(...arguments),this.status=422}},hc=class extends We{constructor(){super(...arguments),this.status=429}},fc=class extends We{};const By=Object.freeze(Object.defineProperty({__proto__:null,APIConnectionError:ti,APIConnectionTimeoutError:eo,APIError:We,APIUserAbortError:et,AuthenticationError:oc,BadRequestError:ac,ConflictError:lc,InternalServerError:fc,NotFoundError:cc,OpenAIError:ne,PermissionDeniedError:uc,RateLimitError:hc,UnprocessableEntityError:dc},Symbol.toStringTag,{value:"Module"}));class pc extends Sf{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Lt extends Sf{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}class fe{constructor(e){this._client=e}}let Ki=class extends fe{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}};Ki||(Ki={});let Ji=class extends fe{constructor(){super(...arguments),this.completions=new Ki(this._client)}};(function(n){n.Completions=Ki})(Ji||(Ji={}));class Gi extends fe{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}Gi||(Gi={});class Xi extends fe{create(e,t){return this._client.post("/audio/transcriptions",zr({body:e,...t}))}}Xi||(Xi={});class Qi extends fe{create(e,t){return this._client.post("/audio/translations",zr({body:e,...t}))}}Qi||(Qi={});class Yi extends fe{constructor(){super(...arguments),this.transcriptions=new Xi(this._client),this.translations=new Qi(this._client),this.speech=new Gi(this._client)}}(function(n){n.Transcriptions=Xi,n.Translations=Qi,n.Speech=Gi})(Yi||(Yi={}));class ea extends fe{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return ct(e)?this.list({},e):this._client.getAPIList("/batches",mc,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class mc extends Lt{}(function(n){n.BatchesPage=mc})(ea||(ea={}));class ta extends fe{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return ct(e)?this.list({},e):this._client.getAPIList("/assistants",gc,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class gc extends Lt{}(function(n){n.AssistantsPage=gc})(ta||(ta={}));function Gl(n){return typeof n.parse=="function"}const $r=n=>(n==null?void 0:n.role)==="assistant",kf=n=>(n==null?void 0:n.role)==="function",Cf=n=>(n==null?void 0:n.role)==="tool";var yt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},te=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Fe,Ri,Ni,ss,is,ji,as,an,os,$i,Li,xr,gu,na,_u,yu,bu,wu,If,vu;const Xl=10;class Rf{constructor(){Fe.add(this),this.controller=new AbortController,Ri.set(this,void 0),Ni.set(this,()=>{}),ss.set(this,()=>{}),is.set(this,void 0),ji.set(this,()=>{}),as.set(this,()=>{}),an.set(this,{}),this._chatCompletions=[],this.messages=[],os.set(this,!1),$i.set(this,!1),Li.set(this,!1),xr.set(this,!1),wu.set(this,e=>{if(yt(this,$i,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new et),e instanceof et)return yt(this,Li,!0,"f"),this._emit("abort",e);if(e instanceof ne)return this._emit("error",e);if(e instanceof Error){const t=new ne(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ne(String(e)))}),yt(this,Ri,new Promise((e,t)=>{yt(this,Ni,e,"f"),yt(this,ss,t,"f")}),"f"),yt(this,is,new Promise((e,t)=>{yt(this,ji,e,"f"),yt(this,as,t,"f")}),"f"),te(this,Ri,"f").catch(()=>{}),te(this,is,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},te(this,wu,"f"))},0)}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(kf(e)||Cf(e))&&e.content)this._emit("functionCallResult",e.content);else if($r(e)&&e.function_call)this._emit("functionCall",e.function_call);else if($r(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}_connected(){this.ended||(te(this,Ni,"f").call(this),this._emit("connect"))}get ended(){return te(this,os,"f")}get errored(){return te(this,$i,"f")}get aborted(){return te(this,Li,"f")}abort(){this.controller.abort()}on(e,t){return(te(this,an,"f")[e]||(te(this,an,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=te(this,an,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(te(this,an,"f")[e]||(te(this,an,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{yt(this,xr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){yt(this,xr,!0,"f"),await te(this,is,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ne("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),te(this,Fe,"m",gu).call(this)}async finalMessage(){return await this.done(),te(this,Fe,"m",na).call(this)}async finalFunctionCall(){return await this.done(),te(this,Fe,"m",_u).call(this)}async finalFunctionCallResult(){return await this.done(),te(this,Fe,"m",yu).call(this)}async totalUsage(){return await this.done(),te(this,Fe,"m",bu).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(te(this,os,"f"))return;e==="end"&&(yt(this,os,!0,"f"),te(this,ji,"f").call(this));const r=te(this,an,"f")[e];if(r&&(te(this,an,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!te(this,xr,"f")&&!(r!=null&&r.length)&&Promise.reject(s),te(this,ss,"f").call(this,s),te(this,as,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!te(this,xr,"f")&&!(r!=null&&r.length)&&Promise.reject(s),te(this,ss,"f").call(this,s),te(this,as,"f").call(this,s),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=te(this,Fe,"m",na).call(this);t&&this._emit("finalMessage",t);const r=te(this,Fe,"m",gu).call(this);r&&this._emit("finalContent",r);const s=te(this,Fe,"m",_u).call(this);s&&this._emit("finalFunctionCall",s);const i=te(this,Fe,"m",yu).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",te(this,Fe,"m",bu).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),te(this,Fe,"m",If).call(this,t);const i=await e.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var h;const s="function",{function_call:i="auto",stream:a,...o}=t,u=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=Xl}=r||{},l={};for(const f of t.functions)l[f.name||f.function.name]=f;const d=t.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const f of t.messages)this._addMessage(f,!1);for(let f=0;f<c;++f){const y=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:h.message;if(!y)throw new ne("missing message in ChatCompletion response");if(!y.function_call)return;const{name:_,arguments:b}=y.function_call,E=l[_];if(E){if(u&&u!==_){const R=`Invalid function_call: ${JSON.stringify(_)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:_,content:R});continue}}else{const R=`Invalid function_call: ${JSON.stringify(_)}. Available options are: ${d.map(q=>JSON.stringify(q.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:_,content:R});continue}let v;try{v=Gl(E)?await E.parse(b):b}catch(R){this._addMessage({role:s,name:_,content:R instanceof Error?R.message:String(R)});continue}const L=await E.function(v,this),U=te(this,Fe,"m",vu).call(this,L);if(this._addMessage({role:s,name:_,content:U}),u)return}}async _runTools(e,t,r){var h,f;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&((h=i==null?void 0:i.function)==null?void 0:h.name),{maxChatCompletions:c=Xl}=r||{},l={};for(const p of t.tools)p.type==="function"&&(l[p.function.name||p.function.function.name]=p.function);const d="tools"in t?t.tools.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description}}:p):void 0;for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){const _=(f=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!_)throw new ne("missing message in ChatCompletion response");if(!_.tool_calls)return;for(const b of _.tool_calls){if(b.type!=="function")continue;const E=b.id,{name:v,arguments:L}=b.function,U=l[v];if(U){if(u&&u!==v){const me=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:E,content:me});continue}}else{const me=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${d.map(Me=>JSON.stringify(Me.function.name)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:E,content:me});continue}let R;try{R=Gl(U)?await U.parse(L):L}catch(me){const Me=me instanceof Error?me.message:String(me);this._addMessage({role:s,tool_call_id:E,content:Me});continue}const q=await U.function(R,this),Ae=te(this,Fe,"m",vu).call(this,q);if(this._addMessage({role:s,tool_call_id:E,content:Ae}),u)return}}}}Ri=new WeakMap,Ni=new WeakMap,ss=new WeakMap,is=new WeakMap,ji=new WeakMap,as=new WeakMap,an=new WeakMap,os=new WeakMap,$i=new WeakMap,Li=new WeakMap,xr=new WeakMap,wu=new WeakMap,Fe=new WeakSet,gu=function(){return te(this,Fe,"m",na).call(this).content??null},na=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if($r(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null};return r&&(i.function_call=r),i}}throw new ne("stream ended without producing a ChatCompletionMessage with role=assistant")},_u=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if($r(s)&&(s!=null&&s.function_call))return s.function_call;if($r(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},yu=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(kf(t)&&t.content!=null||Cf(t)&&t.content!=null&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},bu=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},If=function(e){if(e.n!=null&&e.n>1)throw new ne("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},vu=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Ls extends Rf{static runFunctions(e,t,r){const s=new Ls,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new Ls,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e){super._addMessage(e),$r(e)&&e.content&&this._emit("content",e.content)}}var bt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Io=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Bt,An,Ro,No,yi,Ql;class Ms extends Rf{constructor(){super(...arguments),Bt.add(this),An.set(this,void 0)}get currentChatCompletionSnapshot(){return bt(this,An,"f")}static fromReadableStream(e){const t=new Ms;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new Ms;return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),bt(this,Bt,"m",Ro).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)bt(this,Bt,"m",No).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new et;return this._addChatCompletion(bt(this,Bt,"m",yi).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),bt(this,Bt,"m",Ro).call(this),this._connected();const s=Wt.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(bt(this,Bt,"m",yi).call(this)),bt(this,Bt,"m",No).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new et;return this._addChatCompletion(bt(this,Bt,"m",yi).call(this))}[(An=new WeakMap,Bt=new WeakSet,Ro=function(){this.ended||Io(this,An,void 0,"f")},No=function(t){var a,o,u;if(this.ended)return;const r=bt(this,Bt,"m",Ql).call(this,t);this._emit("chunk",t,r);const s=(o=(a=t.choices[0])==null?void 0:a.delta)==null?void 0:o.content,i=(u=r.choices[0])==null?void 0:u.message;s!=null&&(i==null?void 0:i.role)==="assistant"&&(i!=null&&i.content)&&this._emit("content",s,i.content)},yi=function(){if(this.ended)throw new ne("stream has ended, this shouldn't happen");const t=bt(this,An,"f");if(!t)throw new ne("request ended without sending any chunks");return Io(this,An,void 0,"f"),zy(t)},Ql=function(t){var r,s,i;let a=bt(this,An,"f");const{choices:o,...u}=t;a?Object.assign(a,u):a=Io(this,An,{...u,choices:[]},"f");for(const{delta:c,finish_reason:l,index:d,logprobs:h=null,...f}of t.choices){let p=a.choices[d];if(p||(p=a.choices[d]={finish_reason:l,index:d,message:{},logprobs:h,...f}),h)if(!p.logprobs)p.logprobs=Object.assign({},h);else{const{content:L,...U}=h;Object.assign(p.logprobs,U),L&&((r=p.logprobs).content??(r.content=[]),p.logprobs.content.push(...L))}if(l&&(p.finish_reason=l),Object.assign(p,f),!c)continue;const{content:y,function_call:_,role:b,tool_calls:E,...v}=c;if(Object.assign(p.message,v),y&&(p.message.content=(p.message.content||"")+y),b&&(p.message.role=b),_&&(p.message.function_call?(_.name&&(p.message.function_call.name=_.name),_.arguments&&((s=p.message.function_call).arguments??(s.arguments=""),p.message.function_call.arguments+=_.arguments)):p.message.function_call=_),E){p.message.tool_calls||(p.message.tool_calls=[]);for(const{index:L,id:U,type:R,function:q,...Ae}of E){const me=(i=p.message.tool_calls)[L]??(i[L]={});Object.assign(me,Ae),U&&(me.id=U),R&&(me.type=R),q&&(me.function??(me.function={arguments:""})),q!=null&&q.name&&(me.function.name=q.name),q!=null&&q.arguments&&(me.function.arguments+=q.arguments)}}}return a},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Wt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function zy(n){const{id:e,choices:t,created:r,model:s,system_fingerprint:i,...a}=n;return{...a,id:e,choices:t.map(({message:o,finish_reason:u,index:c,logprobs:l,...d})=>{if(!u)throw new ne(`missing finish_reason for choice ${c}`);const{content:h=null,function_call:f,tool_calls:p,...y}=o,_=o.role;if(!_)throw new ne(`missing role for choice ${c}`);if(f){const{arguments:b,name:E}=f;if(b==null)throw new ne(`missing function_call.arguments for choice ${c}`);if(!E)throw new ne(`missing function_call.name for choice ${c}`);return{...d,message:{content:h,function_call:{arguments:b,name:E},role:_},finish_reason:u,index:c,logprobs:l}}return p?{...d,index:c,finish_reason:u,logprobs:l,message:{...y,role:_,content:h,tool_calls:p.map((b,E)=>{const{function:v,type:L,id:U,...R}=b,{arguments:q,name:Ae,...me}=v||{};if(U==null)throw new ne(`missing choices[${c}].tool_calls[${E}].id
${bi(n)}`);if(L==null)throw new ne(`missing choices[${c}].tool_calls[${E}].type
${bi(n)}`);if(Ae==null)throw new ne(`missing choices[${c}].tool_calls[${E}].function.name
${bi(n)}`);if(q==null)throw new ne(`missing choices[${c}].tool_calls[${E}].function.arguments
${bi(n)}`);return{...R,id:U,type:L,function:{...me,name:Ae,arguments:q}}})}}:{...d,message:{...y,content:h,role:_},finish_reason:u,index:c,logprobs:l}}),created:r,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}}}function bi(n){return JSON.stringify(n)}class Lr extends Ms{static fromReadableStream(e){const t=new Lr;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new Lr,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new Lr,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let Nf=class extends fe{runFunctions(e,t){return e.stream?Lr.runFunctions(this._client.chat.completions,e,t):Ls.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?Lr.runTools(this._client.chat.completions,e,t):Ls.runTools(this._client.chat.completions,e,t)}stream(e,t){return Ms.createChatCompletion(this._client.chat.completions,e,t)}};class ra extends fe{constructor(){super(...arguments),this.completions=new Nf(this._client)}}(function(n){n.Completions=Nf})(ra||(ra={}));var wt=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},ve=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Mi,Fi,us,cs,Di,ls,on,ds,Ui,Bi,Or,Eu;class Hy{constructor(){this.controller=new AbortController,Mi.set(this,void 0),Fi.set(this,()=>{}),us.set(this,()=>{}),cs.set(this,void 0),Di.set(this,()=>{}),ls.set(this,()=>{}),on.set(this,{}),ds.set(this,!1),Ui.set(this,!1),Bi.set(this,!1),Or.set(this,!1),Eu.set(this,e=>{if(wt(this,Ui,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new et),e instanceof et)return wt(this,Bi,!0,"f"),this._emit("abort",e);if(e instanceof ne)return this._emit("error",e);if(e instanceof Error){const t=new ne(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ne(String(e)))}),wt(this,Mi,new Promise((e,t)=>{wt(this,Fi,e,"f"),wt(this,us,t,"f")}),"f"),wt(this,cs,new Promise((e,t)=>{wt(this,Di,e,"f"),wt(this,ls,t,"f")}),"f"),ve(this,Mi,"f").catch(()=>{}),ve(this,cs,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},ve(this,Eu,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(ve(this,Fi,"f").call(this),this._emit("connect"))}get ended(){return ve(this,ds,"f")}get errored(){return ve(this,Ui,"f")}get aborted(){return ve(this,Bi,"f")}abort(){this.controller.abort()}on(e,t){return(ve(this,on,"f")[e]||(ve(this,on,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=ve(this,on,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(ve(this,on,"f")[e]||(ve(this,on,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{wt(this,Or,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){wt(this,Or,!0,"f"),await ve(this,cs,"f")}_emit(e,...t){if(ve(this,ds,"f"))return;e==="end"&&(wt(this,ds,!0,"f"),ve(this,Di,"f").call(this));const r=ve(this,on,"f")[e];if(r&&(ve(this,on,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!ve(this,Or,"f")&&!(r!=null&&r.length)&&Promise.reject(s),ve(this,us,"f").call(this,s),ve(this,ls,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!ve(this,Or,"f")&&!(r!=null&&r.length)&&Promise.reject(s),ve(this,us,"f").call(this,s),ve(this,ls,"f").call(this,s),this._emit("end")}}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}async _createThreadAssistantStream(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i=await e.createAndRun({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addRun(i)}async _createToolAssistantStream(e,t,r,s,i){const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o=await e.submitToolOutputs(t,r,{...s,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,t,r,s){const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a=await e.create(t,{...r,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(a)}}Mi=new WeakMap,Fi=new WeakMap,us=new WeakMap,cs=new WeakMap,Di=new WeakMap,ls=new WeakMap,on=new WeakMap,ds=new WeakMap,Ui=new WeakMap,Bi=new WeakMap,Or=new WeakMap,Eu=new WeakMap;var Z=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},st=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Le,Au,zt,zi,Pt,Xn,Pr,Gn,sa,it,Hi,Zi,Ss,hs,fs,Yl,ed,td,nd,rd,sd,id;class kt extends Hy{constructor(){super(...arguments),Le.add(this),Au.set(this,[]),zt.set(this,{}),zi.set(this,{}),Pt.set(this,void 0),Xn.set(this,void 0),Pr.set(this,void 0),Gn.set(this,void 0),sa.set(this,void 0),it.set(this,void 0),Hi.set(this,void 0),Zi.set(this,void 0),Ss.set(this,void 0)}[(Au=new WeakMap,zt=new WeakMap,zi=new WeakMap,Pt=new WeakMap,Xn=new WeakMap,Pr=new WeakMap,Gn=new WeakMap,sa=new WeakMap,it=new WeakMap,Hi=new WeakMap,Zi=new WeakMap,Ss=new WeakMap,Le=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new kt;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Wt.fromReadableStream(e,this.controller);for await(const a of s)Z(this,Le,"m",hs).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new et;return this._addRun(Z(this,Le,"m",fs).call(this))}toReadableStream(){return new Wt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new kt;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var c;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},u=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const l of u)Z(this,Le,"m",hs).call(this,l);if((c=u.controller.signal)!=null&&c.aborted)throw new et;return this._addRun(Z(this,Le,"m",fs).call(this))}static createThreadAssistantStream(e,t,r){const s=new kt;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new kt;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return Z(this,Hi,"f")}currentRun(){return Z(this,Zi,"f")}currentMessageSnapshot(){return Z(this,Pt,"f")}currentRunStepSnapshot(){return Z(this,Ss,"f")}async finalRunSteps(){return await this.done(),Object.values(Z(this,zt,"f"))}async finalMessages(){return await this.done(),Object.values(Z(this,zi,"f"))}async finalRun(){if(await this.done(),!Z(this,Xn,"f"))throw Error("Final run was not received.");return Z(this,Xn,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const u of a)Z(this,Le,"m",hs).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new et;return this._addRun(Z(this,Le,"m",fs).call(this))}async _createAssistantStream(e,t,r,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const c of o)Z(this,Le,"m",hs).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new et;return this._addRun(Z(this,Le,"m",fs).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Jl(i)&&Jl(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}}hs=function(e){if(!this.ended)switch(st(this,Hi,e,"f"),Z(this,Le,"m",td).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Z(this,Le,"m",id).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Z(this,Le,"m",ed).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Z(this,Le,"m",Yl).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},fs=function(){if(this.ended)throw new ne("stream has ended, this shouldn't happen");if(!Z(this,Xn,"f"))throw Error("Final run has not been received");return Z(this,Xn,"f")},Yl=function(e){const[t,r]=Z(this,Le,"m",rd).call(this,e,Z(this,Pt,"f"));st(this,Pt,t,"f"),Z(this,zi,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=Z(this,Pr,"f")){if(Z(this,Gn,"f"))switch(Z(this,Gn,"f").type){case"text":this._emit("textDone",Z(this,Gn,"f").text,Z(this,Pt,"f"));break;case"image_file":this._emit("imageFileDone",Z(this,Gn,"f").image_file,Z(this,Pt,"f"));break}st(this,Pr,s.index,"f")}st(this,Gn,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(Z(this,Pr,"f")!==void 0){const s=e.data.content[Z(this,Pr,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,Z(this,Pt,"f"));break;case"text":this._emit("textDone",s.text,Z(this,Pt,"f"));break}}Z(this,Pt,"f")&&this._emit("messageDone",e.data),st(this,Pt,void 0,"f")}},ed=function(e){const t=Z(this,Le,"m",nd).call(this,e);switch(st(this,Ss,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==Z(this,sa,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(Z(this,it,"f")&&this._emit("toolCallDone",Z(this,it,"f")),st(this,sa,i.index,"f"),st(this,it,t.step_details.tool_calls[i.index],"f"),Z(this,it,"f")&&this._emit("toolCallCreated",Z(this,it,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":st(this,Ss,void 0,"f"),e.data.step_details.type=="tool_calls"&&Z(this,it,"f")&&(this._emit("toolCallDone",Z(this,it,"f")),st(this,it,void 0,"f")),this._emit("runStepDone",e.data,t);break}},td=function(e){Z(this,Au,"f").push(e),this._emit("event",e)},nd=function(e){switch(e.event){case"thread.run.step.created":return Z(this,zt,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Z(this,zt,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=kt.accumulateDelta(t,r.delta);Z(this,zt,"f")[e.data.id]=s}return Z(this,zt,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Z(this,zt,"f")[e.data.id]=e.data;break}if(Z(this,zt,"f")[e.data.id])return Z(this,zt,"f")[e.data.id];throw new Error("No snapshot available")},rd=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=Z(this,Le,"m",sd).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},sd=function(e,t){return kt.accumulateDelta(t,e)},id=function(e){switch(st(this,Zi,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":st(this,Xn,e.data,"f"),Z(this,it,"f")&&(this._emit("toolCallDone",Z(this,it,"f")),st(this,it,void 0,"f"));break}};class ia extends fe{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return ct(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,_c,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class _c extends Lt{}(function(n){n.MessagesPage=_c})(ia||(ia={}));class aa extends fe{retrieve(e,t,r,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t,r={},s){return ct(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,yc,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class yc extends Lt{}(function(n){n.RunStepsPage=yc})(aa||(aa={}));class oa extends fe{constructor(){super(...arguments),this.steps=new aa(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/runs`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return ct(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,bc,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return kt.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(o=c)}}await ei(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return kt.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return kt.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class bc extends Lt{}(function(n){n.RunsPage=bc,n.Steps=aa,n.RunStepsPage=yc})(oa||(oa={}));class ua extends fe{constructor(){super(...arguments),this.runs=new oa(this._client),this.messages=new ia(this._client)}create(e={},t){return ct(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return kt.createThreadAssistantStream(e,this._client.beta.threads,t)}}(function(n){n.Runs=oa,n.RunsPage=bc,n.Messages=ia,n.MessagesPage=_c})(ua||(ua={}));const Zy=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let ca=class extends fe{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return ct(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,to,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=i.response.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(o=c)}}await ei(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}};class to extends Lt{}(function(n){n.VectorStoreFilesPage=to})(ca||(ca={}));class la extends fe{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return ct(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,to,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(o=c)}}await ei(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,u=t.values(),c=[...r];async function l(h){for(let f of h){const p=await o.files.create({file:f,purpose:"assistants"},s);c.push(p.id)}}const d=Array(a).fill(u).map(l);return await Zy(d),await this.createAndPoll(e,{file_ids:c})}}la||(la={});class da extends fe{constructor(){super(...arguments),this.files=new ca(this._client),this.fileBatches=new la(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return ct(e)?this.list({},e):this._client.getAPIList("/vector_stores",wc,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class wc extends Lt{}(function(n){n.VectorStoresPage=wc,n.Files=ca,n.VectorStoreFilesPage=to,n.FileBatches=la})(da||(da={}));class ha extends fe{constructor(){super(...arguments),this.vectorStores=new da(this._client),this.chat=new ra(this._client),this.assistants=new ta(this._client),this.threads=new ua(this._client)}}(function(n){n.VectorStores=da,n.VectorStoresPage=wc,n.Chat=ra,n.Assistants=ta,n.AssistantsPage=gc,n.Threads=ua})(ha||(ha={}));class fa extends fe{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}fa||(fa={});let pa=class extends fe{create(e,t){return this._client.post("/embeddings",{body:e,...t})}};pa||(pa={});class ma extends fe{create(e,t){return this._client.post("/files",zr({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ct(e)?this.list({},e):this._client.getAPIList("/files",vc,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await ei(t),a=await this.retrieve(e),Date.now()-i>r)throw new eo({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class vc extends pc{}(function(n){n.FileObjectsPage=vc})(ma||(ma={}));class ga extends fe{list(e,t={},r){return ct(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Ec,{query:t,...r})}}class Ec extends Lt{}(function(n){n.FineTuningJobCheckpointsPage=Ec})(ga||(ga={}));class _a extends fe{constructor(){super(...arguments),this.checkpoints=new ga(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ct(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Ac,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return ct(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,xc,{query:t,...r})}}class Ac extends Lt{}class xc extends Lt{}(function(n){n.FineTuningJobsPage=Ac,n.FineTuningJobEventsPage=xc,n.Checkpoints=ga,n.FineTuningJobCheckpointsPage=Ec})(_a||(_a={}));class ya extends fe{constructor(){super(...arguments),this.jobs=new _a(this._client)}}(function(n){n.Jobs=_a,n.FineTuningJobsPage=Ac,n.FineTuningJobEventsPage=xc})(ya||(ya={}));class ba extends fe{createVariation(e,t){return this._client.post("/images/variations",zr({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",zr({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}ba||(ba={});class wa extends fe{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Oc,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Oc extends pc{}(function(n){n.ModelsPage=Oc})(wa||(wa={}));class va extends fe{create(e,t){return this._client.post("/moderations",{body:e,...t})}}va||(va={});class Ea extends fe{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,zr({body:t,...r}))}}Ea||(Ea={});class Aa extends fe{constructor(){super(...arguments),this.parts=new Ea(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}(function(n){n.Parts=Ea})(Aa||(Aa={}));var jf;let Se=class extends ky{constructor({baseURL:e=_i("OPENAI_BASE_URL"),apiKey:t=_i("OPENAI_API_KEY"),organization:r=_i("OPENAI_ORG_ID")??null,project:s=_i("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new ne("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Uy())throw new ne(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new fa(this),this.chat=new Ji(this),this.embeddings=new pa(this),this.files=new ma(this),this.images=new ba(this),this.audio=new Yi(this),this.moderations=new va(this),this.models=new wa(this),this.fineTuning=new ya(this),this.beta=new ha(this),this.batches=new ea(this),this.uploads=new Aa(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};jf=Se;Se.OpenAI=jf;Se.OpenAIError=ne;Se.APIError=We;Se.APIConnectionError=ti;Se.APIConnectionTimeoutError=eo;Se.APIUserAbortError=et;Se.NotFoundError=cc;Se.ConflictError=lc;Se.RateLimitError=hc;Se.BadRequestError=ac;Se.AuthenticationError=oc;Se.InternalServerError=fc;Se.PermissionDeniedError=uc;Se.UnprocessableEntityError=dc;Se.toFile=xf;Se.fileFromPath=bf;const{OpenAIError:LA,APIError:MA,APIConnectionError:FA,APIConnectionTimeoutError:Vy,APIUserAbortError:qy,NotFoundError:DA,ConflictError:UA,RateLimitError:BA,BadRequestError:zA,AuthenticationError:HA,InternalServerError:ZA,PermissionDeniedError:VA,UnprocessableEntityError:qA}=By;(function(n){n.Page=pc,n.CursorPage=Lt,n.Completions=fa,n.Chat=Ji,n.Embeddings=pa,n.Files=ma,n.FileObjectsPage=vc,n.Images=ba,n.Audio=Yi,n.Moderations=va,n.Models=wa,n.ModelsPage=Oc,n.FineTuning=ya,n.Beta=ha,n.Batches=ea,n.BatchesPage=mc,n.Uploads=Aa})(Se||(Se={}));function ad(n,e=Sc){n=n.trim();const t=/```(json)?(.*)```/s.exec(n);return e(t?t[2]:n)}function Sc(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,s=!1;for(let i of n){if(r)i==='"'&&!s?r=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')r=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}r&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}function Pc(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Wy=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const Ky=Pc(Wy);var $f={exports:{}};const Jy=/[\p{Lu}]/u,Gy=/[\p{Ll}]/u,od=/^[\p{Lu}](?![\p{Lu}])/gu,Lf=/([\p{Alpha}\p{N}_]|$)/u,Mf=/[_.\- ]+/,Xy=new RegExp("^"+Mf.source),ud=new RegExp(Mf.source+Lf.source,"gu"),cd=new RegExp("\\d+"+Lf.source,"gu"),Qy=(n,e,t)=>{let r=!1,s=!1,i=!1;for(let a=0;a<n.length;a++){const o=n[a];r&&Jy.test(o)?(n=n.slice(0,a)+"-"+n.slice(a),r=!1,i=s,s=!0,a++):s&&i&&Gy.test(o)?(n=n.slice(0,a-1)+"-"+n.slice(a-1),i=s,s=!1,r=!0):(r=e(o)===o&&t(o)!==o,i=s,s=t(o)===o&&e(o)!==o)}return n},Yy=(n,e)=>(od.lastIndex=0,n.replace(od,t=>e(t))),eb=(n,e)=>(ud.lastIndex=0,cd.lastIndex=0,n.replace(ud,(t,r)=>e(r)).replace(cd,t=>e(t))),Ff=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(i=>i.trim()).filter(i=>i.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=Qy(n,t,r)),n=n.replace(Xy,""),e.preserveConsecutiveUppercase?n=Yy(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),eb(n,r))};$f.exports=Ff;$f.exports.default=Ff;function tb(n,e){return(e==null?void 0:e[n])||Ky(n)}function nb(n,e,t){const r={};for(const s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}function ld(n){return Array.isArray(n)?[...n]:{...n}}function rb(n,e){const t=ld(n);for(const[r,s]of Object.entries(e)){const[i,...a]=r.split(".").reverse();let o=t;for(const u of a.reverse()){if(o[u]===void 0)break;o[u]=ld(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function Df(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class cr{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Df(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof cr||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=r;const[o,...u]=s.split(".").reverse();for(const c of u.reverse()){if(!(c in i)||i[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof i[c]=="object"&&i[c]!=null?a[c]={}:Array.isArray(i[c])&&(a[c]=[])),i=i[c],a=a[c]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:nb(Object.keys(t).length?rb(r,t):r,tb,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function Kr(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?no(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function sb(n,e){function t(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(a=>t(a,s+1));const i={};for(const a of Object.keys(r))i[a]=t(r[a],s+1);return i}return JSON.stringify(t(n,0),null,2)}class ni extends cr{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=sb(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function Ke(n,e){const t={...n};for(const[r,s]of Object.entries(e))if(t[r]==null)t[r]=s;else{if(s==null)continue;if(typeof t[r]!=typeof s||Array.isArray(t[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=s}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=Ke(t[r],s);else if(Array.isArray(t[r]))t[r]=no(t[r],s);else{if(t[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function no(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const s=t.findIndex(i=>i.index===r.index);s!==-1?t[s]=Ke(t[s],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function ib(n,e){if(!n&&!e)throw new Error("Cannot merge two undefined objects.");if(!n||!e)return n||e;if(typeof n!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof n}
Right ${typeof e}`);if(typeof n=="string"&&typeof e=="string")return n+e;if(Array.isArray(n)&&Array.isArray(e))return no(n,e);if(typeof n=="object"&&typeof e=="object")return Ke(n,e);if(n===e)return n;throw new Error(`Can not merge objects of different types.
Left ${n}
Right ${e}`)}class Jr extends ni{}function Tc(n){return typeof(n==null?void 0:n._getType)=="function"}function ab(n){return Tc(n)&&typeof n.concat=="function"}class kc extends Jr{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new kc({content:Kr(this.content,e.content),additional_kwargs:Ke(this.additional_kwargs,e.additional_kwargs),response_metadata:Ke(this.response_metadata,e.response_metadata),artifact:ib(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function ob(n){const e=[],t=[];for(const r of n)if(r.function){const s=r.function.name;try{const i=JSON.parse(r.function.arguments),a={name:s||"",args:i||{},id:r.id};e.push(a)}catch{t.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}class Uf extends ni{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const i=(s=r.additional_kwargs)==null?void 0:s.tool_calls,a=r.tool_calls;i!=null&&i.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&a===void 0){const[o,u]=ob(i);r.tool_calls=o??[],r.invalid_tool_calls=u??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function Bf(n){return n._getType()==="ai"}class pr extends Jr{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{const r=[],s=[];for(const i of e.tool_call_chunks){let a={};try{if(a=Sc(i.args??"{}")??{},typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");r.push({name:i.name??"",args:a,id:i.id,type:"tool_call"})}catch{s.push({name:i.name,args:i.args,id:i.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:s}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const t={content:Kr(this.content,e.content),additional_kwargs:Ke(this.additional_kwargs,e.additional_kwargs),response_metadata:Ke(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const r=no(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i={input_tokens:r.input_tokens+s.input_tokens,output_tokens:r.output_tokens+s.output_tokens,total_tokens:r.total_tokens+s.total_tokens};t.usage_metadata=i}return new pr(t)}}class ri extends ni{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return ri}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class ro extends Jr{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new ro({content:Kr(this.content,e.content),additional_kwargs:Ke(this.additional_kwargs,e.additional_kwargs),response_metadata:Ke(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class so extends Jr{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new so({content:Kr(this.content,e.content),additional_kwargs:Ke(this.additional_kwargs,e.additional_kwargs),response_metadata:Ke(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class io extends ni{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class ao extends Jr{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new ao({content:Kr(this.content,e.content),additional_kwargs:Ke(this.additional_kwargs,e.additional_kwargs),response_metadata:Ke(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class ub extends ni{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class oo extends Jr{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new oo({content:Kr(this.content,e.content),additional_kwargs:Ke(this.additional_kwargs,e.additional_kwargs),response_metadata:Ke(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function dd(n){const{type:e,...t}=n;if(e==="human"||e==="user")return new io(t);if(e==="ai"||e==="assistant")return new Uf(t);if(e==="system")return new ub(t);throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function ps(n){if(typeof n=="string")return new io(n);if(Tc(n))return n;if(Array.isArray(n)){const[e,t]=n;return dd({type:e,content:t})}else return dd(n)}function zf(n,e="Human",t="AI"){const r=[];for(const s of n){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const a=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);r.push(`${i}: ${a}${o}`)}return r.join(`
`)}function cb(n){var t;const e=n._getType();if(e==="human")return new ao({...n});if(e==="ai"){let r={...n};return"tool_calls"in r&&(r={...r,tool_call_chunks:(t=r.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new pr({...r})}else{if(e==="system")return new oo({...n});if(e==="function")return new so({...n});if(ri.isInstance(n))return new ro({...n});throw new Error("Unknown message type.")}}var re;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return n.objectValues(a)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},n.find=(s,i)=>{for(const a of s)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(re||(re={}));var xu;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(xu||(xu={}));const M=re.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),In=n=>{switch(typeof n){case"undefined":return M.undefined;case"string":return M.string;case"number":return isNaN(n)?M.nan:M.number;case"boolean":return M.boolean;case"function":return M.function;case"bigint":return M.bigint;case"symbol":return M.symbol;case"object":return Array.isArray(n)?M.array:n===null?M.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?M.promise:typeof Map<"u"&&n instanceof Map?M.map:typeof Set<"u"&&n instanceof Set?M.set:typeof Date<"u"&&n instanceof Date?M.date:M.object;default:return M.unknown}},P=re.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),lb=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class ot extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,u=0;for(;u<a.path.length;){const c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return s(this),r}static assert(e){if(!(e instanceof ot))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,re.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}ot.create=n=>new ot(n);const Hr=(n,e)=>{let t;switch(n.code){case P.invalid_type:n.received===M.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case P.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,re.jsonStringifyReplacer)}`;break;case P.unrecognized_keys:t=`Unrecognized key(s) in object: ${re.joinValues(n.keys,", ")}`;break;case P.invalid_union:t="Invalid input";break;case P.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${re.joinValues(n.options)}`;break;case P.invalid_enum_value:t=`Invalid enum value. Expected ${re.joinValues(n.options)}, received '${n.received}'`;break;case P.invalid_arguments:t="Invalid function arguments";break;case P.invalid_return_type:t="Invalid function return type";break;case P.invalid_date:t="Invalid date";break;case P.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:re.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case P.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case P.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case P.custom:t="Invalid input";break;case P.invalid_intersection_types:t="Intersection results could not be merged";break;case P.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case P.not_finite:t="Number must be finite";break;default:t=e.defaultError,re.assertNever(n)}return{message:t}};let Hf=Hr;function db(n){Hf=n}function xa(){return Hf}const Oa=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const u=r.filter(c=>!!c).slice().reverse();for(const c of u)o=c(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},hb=[];function $(n,e){const t=xa(),r=Oa({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Hr?void 0:Hr].filter(s=>!!s)});n.common.issues.push(r)}class ze{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return W;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,a=await s.value;r.push({key:i,value:a})}return ze.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return W;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}}const W=Object.freeze({status:"aborted"}),Tr=n=>({status:"dirty",value:n}),Je=n=>({status:"valid",value:n}),Ou=n=>n.status==="aborted",Su=n=>n.status==="dirty",Fs=n=>n.status==="valid",Ds=n=>typeof Promise<"u"&&n instanceof Promise;function Sa(n,e,t,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function Zf(n,e,t,r,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var z;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(z||(z={}));var ms,gs;class Qt{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const hd=(n,e)=>{if(Fs(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ot(n.common.issues);return this._error=t,this._error}}};function G(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var u,c;const{message:l}=n;return a.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(u=l??r)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(c=l??t)!==null&&c!==void 0?c:o.defaultError}},description:s}}class Y{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return In(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:In(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ze,ctx:{common:e.parent.common,data:e.data,parsedType:In(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ds(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:In(e)},i=this._parseSync({data:e,path:s.path,parent:s});return hd(s,i)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:In(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(Ds(s)?s:Promise.resolve(s));return hd(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:P.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new jt({schema:this,typeName:k.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Jt.create(this,this._def)}nullable(){return Dn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Rt.create(this,this._def)}promise(){return Vr.create(this,this._def)}or(e){return Hs.create([this,e],this._def)}and(e){return Zs.create(this,e,this._def)}transform(e){return new jt({...G(this._def),schema:this,typeName:k.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Js({...G(this._def),innerType:this,defaultValue:t,typeName:k.ZodDefault})}brand(){return new Cc({typeName:k.ZodBranded,type:this,...G(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Gs({...G(this._def),innerType:this,catchValue:t,typeName:k.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return si.create(this,e)}readonly(){return Xs.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const fb=/^c[^\s-]{8,}$/i,pb=/^[0-9a-z]+$/,mb=/^[0-9A-HJKMNP-TV-Z]{26}$/,gb=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,_b=/^[a-z0-9_-]{21}$/i,yb=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bb=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,wb="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let jo;const vb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Eb=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Ab=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Vf="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",xb=new RegExp(`^${Vf}$`);function qf(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Ob(n){return new RegExp(`^${qf(n)}$`)}function Wf(n){let e=`${Vf}T${qf(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Sb(n,e){return!!((e==="v4"||!e)&&vb.test(n)||(e==="v6"||!e)&&Eb.test(n))}class Ct extends Y{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==M.string){const i=this._getOrReturnCtx(e);return $(i,{code:P.invalid_type,expected:M.string,received:i.parsedType}),W}const r=new ze;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:P.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:P.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?$(s,{code:P.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&$(s,{code:P.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")bb.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"email",code:P.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")jo||(jo=new RegExp(wb,"u")),jo.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"emoji",code:P.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")gb.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"uuid",code:P.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")_b.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"nanoid",code:P.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")fb.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"cuid",code:P.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")pb.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"cuid2",code:P.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")mb.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"ulid",code:P.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),$(s,{validation:"url",code:P.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"regex",code:P.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),$(s,{code:P.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),$(s,{code:P.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),$(s,{code:P.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?Wf(i).test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{code:P.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?xb.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{code:P.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?Ob(i).test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{code:P.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?yb.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"duration",code:P.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?Sb(e.data,i.version)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"ip",code:P.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?Ab.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"base64",code:P.invalid_string,message:i.message}),r.dirty()):re.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:P.invalid_string,...z.errToObj(r)})}_addCheck(e){return new Ct({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...z.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...z.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...z.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...z.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...z.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...z.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...z.errToObj(t)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new Ct({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ct({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ct({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Ct.create=n=>{var e;return new Ct({checks:[],typeName:k.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...G(n)})};function Pb(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class Ln extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==M.number){const i=this._getOrReturnCtx(e);return $(i,{code:P.invalid_type,expected:M.number,received:i.parsedType}),W}let r;const s=new ze;for(const i of this._def.checks)i.kind==="int"?re.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),$(r,{code:P.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),$(r,{code:P.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),$(r,{code:P.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?Pb(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),$(r,{code:P.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),$(r,{code:P.not_finite,message:i.message}),s.dirty()):re.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,z.toString(t))}gt(e,t){return this.setLimit("min",e,!1,z.toString(t))}lte(e,t){return this.setLimit("max",e,!0,z.toString(t))}lt(e,t){return this.setLimit("max",e,!1,z.toString(t))}setLimit(e,t,r,s){return new Ln({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:z.toString(s)}]})}_addCheck(e){return new Ln({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&re.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ln.create=n=>new Ln({checks:[],typeName:k.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...G(n)});class Mn extends Y{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==M.bigint){const i=this._getOrReturnCtx(e);return $(i,{code:P.invalid_type,expected:M.bigint,received:i.parsedType}),W}let r;const s=new ze;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),$(r,{code:P.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),$(r,{code:P.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),$(r,{code:P.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):re.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,z.toString(t))}gt(e,t){return this.setLimit("min",e,!1,z.toString(t))}lte(e,t){return this.setLimit("max",e,!0,z.toString(t))}lt(e,t){return this.setLimit("max",e,!1,z.toString(t))}setLimit(e,t,r,s){return new Mn({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:z.toString(s)}]})}_addCheck(e){return new Mn({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Mn.create=n=>{var e;return new Mn({checks:[],typeName:k.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...G(n)})};class Us extends Y{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==M.boolean){const r=this._getOrReturnCtx(e);return $(r,{code:P.invalid_type,expected:M.boolean,received:r.parsedType}),W}return Je(e.data)}}Us.create=n=>new Us({typeName:k.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...G(n)});class lr extends Y{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==M.date){const i=this._getOrReturnCtx(e);return $(i,{code:P.invalid_type,expected:M.date,received:i.parsedType}),W}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return $(i,{code:P.invalid_date}),W}const r=new ze;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:P.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:P.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):re.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new lr({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}lr.create=n=>new lr({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:k.ZodDate,...G(n)});class Pa extends Y{_parse(e){if(this._getType(e)!==M.symbol){const r=this._getOrReturnCtx(e);return $(r,{code:P.invalid_type,expected:M.symbol,received:r.parsedType}),W}return Je(e.data)}}Pa.create=n=>new Pa({typeName:k.ZodSymbol,...G(n)});class Bs extends Y{_parse(e){if(this._getType(e)!==M.undefined){const r=this._getOrReturnCtx(e);return $(r,{code:P.invalid_type,expected:M.undefined,received:r.parsedType}),W}return Je(e.data)}}Bs.create=n=>new Bs({typeName:k.ZodUndefined,...G(n)});class zs extends Y{_parse(e){if(this._getType(e)!==M.null){const r=this._getOrReturnCtx(e);return $(r,{code:P.invalid_type,expected:M.null,received:r.parsedType}),W}return Je(e.data)}}zs.create=n=>new zs({typeName:k.ZodNull,...G(n)});class Zr extends Y{constructor(){super(...arguments),this._any=!0}_parse(e){return Je(e.data)}}Zr.create=n=>new Zr({typeName:k.ZodAny,...G(n)});class nr extends Y{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Je(e.data)}}nr.create=n=>new nr({typeName:k.ZodUnknown,...G(n)});class gn extends Y{_parse(e){const t=this._getOrReturnCtx(e);return $(t,{code:P.invalid_type,expected:M.never,received:t.parsedType}),W}}gn.create=n=>new gn({typeName:k.ZodNever,...G(n)});class Ta extends Y{_parse(e){if(this._getType(e)!==M.undefined){const r=this._getOrReturnCtx(e);return $(r,{code:P.invalid_type,expected:M.void,received:r.parsedType}),W}return Je(e.data)}}Ta.create=n=>new Ta({typeName:k.ZodVoid,...G(n)});class Rt extends Y{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==M.array)return $(t,{code:P.invalid_type,expected:M.array,received:t.parsedType}),W;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&($(t,{code:a?P.too_big:P.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&($(t,{code:P.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&($(t,{code:P.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new Qt(t,a,t.path,o)))).then(a=>ze.mergeArray(r,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new Qt(t,a,t.path,o)));return ze.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new Rt({...this._def,minLength:{value:e,message:z.toString(t)}})}max(e,t){return new Rt({...this._def,maxLength:{value:e,message:z.toString(t)}})}length(e,t){return new Rt({...this._def,exactLength:{value:e,message:z.toString(t)}})}nonempty(e){return this.min(1,e)}}Rt.create=(n,e)=>new Rt({type:n,minLength:null,maxLength:null,exactLength:null,typeName:k.ZodArray,...G(e)});function Sr(n){if(n instanceof Ee){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Jt.create(Sr(r))}return new Ee({...n._def,shape:()=>e})}else return n instanceof Rt?new Rt({...n._def,type:Sr(n.element)}):n instanceof Jt?Jt.create(Sr(n.unwrap())):n instanceof Dn?Dn.create(Sr(n.unwrap())):n instanceof Yt?Yt.create(n.items.map(e=>Sr(e))):n}class Ee extends Y{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=re.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==M.object){const c=this._getOrReturnCtx(e);return $(c,{code:P.invalid_type,expected:M.object,received:c.parsedType}),W}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof gn&&this._def.unknownKeys==="strip"))for(const c in s.data)a.includes(c)||o.push(c);const u=[];for(const c of a){const l=i[c],d=s.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new Qt(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof gn){const c=this._def.unknownKeys;if(c==="passthrough")for(const l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(c==="strict")o.length>0&&($(s,{code:P.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const l of o){const d=s.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new Qt(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const c=[];for(const l of u){const d=await l.key,h=await l.value;c.push({key:d,value:h,alwaysSet:l.alwaysSet})}return c}).then(c=>ze.mergeObjectSync(r,c)):ze.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return z.errToObj,new Ee({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,a,o;const u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=z.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new Ee({...this._def,unknownKeys:"strip"})}passthrough(){return new Ee({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ee({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ee({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:k.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ee({...this._def,catchall:e})}pick(e){const t={};return re.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new Ee({...this._def,shape:()=>t})}omit(e){const t={};return re.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new Ee({...this._def,shape:()=>t})}deepPartial(){return Sr(this)}partial(e){const t={};return re.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new Ee({...this._def,shape:()=>t})}required(e){const t={};return re.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof Jt;)i=i._def.innerType;t[r]=i}}),new Ee({...this._def,shape:()=>t})}keyof(){return Kf(re.objectKeys(this.shape))}}Ee.create=(n,e)=>new Ee({shape:()=>n,unknownKeys:"strip",catchall:gn.create(),typeName:k.ZodObject,...G(e)});Ee.strictCreate=(n,e)=>new Ee({shape:()=>n,unknownKeys:"strict",catchall:gn.create(),typeName:k.ZodObject,...G(e)});Ee.lazycreate=(n,e)=>new Ee({shape:n,unknownKeys:"strip",catchall:gn.create(),typeName:k.ZodObject,...G(e)});class Hs extends Y{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new ot(o.ctx.common.issues));return $(t,{code:P.invalid_union,unionErrors:a}),W}if(t.common.async)return Promise.all(r.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const u of r){const c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(u=>new ot(u));return $(t,{code:P.invalid_union,unionErrors:o}),W}}get options(){return this._def.options}}Hs.create=(n,e)=>new Hs({options:n,typeName:k.ZodUnion,...G(e)});const un=n=>n instanceof qs?un(n.schema):n instanceof jt?un(n.innerType()):n instanceof Ws?[n.value]:n instanceof Fn?n.options:n instanceof Ks?re.objectValues(n.enum):n instanceof Js?un(n._def.innerType):n instanceof Bs?[void 0]:n instanceof zs?[null]:n instanceof Jt?[void 0,...un(n.unwrap())]:n instanceof Dn?[null,...un(n.unwrap())]:n instanceof Cc||n instanceof Xs?un(n.unwrap()):n instanceof Gs?un(n._def.innerType):[];class uo extends Y{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==M.object)return $(t,{code:P.invalid_type,expected:M.object,received:t.parsedType}),W;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):($(t,{code:P.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),W)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const a=un(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new uo({typeName:k.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...G(r)})}}function Pu(n,e){const t=In(n),r=In(e);if(n===e)return{valid:!0,data:n};if(t===M.object&&r===M.object){const s=re.objectKeys(e),i=re.objectKeys(n).filter(o=>s.indexOf(o)!==-1),a={...n,...e};for(const o of i){const u=Pu(n[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===M.array&&r===M.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],u=Pu(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===M.date&&r===M.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Zs extends Y{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(Ou(i)||Ou(a))return W;const o=Pu(i.value,a.value);return o.valid?((Su(i)||Su(a))&&t.dirty(),{status:t.value,value:o.data}):($(r,{code:P.invalid_intersection_types}),W)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Zs.create=(n,e,t)=>new Zs({left:n,right:e,typeName:k.ZodIntersection,...G(t)});class Yt extends Y{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.array)return $(r,{code:P.invalid_type,expected:M.array,received:r.parsedType}),W;if(r.data.length<this._def.items.length)return $(r,{code:P.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),W;!this._def.rest&&r.data.length>this._def.items.length&&($(r,{code:P.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((a,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new Qt(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>ze.mergeArray(t,a)):ze.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new Yt({...this._def,rest:e})}}Yt.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Yt({items:n,typeName:k.ZodTuple,rest:null,...G(e)})};class Vs extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.object)return $(r,{code:P.invalid_type,expected:M.object,received:r.parsedType}),W;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in r.data)s.push({key:i._parse(new Qt(r,o,r.path,o)),value:a._parse(new Qt(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?ze.mergeObjectAsync(t,s):ze.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Y?new Vs({keyType:e,valueType:t,typeName:k.ZodRecord,...G(r)}):new Vs({keyType:Ct.create(),valueType:e,typeName:k.ZodRecord,...G(t)})}}class ka extends Y{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.map)return $(r,{code:P.invalid_type,expected:M.map,received:r.parsedType}),W;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,u],c)=>({key:s._parse(new Qt(r,o,r.path,[c,"key"])),value:i._parse(new Qt(r,u,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of a){const c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return W;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of a){const c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return W;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}}ka.create=(n,e,t)=>new ka({valueType:e,keyType:n,typeName:k.ZodMap,...G(t)});class dr extends Y{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==M.set)return $(r,{code:P.invalid_type,expected:M.set,received:r.parsedType}),W;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&($(r,{code:P.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&($(r,{code:P.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(u){const c=new Set;for(const l of u){if(l.status==="aborted")return W;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}const o=[...r.data.values()].map((u,c)=>i._parse(new Qt(r,u,r.path,c)));return r.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new dr({...this._def,minSize:{value:e,message:z.toString(t)}})}max(e,t){return new dr({...this._def,maxSize:{value:e,message:z.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}dr.create=(n,e)=>new dr({valueType:n,minSize:null,maxSize:null,typeName:k.ZodSet,...G(e)});class Mr extends Y{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==M.function)return $(t,{code:P.invalid_type,expected:M.function,received:t.parsedType}),W;function r(o,u){return Oa({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,xa(),Hr].filter(c=>!!c),issueData:{code:P.invalid_arguments,argumentsError:u}})}function s(o,u){return Oa({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,xa(),Hr].filter(c=>!!c),issueData:{code:P.invalid_return_type,returnTypeError:u}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Vr){const o=this;return Je(async function(...u){const c=new ot([]),l=await o._def.args.parseAsync(u,i).catch(f=>{throw c.addIssue(r(u,f)),c}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(f=>{throw c.addIssue(s(d,f)),c})})}else{const o=this;return Je(function(...u){const c=o._def.args.safeParse(u,i);if(!c.success)throw new ot([r(u,c.error)]);const l=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new ot([s(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Mr({...this._def,args:Yt.create(e).rest(nr.create())})}returns(e){return new Mr({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Mr({args:e||Yt.create([]).rest(nr.create()),returns:t||nr.create(),typeName:k.ZodFunction,...G(r)})}}class qs extends Y{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}qs.create=(n,e)=>new qs({getter:n,typeName:k.ZodLazy,...G(e)});class Ws extends Y{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return $(t,{received:t.data,code:P.invalid_literal,expected:this._def.value}),W}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ws.create=(n,e)=>new Ws({value:n,typeName:k.ZodLiteral,...G(e)});function Kf(n,e){return new Fn({values:n,typeName:k.ZodEnum,...G(e)})}class Fn extends Y{constructor(){super(...arguments),ms.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return $(t,{expected:re.joinValues(r),received:t.parsedType,code:P.invalid_type}),W}if(Sa(this,ms)||Zf(this,ms,new Set(this._def.values)),!Sa(this,ms).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return $(t,{received:t.data,code:P.invalid_enum_value,options:r}),W}return Je(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Fn.create(e,{...this._def,...t})}exclude(e,t=this._def){return Fn.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}ms=new WeakMap;Fn.create=Kf;class Ks extends Y{constructor(){super(...arguments),gs.set(this,void 0)}_parse(e){const t=re.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==M.string&&r.parsedType!==M.number){const s=re.objectValues(t);return $(r,{expected:re.joinValues(s),received:r.parsedType,code:P.invalid_type}),W}if(Sa(this,gs)||Zf(this,gs,new Set(re.getValidEnumValues(this._def.values))),!Sa(this,gs).has(e.data)){const s=re.objectValues(t);return $(r,{received:r.data,code:P.invalid_enum_value,options:s}),W}return Je(e.data)}get enum(){return this._def.values}}gs=new WeakMap;Ks.create=(n,e)=>new Ks({values:n,typeName:k.ZodNativeEnum,...G(e)});class Vr extends Y{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==M.promise&&t.common.async===!1)return $(t,{code:P.invalid_type,expected:M.promise,received:t.parsedType}),W;const r=t.parsedType===M.promise?t.data:Promise.resolve(t.data);return Je(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Vr.create=(n,e)=>new Vr({type:n,typeName:k.ZodPromise,...G(e)});class jt extends Y{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===k.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{$(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);if(r.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return W;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?W:u.status==="dirty"||t.value==="dirty"?Tr(u.value):u});{if(t.value==="aborted")return W;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?W:o.status==="dirty"||t.value==="dirty"?Tr(o.value):o}}if(s.type==="refinement"){const a=o=>{const u=s.refinement(o,i);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?W:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?W:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Fs(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>Fs(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);re.assertNever(s)}}jt.create=(n,e,t)=>new jt({schema:n,typeName:k.ZodEffects,effect:e,...G(t)});jt.createWithPreprocess=(n,e,t)=>new jt({schema:e,effect:{type:"preprocess",transform:n},typeName:k.ZodEffects,...G(t)});class Jt extends Y{_parse(e){return this._getType(e)===M.undefined?Je(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Jt.create=(n,e)=>new Jt({innerType:n,typeName:k.ZodOptional,...G(e)});class Dn extends Y{_parse(e){return this._getType(e)===M.null?Je(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Dn.create=(n,e)=>new Dn({innerType:n,typeName:k.ZodNullable,...G(e)});class Js extends Y{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===M.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Js.create=(n,e)=>new Js({innerType:n,typeName:k.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...G(e)});class Gs extends Y{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ds(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ot(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ot(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Gs.create=(n,e)=>new Gs({innerType:n,typeName:k.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...G(e)});class Ca extends Y{_parse(e){if(this._getType(e)!==M.nan){const r=this._getOrReturnCtx(e);return $(r,{code:P.invalid_type,expected:M.nan,received:r.parsedType}),W}return{status:"valid",value:e.data}}}Ca.create=n=>new Ca({typeName:k.ZodNaN,...G(n)});const Tb=Symbol("zod_brand");class Cc extends Y{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class si extends Y{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?W:i.status==="dirty"?(t.dirty(),Tr(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?W:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new si({in:e,out:t,typeName:k.ZodPipeline})}}class Xs extends Y{_parse(e){const t=this._def.innerType._parse(e),r=s=>(Fs(s)&&(s.value=Object.freeze(s.value)),s);return Ds(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}Xs.create=(n,e)=>new Xs({innerType:n,typeName:k.ZodReadonly,...G(e)});function Jf(n,e={},t){return n?Zr.create().superRefine((r,s)=>{var i,a;if(!n(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,u=(a=(i=o.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0,c=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...c,fatal:u})}}):Zr.create()}const kb={object:Ee.lazycreate};var k;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(k||(k={}));const Cb=(n,e={message:`Input not instance of ${n.name}`})=>Jf(t=>t instanceof n,e),Gf=Ct.create,Xf=Ln.create,Ib=Ca.create,Rb=Mn.create,Qf=Us.create,Nb=lr.create,jb=Pa.create,$b=Bs.create,Lb=zs.create,Mb=Zr.create,Fb=nr.create,Db=gn.create,Ub=Ta.create,Bb=Rt.create,zb=Ee.create,Hb=Ee.strictCreate,Zb=Hs.create,Vb=uo.create,qb=Zs.create,Wb=Yt.create,Kb=Vs.create,Jb=ka.create,Gb=dr.create,Xb=Mr.create,Qb=qs.create,Yb=Ws.create,ew=Fn.create,tw=Ks.create,nw=Vr.create,fd=jt.create,rw=Jt.create,sw=Dn.create,iw=jt.createWithPreprocess,aw=si.create,ow=()=>Gf().optional(),uw=()=>Xf().optional(),cw=()=>Qf().optional(),lw={string:n=>Ct.create({...n,coerce:!0}),number:n=>Ln.create({...n,coerce:!0}),boolean:n=>Us.create({...n,coerce:!0}),bigint:n=>Mn.create({...n,coerce:!0}),date:n=>lr.create({...n,coerce:!0})},dw=W;var rr=Object.freeze({__proto__:null,defaultErrorMap:Hr,setErrorMap:db,getErrorMap:xa,makeIssue:Oa,EMPTY_PATH:hb,addIssueToContext:$,ParseStatus:ze,INVALID:W,DIRTY:Tr,OK:Je,isAborted:Ou,isDirty:Su,isValid:Fs,isAsync:Ds,get util(){return re},get objectUtil(){return xu},ZodParsedType:M,getParsedType:In,ZodType:Y,datetimeRegex:Wf,ZodString:Ct,ZodNumber:Ln,ZodBigInt:Mn,ZodBoolean:Us,ZodDate:lr,ZodSymbol:Pa,ZodUndefined:Bs,ZodNull:zs,ZodAny:Zr,ZodUnknown:nr,ZodNever:gn,ZodVoid:Ta,ZodArray:Rt,ZodObject:Ee,ZodUnion:Hs,ZodDiscriminatedUnion:uo,ZodIntersection:Zs,ZodTuple:Yt,ZodRecord:Vs,ZodMap:ka,ZodSet:dr,ZodFunction:Mr,ZodLazy:qs,ZodLiteral:Ws,ZodEnum:Fn,ZodNativeEnum:Ks,ZodPromise:Vr,ZodEffects:jt,ZodTransformer:jt,ZodOptional:Jt,ZodNullable:Dn,ZodDefault:Js,ZodCatch:Gs,ZodNaN:Ca,BRAND:Tb,ZodBranded:Cc,ZodPipeline:si,ZodReadonly:Xs,custom:Jf,Schema:Y,ZodSchema:Y,late:kb,get ZodFirstPartyTypeKind(){return k},coerce:lw,any:Mb,array:Bb,bigint:Rb,boolean:Qf,date:Nb,discriminatedUnion:Vb,effect:fd,enum:ew,function:Xb,instanceof:Cb,intersection:qb,lazy:Qb,literal:Yb,map:Jb,nan:Ib,nativeEnum:tw,never:Db,null:Lb,nullable:sw,number:Xf,object:zb,oboolean:cw,onumber:uw,optional:rw,ostring:ow,pipeline:aw,preprocess:iw,promise:nw,record:Kb,set:Gb,strictObject:Hb,string:Gf,symbol:jb,transformer:fd,tuple:Wb,undefined:$b,union:Zb,unknown:Fb,void:Ub,NEVER:dw,ZodIssueCode:P,quotelessJson:lb,ZodError:ot}),co={exports:{}},Yf={};function gt(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var hw=gt;gt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};gt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};gt.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};gt.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};gt.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};gt.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};gt.prototype.start=gt.prototype.try;gt.prototype.errors=function(){return this._errors};gt.prototype.attempts=function(){return this._attempts};gt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],i=s.message,a=(n[i]||0)+1;n[i]=a,a>=t&&(e=s,t=a)}return e};(function(n){var e=hw;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<r.retries;a++)i.push(this.createTimeout(a,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,r)),i.sort(function(o,u){return o-u}),i},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],u=t[o];t[o]=(function(l){var d=n.operation(r),h=Array.prototype.slice.call(arguments,1),f=h.pop();h.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),f.apply(this,arguments))}),d.attempt(function(){l.apply(t,h)})}).bind(t,u),t[o].options=r}}})(Yf);var fw=Yf;const pw=fw,mw=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class ep extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const gw=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},_w=n=>mw.includes(n),tp=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=pw.operation(e);s.attempt(async i=>{try{t(await n(i))}catch(a){if(!(a instanceof Error)){r(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof ep)s.stop(),r(a.originalError);else if(a instanceof TypeError&&!_w(a.message))s.stop(),r(a);else{gw(a,i,e);try{await e.onFailedAttempt(a)}catch(o){r(o);return}s.retry(a)||r(s.mainError())}}})});co.exports=tp;co.exports.default=tp;co.exports.AbortError=ep;var yw=co.exports;const Ia=Pc(yw),bw=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Tu(n){return typeof n=="string"&&bw.test(n)}var je=[];for(var $o=0;$o<256;++$o)je.push(($o+256).toString(16).slice(1));function ww(n,e=0){return(je[n[e+0]]+je[n[e+1]]+je[n[e+2]]+je[n[e+3]]+"-"+je[n[e+4]]+je[n[e+5]]+"-"+je[n[e+6]]+je[n[e+7]]+"-"+je[n[e+8]]+je[n[e+9]]+"-"+je[n[e+10]]+je[n[e+11]]+je[n[e+12]]+je[n[e+13]]+je[n[e+14]]+je[n[e+15]]).toLowerCase()}var wi,vw=new Uint8Array(16);function Ew(){if(!wi&&(wi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wi(vw)}var Aw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const pd={randomUUID:Aw};function dn(n,e,t){if(pd.randomUUID&&!e&&!n)return pd.randomUUID();n=n||{};var r=n.random||(n.rng||Ew)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ww(r)}let xw=class{getStore(){}run(e,t){return t()}};const Lo=Symbol.for("ls:tracing_async_local_storage"),Ow=new xw;let Sw=class{getInstance(){return globalThis[Lo]??Ow}initializeGlobalInstance(e){globalThis[Lo]===void 0&&(globalThis[Lo]=e)}};const Pw=new Sw,Tw=()=>{const n=Pw.getInstance().getStore();if(n===void 0)throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return n};function Ic(n){return typeof n=="function"&&"langsmith:traceable"in n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const kw=Object.prototype.hasOwnProperty;function ku(n,e){return kw.call(n,e)}function Cu(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)ku(n,t)&&e.push(t);return e}function Kt(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function Iu(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function br(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function Cw(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function Ru(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Ru(n[t]))return!0}else if(typeof n=="object"){const t=Cu(n),r=t.length;for(var e=0;e<r;e++)if(Ru(n[t[e]]))return!0}}return!1}function md(n,e){const t=[n];for(const r in e){const s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&t.push(`${r}: ${s}`)}return t.join(`
`)}class Iw extends Error{constructor(e,t,r,s,i){super(md(e,{name:t,index:r,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=md(e,{name:t,index:r,operation:s,tree:i})}}const Pe=Iw,kr={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=Nu(t,this.path);r&&(r=Kt(r));const s=Ps(t,{op:"remove",path:this.from}).removed;return Ps(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=Nu(t,this.from);return Ps(t,{op:"add",path:this.path,value:Kt(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:Na(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var Rw={add:function(n,e,t){return Iu(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:kr.move,copy:kr.copy,test:kr.test,_get:kr._get};function Nu(n,e){if(e=="")return n;var t={op:"_get",path:e};return Ps(n,t),t.value}function Ps(n,e,t=!1,r=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):ju(e,0)),e.path===""){let a={newDocument:n};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=n,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Nu(n,e.from),e.op==="move"&&(a.removed=n),a;if(e.op==="test"){if(a.test=Na(n,e.value),a.test===!1)throw new Pe("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return a.newDocument=n,a}else{if(e.op==="remove")return a.removed=n,a.newDocument=null,a;if(e.op==="_get")return e.value=n,a;if(t)throw new Pe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,n);return a}}else{r||(n=Kt(n));const o=(e.path||"").split("/");let u=n,c=1,l=o.length,d,h,f;for(typeof t=="function"?f=t:f=ju;;){if(h=o[c],h&&h.indexOf("~")!=-1&&(h=Cw(h)),s&&(h=="__proto__"||h=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(u[h]===void 0?d=o.slice(0,c).join("/"):c==l-1&&(d=e.path),d!==void 0&&f(e,0,n,d)),c++,Array.isArray(u)){if(h==="-")h=u.length;else{if(t&&!Iu(h))throw new Pe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,n);Iu(h)&&(h=~~h)}if(c>=l){if(t&&e.op==="add"&&h>u.length)throw new Pe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,n);const p=Rw[e.op].call(e,u,h,n);if(p.test===!1)throw new Pe("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return p}}else if(c>=l){const p=kr[e.op].call(e,u,h,n);if(p.test===!1)throw new Pe("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return p}if(u=u[h],t&&c<l&&(!u||typeof u!="object"))throw new Pe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,n)}}}function Ra(n,e,t,r=!0,s=!0){if(t&&!Array.isArray(e))throw new Pe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=Kt(n));const i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=Ps(n,e[a],t,!0,s,a),n=i[a].newDocument;return i.newDocument=n,i}function ju(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new Pe("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(kr[n.op]){if(typeof n.path!="string")throw new Pe("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new Pe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new Pe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new Pe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&Ru(n.value))throw new Pe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var s=n.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new Pe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new Pe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var a={op:"_get",path:n.from,value:void 0},o=Nw([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new Pe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new Pe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function Nw(n,e,t){try{if(!Array.isArray(n))throw new Pe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Ra(Kt(e),Kt(n),t||!0);else{t=t||ju;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(s){if(s instanceof Pe)return s;throw s}}function Na(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),s,i,a;if(t&&r){if(i=n.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!Na(n[s],e[s]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!Na(n[a],e[a]))return!1;return!0}return n!==n&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function np(n,e,t,r,s){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=Cu(e),a=Cu(n),o=!1,u=a.length-1;u>=0;u--){var c=a[u],l=n[c];if(ku(e,c)&&!(e[c]===void 0&&l!==void 0&&Array.isArray(e)===!1)){var d=e[c];typeof l=="object"&&l!=null&&typeof d=="object"&&d!=null&&Array.isArray(l)===Array.isArray(d)?np(l,d,t,r+"/"+br(c),s):l!==d&&(s&&t.push({op:"test",path:r+"/"+br(c),value:Kt(l)}),t.push({op:"replace",path:r+"/"+br(c),value:Kt(d)}))}else Array.isArray(n)===Array.isArray(e)?(s&&t.push({op:"test",path:r+"/"+br(c),value:Kt(l)}),t.push({op:"remove",path:r+"/"+br(c)}),o=!0):(s&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}))}if(!(!o&&i.length==a.length))for(var u=0;u<i.length;u++){var c=i[u];!ku(n,c)&&e[c]!==void 0&&t.push({op:"add",path:r+"/"+br(c),value:Kt(e[c])})}}}function jw(n,e,t=!1){var r=[];return np(n,e,r,"",t),r}var Mo={};const $w=()=>typeof window<"u"&&typeof window.document<"u",Lw=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Mw=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),rp=()=>typeof Deno<"u",Fw=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!rp(),Dw=()=>{let n;return $w()?n="browser":Fw()?n="node":Lw()?n="webworker":Mw()?n="jsdom":rp()?n="deno":n="other",n};let Fo;async function Uw(){return Fo===void 0&&(Fo={library:"langchain-js",runtime:Dw()}),Fo}function Oe(n){try{return typeof process<"u"?Mo==null?void 0:Mo[n]:void 0}catch{return}}class Bw{}class ii extends Bw{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Df(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Oe("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return cr.prototype.toJSON.call(this)}toJSONNotImplemented(){return cr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends ii{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:dn()}),Object.assign(this,e)}}return new t}}function Do(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function zw(n){return n.replace(/[-:.]/g,"")}function Hw(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return zw(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function ns(n){return typeof n._addRunToRunMap=="function"}class ai extends ii{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=Hw(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const s=this.runMap.get(r.parent_run_id);s&&(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,s,i,a,o,u){const c=this._getExecutionOrder(s),l=Date.now(),d=o?{...i,metadata:o}:i,h={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,t,r,s,i,a,o,u){var l,d;const c=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,s,i,a,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}_createRunForChatModelStart(e,t,r,s,i,a,o,u){const c=this._getExecutionOrder(s),l=Date.now(),d=o?{...i,metadata:o}:i,h={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,t,r,s,i,a,o,u){var l,d;const c=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,s,i,a,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((d=this.onLLMStart)==null?void 0:d.call(this,c)),c}async handleLLMEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onLLMEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleLLMError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onLLMError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}_createRunForChainStart(e,t,r,s,i,a,o,u){const c=this._getExecutionOrder(s),l=Date.now(),d={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,r,s,i,a,o,u){var l,d;const c=this.runMap.get(r)??this._createRunForChainStart(e,t,r,s,i,a,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((d=this.onChainStart)==null?void 0:d.call(this,c)),c}async handleChainEnd(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Do(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Do(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Do(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForToolStart(e,t,r,s,i,a,o){const u=this._getExecutionOrder(s),c=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(l)}async handleToolStart(e,t,r,s,i,a,o){var c,l;const u=this.runMap.get(r)??this._createRunForToolStart(e,t,r,s,i,a,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((l=this.onToolStart)==null?void 0:l.call(this,u)),u}async handleToolEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}_createRunForRetrieverStart(e,t,r,s,i,a,o){const u=this._getExecutionOrder(s),c=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(l)}async handleRetrieverStart(e,t,r,s,i,a,o){var c,l;const u=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,s,i,a,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((l=this.onRetrieverStart)==null?void 0:l.call(this,u)),u}async handleRetrieverEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,t,r,s,i,a){var u;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}let vi;const Zw=new Uint8Array(16);function Vw(){if(!vi&&(vi=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vi))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vi(Zw)}const qw=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ww(n){return typeof n=="string"&&qw.test(n)}const $e=[];for(let n=0;n<256;++n)$e.push((n+256).toString(16).slice(1));function Kw(n,e=0){return $e[n[e+0]]+$e[n[e+1]]+$e[n[e+2]]+$e[n[e+3]]+"-"+$e[n[e+4]]+$e[n[e+5]]+"-"+$e[n[e+6]]+$e[n[e+7]]+"-"+$e[n[e+8]]+$e[n[e+9]]+"-"+$e[n[e+10]]+$e[n[e+11]]+$e[n[e+12]]+$e[n[e+13]]+$e[n[e+14]]+$e[n[e+15]]}const Jw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),gd={randomUUID:Jw};function $u(n,e,t){if(gd.randomUUID&&!e&&!n)return gd.randomUUID();n=n||{};const r=n.random||(n.rng||Vw)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Kw(r)}var sp={},ip={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(u,c,l){this.fn=u,this.context=c,this.once=l||!1}function i(u,c,l,d,h){if(typeof l!="function")throw new TypeError("The listener must be a function");var f=new s(l,d||u,h),p=t?t+c:c;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],f]:u._events[p].push(f):(u._events[p]=f,u._eventsCount++),u}function a(u,c){--u._eventsCount===0?u._events=new r:delete u._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],l,d;if(this._eventsCount===0)return c;for(d in l=this._events)e.call(l,d)&&c.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},o.prototype.listeners=function(c){var l=t?t+c:c,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},o.prototype.listenerCount=function(c){var l=t?t+c:c,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(c,l,d,h,f,p){var y=t?t+c:c;if(!this._events[y])return!1;var _=this._events[y],b=arguments.length,E,v;if(_.fn){switch(_.once&&this.removeListener(c,_.fn,void 0,!0),b){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,l),!0;case 3:return _.fn.call(_.context,l,d),!0;case 4:return _.fn.call(_.context,l,d,h),!0;case 5:return _.fn.call(_.context,l,d,h,f),!0;case 6:return _.fn.call(_.context,l,d,h,f,p),!0}for(v=1,E=new Array(b-1);v<b;v++)E[v-1]=arguments[v];_.fn.apply(_.context,E)}else{var L=_.length,U;for(v=0;v<L;v++)switch(_[v].once&&this.removeListener(c,_[v].fn,void 0,!0),b){case 1:_[v].fn.call(_[v].context);break;case 2:_[v].fn.call(_[v].context,l);break;case 3:_[v].fn.call(_[v].context,l,d);break;case 4:_[v].fn.call(_[v].context,l,d,h);break;default:if(!E)for(U=1,E=new Array(b-1);U<b;U++)E[U-1]=arguments[U];_[v].fn.apply(_[v].context,E)}}return!0},o.prototype.on=function(c,l,d){return i(this,c,l,d,!1)},o.prototype.once=function(c,l,d){return i(this,c,l,d,!0)},o.prototype.removeListener=function(c,l,d,h){var f=t?t+c:c;if(!this._events[f])return this;if(!l)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===l&&(!h||p.once)&&(!d||p.context===d)&&a(this,f);else{for(var y=0,_=[],b=p.length;y<b;y++)(p[y].fn!==l||h&&!p[y].once||d&&p[y].context!==d)&&_.push(p[y]);_.length?this._events[f]=_.length===1?_[0]:_:a(this,f)}return this},o.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&a(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(ip);var Gw=ip.exports,lo={exports:{}},Xw=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const Qw=Xw;class ap extends Error{constructor(e){super(e),this.name="TimeoutError"}}const op=(n,e,t)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const i=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(u){s(u)}return}const a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new ap(a);typeof n.cancel=="function"&&n.cancel(),s(o)},e);Qw(n.then(r,s),()=>{clearTimeout(i)})});lo.exports=op;lo.exports.default=op;lo.exports.TimeoutError=ap;var Yw=lo.exports,Rc={},Nc={};Object.defineProperty(Nc,"__esModule",{value:!0});function ev(n,e,t){let r=0,s=n.length;for(;s>0;){const i=s/2|0;let a=r+i;t(n[a],e)<=0?(r=++a,s-=i+1):s=i}return r}Nc.default=ev;Object.defineProperty(Rc,"__esModule",{value:!0});const tv=Nc;class nv{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const s=tv.default(this._queue,r,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}Rc.default=nv;Object.defineProperty(sp,"__esModule",{value:!0});const rv=Gw,up=Yw,sv=Rc,Ei=()=>{},iv=new up.TimeoutError;class av extends rv{constructor(e){var t,r,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Ei,this._resolveIdle=Ei,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:sv.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Ei,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Ei,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,s)=>{const i=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&t.timeout===void 0?e():up.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(iv)});r(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var mn=sp.default=av;const ov=[400,401,403,404,405,406,407,408],uv=[409];let _d=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in mn?this.queue=new mn.default({concurrency:this.maxConcurrency}):this.queue=new mn({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>Ia(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const i=s==null?void 0:s.response,a=i==null?void 0:i.status;if(a){if(ov.includes(+a))throw s;if(uv.includes(+a))return;r&&await r(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};function yd(n){return typeof(n==null?void 0:n._getType)=="function"}function bd(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}var Ts={};let nn;const cv=()=>typeof window<"u"&&typeof window.document<"u",lv=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",dv=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),cp=()=>typeof Deno<"u",hv=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!cp(),fv=()=>nn||(cv()?nn="browser":hv()?nn="node":lv()?nn="webworker":dv()?nn="jsdom":cp()?nn="deno":nn="other",nn);let Uo;async function lp(){if(Uo===void 0){const n=fv(),e=gv();Uo={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:fp,...e}}return Uo}function pv(){const n=mv()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,s]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof s=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function mv(){try{return typeof process<"u"&&Ts?Object.entries(Ts).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function ft(n){try{return typeof process<"u"?Ts==null?void 0:Ts[n]:void 0}catch{return}}let Bo;function gv(){if(Bo!==void 0)return Bo;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=ft(t);r!==void 0&&(e[t]=r)}return Bo=e,e}function ge(n){if(!Ww(n))throw new Error(`Invalid UUID: ${n}`)}const wd={};function dp(n){wd[n]||(console.warn(n),wd[n]=!0)}async function vd(n){const e=await lp(),t=pv();return n.map(r=>{const s=r.extra??{},i=s.metadata;return r.extra={...s,runtime:{...e,...s==null?void 0:s.runtime},metadata:{...t,...t.revision_id||r.revision_id?{revision_id:r.revision_id??t.revision_id}:{},...i}},r})}const _v=()=>{const n=ft("LANGCHAIN_TRACING_SAMPLING_RATE");if(n===void 0)return;const e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},yv=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"},rn=async(n,e)=>{const t=await n.text();if(!n.ok)throw new Error(`Failed to ${e}: ${n.status} ${n.statusText} ${t}`)};async function bv(n){const e=[];for await(const t of n)e.push(t);return e}function zo(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const wv=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};class vv{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(t=>{this.items.push([e,t])})}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const t=[];for(;t.length<e&&this.items.length;){const r=this.items.shift();if(r)t.push(r);else break}return[t.map(r=>r[0]),()=>t.forEach(r=>r[1]())]}}const Ev=20971520;class ho{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new vv}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=ho.getDefaultClientConfig();this.tracingSampleRate=_v(),this.apiUrl=zo(e.apiUrl??t.apiUrl)??"",this.apiKey=zo(e.apiKey??t.apiKey),this.webUrl=zo(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new _d(e.callerOptions??{}),this.batchIngestCaller=new _d({...e.callerOptions??{},onFailedResponseHook:wv}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=ft("LANGCHAIN_API_KEY"),t=ft("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",r=ft("LANGCHAIN_HIDE_INPUTS")==="true",s=ft("LANGCHAIN_HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:yv(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${fp}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0;const s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(s));const i=`${this.apiUrl}${e}?${t}`,a=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);const o=await a.json();if(o.length===0||(yield o,o.length<s))break;r+=o.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){const i=t?{...t}:{};for(;;){const o=await(await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];const u=o.cursors;if(!u||!u.next)break;i.cursor=u.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const s of e)this.sampledPostUuids.has(s.id)&&(r.push(s),this.sampledPostUuids.delete(s.id));return r}else{const r=[];for(const s of e)Math.random()<this.tracingSampleRate&&(r.push(s),this.sampledPostUuids.add(s.id));return r}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){t();return}try{await this.batchIngestRuns({runCreates:e.filter(r=>r.action==="create").map(r=>r.item),runUpdates:e.filter(r=>r.action==="update").map(r=>r.item)})}finally{t()}}}async processRunOperation(e,t){const r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const s=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),s}async _getServerInfo(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch{return!1}return!0}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const i=await vd([s]),a=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await rn(a,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){var c,l;if(e===void 0&&t===void 0)return;let r=(e==null?void 0:e.map(d=>this.prepareRunCreateOrUpdateInputs(d)))??[],s=(t==null?void 0:t.map(d=>this.prepareRunCreateOrUpdateInputs(d)))??[];if(r.length>0&&s.length>0){const d=r.reduce((f,p)=>(p.id&&(f[p.id]=p),f),{}),h=[];for(const f of s)f.id!==void 0&&d[f.id]?d[f.id]={...d[f.id],...f}:h.push(f);r=Object.values(d),s=h}const i={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!i.post.length&&!i.patch.length)return;if(r=await vd(r),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const d of i.post)await this.createRun(d);for(const d of i.patch)d.id!==void 0&&await this.updateRun(d.id,d);return}const a=((l=(c=this.serverInfo)==null?void 0:c.batch_ingest_config)==null?void 0:l.size_limit_bytes)??Ev,o={post:[],patch:[]};let u=0;for(const d of["post","patch"]){const h=d,f=i[h].reverse();let p=f.pop();for(;p!==void 0;){const y=JSON.stringify(p);u>0&&u+y.length>a&&(await this._postBatchIngestRuns(JSON.stringify(o)),u=0,o.post=[],o.patch=[]),u+=y.length,o[h].push(p),p=f.pop()}}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(o))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await rn(r,"batch create run")}async updateRun(e,t){ge(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await rn(i,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){ge(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:ft("LANGCHAIN_PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await bv(this.listRuns({id:e.child_run_ids})),r={},s={};t.sort((i,a)=>((i==null?void 0:i.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=r[e.id]||[];for(const i in r)i!==e.id&&(s[i].child_runs=r[i]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:u,isRoot:c,runType:l,error:d,id:h,query:f,filter:p,traceFilter:y,treeFilter:_,limit:b,select:E}=e;let v=[];if(t&&(v=Array.isArray(t)?t:[t]),r){const q=Array.isArray(r)?r:[r],Ae=await Promise.all(q.map(me=>this.readProject({projectName:me}).then(Me=>Me.id)));v.push(...Ae)}const L=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],U={session:v.length?v:null,run_type:l,reference_example:a,query:f,filter:p,trace_filter:y,tree_filter:_,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:d,id:h,limit:b,trace:i,select:E||L,is_root:c};let R=0;for await(const q of this._getCursorPaginatedList("/runs/query",U))if(b){if(R>=b)break;if(q.length+R>b){yield*q.slice(0,b-R);break}R+=q.length,yield*q}else yield*q}async getRunStats({id:e,trace:t,parentRun:r,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:u,endTime:c,error:l,query:d,filter:h,traceFilter:f,treeFilter:p,isRoot:y,dataSourceType:_}){let b=a||[];i&&(b=[...a||[],...await Promise.all(i.map(R=>this.readProject({projectName:R}).then(q=>q.id)))]);const v=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:s,session:b,reference_example:o,start_time:u,end_time:c,error:l,query:d,filter:h,trace_filter:f,tree_filter:p,is_root:y,data_source_type:_}).filter(([R,q])=>q!==void 0));return await(await this.caller.call(fetch,`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(v),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||$u()};ge(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){ge(e);const t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await rn(t,"unshare run")}async readRunSharedLink(e){ge(e);const r=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)r.append("id",a);return ge(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),ge(e);const s=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};ge(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){ge(e);const t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await rn(t,"unshare dataset")}async readSharedDataset(e){return ge(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=i||{};r&&(c.metadata=r);const l={name:e,extra:c,description:t};a!==null&&(l.reference_dataset_id=a);const d=await this.caller.call(fetch,u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),h=await d.json();if(!d.ok)throw new Error(`Failed to create session ${e}: ${d.status} ${d.statusText}`);return h}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=i;s&&(u={...u||{},metadata:s});const c={name:t,extra:u,description:r,end_time:a?new Date(a).toISOString():null},l=await this.caller.call(fetch,o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),d=await l.json();if(!l.ok)throw new Error(`Failed to update project ${e}: ${l.status} ${l.statusText}`);return d}async hasProject({projectId:e,projectName:t}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ge(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(fetch,`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ge(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&i.append("include_stats",r.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a}={}){const o=new URLSearchParams;if(e!==void 0)for(const u of e)o.append("id",u);if(t!==void 0&&o.append("name",t),r!==void 0&&o.append("name_contains",r),s!==void 0)o.append("reference_dataset",s);else if(i!==void 0){const u=await this.readDataset({datasetName:i});o.append("reference_dataset",u.id)}a!==void 0&&o.append("reference_free",a.toString());for await(const u of this._getPaginated("/sessions",o))yield*u}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,ge(r);const s=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await rn(s,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:i,dataType:a,name:o}){const u=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),r.forEach(h=>{c.append("input_keys",h)}),s.forEach(h=>{c.append("output_keys",h)}),i&&c.append("description",i),a&&c.append("data_type",a),o&&c.append("name",o);const l=await this.caller.call(fetch,u,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!l.ok){const h=await l.json();throw h.detail&&h.detail.includes("already exists")?new Error(`Dataset ${t} already exists`):new Error(`Failed to upload CSV: ${l.status} ${l.statusText}`)}return await l.json()}async createDataset(e,{description:t,dataType:r}={}){const s={name:e,description:t};r&&(s.data_type=r);const i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok){const o=await i.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)ge(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:i}={}){const a="/datasets",o=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const u of r)o.append("id",u);s!==void 0&&o.append("name",s),i!==void 0&&o.append("name_contains",i);for await(const u of this._getPaginated(a,o))yield*u}async updateDataset(e){const{datasetId:t,datasetName:r,...s}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:r})).id;ge(i);const a=await this.caller.call(fetch,`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to update dataset ${i}: ${a.status} ${a.statusText}`);return await a.json()}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)ge(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to delete ${r}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:i,exampleId:a,metadata:o,split:u}){let c=r;if(c===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:s})).id);const l=i||new Date,d={dataset_id:c,inputs:e,outputs:t,created_at:l==null?void 0:l.toISOString(),id:a,metadata:o,split:u},h=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!h.ok)throw new Error(`Failed to create example: ${h.status} ${h.statusText}`);return await h.json()}async createExamples(e){const{inputs:t,outputs:r,metadata:s,sourceRunIds:i,exampleIds:a,datasetId:o,datasetName:u}=e;let c=o;if(c===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:u})).id);const l=t.map((f,p)=>({dataset_id:c,inputs:f,outputs:r?r[p]:void 0,metadata:s?s[p]:void 0,split:e.splits?e.splits[p]:void 0,id:a?a[p]:void 0,source_run_id:i?i[p]:void 0})),d=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!d.ok)throw new Error(`Failed to create examples: ${d.status} ${d.statusText}`);return await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const s=e.map(a=>yd(a)?bd(a):a),i=yd(t)?bd(t):t;return this.createExample({input:s},{output:i},r)}async readExample(e){ge(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:u,offset:c,filter:l}={}){let d;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(t!==void 0)d=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const h=new URLSearchParams({dataset:d}),f=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;f&&h.append("as_of",f);const p=a??!0;if(h.append("inline_s3_urls",p.toString()),r!==void 0)for(const _ of r)h.append("id",_);if(i!==void 0)for(const _ of i)h.append("splits",_);if(o!==void 0){const _=JSON.stringify(o);h.append("metadata",_)}u!==void 0&&h.append("limit",u.toString()),c!==void 0&&h.append("offset",c.toString()),l!==void 0&&h.append("filter",l);let y=0;for await(const _ of this._getPaginated("/examples",h)){for(const b of _)yield b,y++;if(u!==void 0&&y>=u)break}}async deleteExample(e){ge(e);const t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){ge(e);const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async updateExamples(e){const t=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!t.ok)throw new Error(`Failed to update examples: ${t.status} ${t.statusText}`);return await t.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,ge(s);const i=new URLSearchParams,a=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,ge(a);const o={split_name:r,examples:s.map(c=>(ge(c),c)),remove:i},u=await this.caller.call(fetch,`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await rn(u,"update dataset splits")}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){dp("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,i),[u,c]=await this._logEvaluationFeedback(o,a,r);return c[0]}async createFeedback(e,t,{score:r,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:l,feedbackConfig:d,projectId:h,comparativeExperimentId:f}){var E;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const p={type:u??"api",metadata:o??{}};c!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:c}),(p==null?void 0:p.metadata)!==void 0&&((E=p.metadata.__run)==null?void 0:E.run_id)!==void 0&&ge(p.metadata.__run.run_id);const y={id:l??$u(),run_id:e,key:t,score:r,value:s,correction:i,comment:a,feedback_source:p,comparative_experiment_id:f,feedbackConfig:d,session_id:h},_=`${this.apiUrl}/feedback`,b=await this.caller.call(fetch,_,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await rn(b,"create feedback"),y}async updateFeedback(e,{score:t,value:r,correction:s,comment:i}){const a={};t!=null&&(a.score=t),r!=null&&(a.value=r),s!=null&&(a.correction=s),i!=null&&(a.comment=i),ge(e);const o=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await rn(o,"update feedback")}async readFeedback(e){ge(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){ge(e);const t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw new Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const i of t)s.append("key",i);if(r)for(const i of r)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:s}={}){const i={run_id:e,feedback_key:t,feedback_config:s};return r?typeof r=="string"?i.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(i.expires_in=r):i.expires_in={hours:3},await(await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:s,description:i,metadata:a,id:o}){var l;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:i,created_at:(l=s??new Date)==null?void 0:l.toISOString(),extra:{}};return a&&(u.extra.metadata=a),await(await this.caller.call(fetch,`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){ge(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){const s=this._selectEvalResults(e),i=[];for(const a of s){let o=r||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let u=null;a.targetRunId?u=a.targetRunId:t&&(u=t.id),i.push(await this.createFeedback(u,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,t,r){const[s]=await this._logEvaluationFeedback(e,t,r);return s}}const Av=n=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>ft(t)==="true");function xv(n){return n.replace(/[-:.]/g,"")}function Ov(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return xv(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}class ja{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let r={},s=[];for(const i of t){const[a,o]=i.split("="),u=decodeURIComponent(o);a==="langsmith-metadata"?r=JSON.parse(u):a==="langsmith-tags"&&(s=u.split(","))}return new ja(r,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class Rn{constructor(e){var o;Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=Rn.getDefaultConfig(),{metadata:r,...s}=e,i=s.client??new ho,a={...r,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:a},Object.assign(this,{...t,...s,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const u=Ov(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}static getDefaultConfig(){return{id:$u(),run_type:"chain",project_name:ft("LANGCHAIN_PROJECT")??ft("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:ft("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:ft("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}createChild(e){var u,c,l,d,h,f;const t=this.child_execution_order+1,r=new Rn({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t}),s=Symbol.for("lc:child_config"),i=((u=e.extra)==null?void 0:u[s])??this.extra[s];if(Pv(i)){const p={...i},y=Sv(p.callbacks)?(l=(c=p.callbacks).copy)==null?void 0:l.call(c):void 0;y&&(Object.assign(y,{_parentRunId:r.id}),(f=(h=(d=y.handlers)==null?void 0:d.find(hp))==null?void 0:h.updateFromRunTree)==null||f.call(h,r),p.callbacks=y),r.extra[s]=p}const a=new Set;let o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now()){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r}_convertToCreate(e,t,r=!0){var u;const s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(const[c,l]of Object.entries(t))s.runtime[c]||(s.runtime[c]=l);let i,a;return r?(a=(u=e.parent_run)==null?void 0:u.id,i=[]):(i=e.child_runs.map(c=>this._convertToCreate(c,t,r)),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){const t=await lp(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){dp("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}async patchRun(){var t;const e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(t=this.parent_run)==null?void 0:t.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,e)}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){var c,l,d,h;const r=e==null?void 0:e.callbacks;let s,i,a,o=Av();if(r){const f=((c=r==null?void 0:r.getParentRunId)==null?void 0:c.call(r))??"",p=(l=r==null?void 0:r.handlers)==null?void 0:l.find(y=>(y==null?void 0:y.name)=="langchain_tracer");s=(d=p==null?void 0:p.getRun)==null?void 0:d.call(p,f),i=p==null?void 0:p.projectName,a=p==null?void 0:p.client,o=o||!!p}return s?new Rn({name:s.name,id:s.id,client:a,tracingEnabled:o,project_name:i,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(h=s==null?void 0:s.extra)==null?void 0:h.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new Rn({...t,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var c;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;const i=s.trim(),a=i.split(".").map(l=>{const[d,h]=l.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:h}}),o=a[0].uuid,u={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(c=a.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:i};if(r.baggage&&typeof r.baggage=="string"){const l=ja.fromHeader(r.baggage);u.metadata=l.metadata,u.tags=l.tags}return new Rn(u)}toHeaders(e){var r;const t={"langsmith-trace":this.dotted_order,baggage:new ja((r=this.extra)==null?void 0:r.metadata,this.tags).toHeader()};if(e)for(const[s,i]of Object.entries(t))e.set(s,i);return t}}function hp(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function Ed(n){return Array.isArray(n)&&n.some(e=>hp(e))}function Sv(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function Pv(n){var e;return n!==void 0&&typeof n.callbacks=="object"&&(Ed((e=n.callbacks)==null?void 0:e.handlers)||Ed(n.callbacks))}const fp="0.1.39";var jc={exports:{}};jc.exports;(function(n){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,r=(i=0)=>(a,o,u)=>`\x1B[${38+i};2;${a};${o};${u}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,u]of Object.entries(a)){for(const[c,l]of Object.entries(u))a[c]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},u[c]=a[c],i.set(l[0],l[1]);Object.defineProperty(a,o,{value:u,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,u,c)=>o===u&&u===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:c}=u.groups;c.length===3&&(c=c.split("").map(d=>d+d).join(""));const l=Number.parseInt(c,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:s})})(jc);var Tv=jc.exports;const pp=Pc(Tv);function He(n,e){return`${n.open}${e}${n.close}`}function vt(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function xn(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Xe}=pp;class Ad extends ai{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?He(pp.bold,o):o}).join(" > ");return He(Xe.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${He(Xe.green,"[chain/start]")} [${t}] Entering Chain run with input: ${vt(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${He(Xe.cyan,"[chain/end]")} [${t}] [${xn(e)}] Exiting Chain run with output: ${vt(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${He(Xe.red,"[chain/error]")} [${t}] [${xn(e)}] Chain run errored with error: ${vt(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${He(Xe.green,"[llm/start]")} [${t}] Entering LLM run with input: ${vt(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${He(Xe.cyan,"[llm/end]")} [${t}] [${xn(e)}] Exiting LLM run with output: ${vt(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${He(Xe.red,"[llm/error]")} [${t}] [${xn(e)}] LLM run errored with error: ${vt(e.error,"[error]")}`)}onToolStart(e){var r;const t=this.getBreadcrumbs(e);console.log(`${He(Xe.green,"[tool/start]")} [${t}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,s;const t=this.getBreadcrumbs(e);console.log(`${He(Xe.cyan,"[tool/end]")} [${t}] [${xn(e)}] Exiting Tool run with output: "${(s=(r=e.outputs)==null?void 0:r.output)==null?void 0:s.trim()}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${He(Xe.red,"[tool/error]")} [${t}] [${xn(e)}] Tool run errored with error: ${vt(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${He(Xe.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${vt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${He(Xe.cyan,"[retriever/end]")} [${t}] [${xn(e)}] Exiting Retriever run with output: ${vt(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${He(Xe.red,"[retriever/error]")} [${t}] [${xn(e)}] Retriever run errored with error: ${vt(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${He(Xe.blue,"[agent/action]")} [${r}] Agent selected action: ${vt(t.actions[t.actions.length-1],"[action]")}`)}}class ks extends ai{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:s}=e;this.projectName=r??Oe("LANGCHAIN_PROJECT")??Oe("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new ho({});const i=ks.getTraceableRunTree();i&&this.updateFromRunTree(i)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await Uw()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();const s=[t];for(;s.length>0;){const i=s.shift();!i||r.has(i.id)||(r.add(i.id),this.runMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},r=[];for(const[s,i]of this.runMap){const a=new Rn({...i,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=a,r.push([s,i.dotted_order])}r.sort((s,i)=>!s[1]||!i[1]?0:s[1].localeCompare(i[1]));for(const[s]of r){const i=this.runMap.get(s),a=t[s];if(!(!i||!a)&&i.parent_run_id){const o=t[i.parent_run_id];o&&(o.child_runs.push(a),a.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return Tw()}catch{return}}}let Ho;function kv(){const n="default"in mn?mn.default:mn;return new n({autoStart:!0,concurrency:1})}async function Re(n,e){e===!0?await n():(typeof Ho>"u"&&(Ho=kv()),Ho.add(n))}const Cv=n=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Oe(t)==="true");class Iv{setHandler(e){return this.setHandlers([e])}}class fo{constructor(e,t,r,s,i,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>Re(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class Rv extends fo{getChild(e){const t=new ut(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>Re(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>Re(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class xd extends fo{async handleLLMNewToken(e,t,r,s,i,a){await Promise.all(this.handlers.map(o=>Re(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(c){if(console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`),o.raiseError)throw c}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>Re(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>Re(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class Nv extends fo{getChild(e){const t=new ut(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,s,i){await Promise.all(this.handlers.map(a=>Re(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if(console.error(`Error in handler ${a.constructor.name}, handleChainError: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleChainEnd(e,t,r,s,i){await Promise.all(this.handlers.map(a=>Re(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if(console.error(`Error in handler ${a.constructor.name}, handleChainEnd: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>Re(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>Re(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class jv extends fo{getChild(e){const t=new ut(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>Re(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>Re(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class ut extends Iv{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,l)=>{const d=l===0&&r?r:dn();return await Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return ns(h)&&h._createRunForLLMStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,u),Re(async()=>{var f;try{await((f=h.handleLLMStart)==null?void 0:f.call(h,e,[c],d,this._parentRunId,i,this.tags,this.metadata,u))}catch(p){if(console.error(`Error in handler ${h.constructor.name}, handleLLMStart: ${p}`),h.raiseError)throw p}},h.awaitHandlers)})),new xd(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,l)=>{const d=l===0&&r?r:dn();return await Promise.all(this.handlers.map(h=>{if(!h.ignoreLLM)return ns(h)&&h._createRunForChatModelStart(e,[c],d,this._parentRunId,i,this.tags,this.metadata,u),Re(async()=>{var f,p;try{if(h.handleChatModelStart)await((f=h.handleChatModelStart)==null?void 0:f.call(h,e,[c],d,this._parentRunId,i,this.tags,this.metadata,u));else if(h.handleLLMStart){const y=zf(c);await((p=h.handleLLMStart)==null?void 0:p.call(h,e,[y],d,this._parentRunId,i,this.tags,this.metadata,u))}}catch(y){if(console.error(`Error in handler ${h.constructor.name}, handleLLMStart: ${y}`),h.raiseError)throw y}},h.awaitHandlers)})),new xd(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=dn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return ns(u)&&u._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,s,o),Re(async()=>{var c;try{await((c=u.handleChainStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,s,o))}catch(l){if(console.error(`Error in handler ${u.constructor.name}, handleChainStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Nv(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=dn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return ns(u)&&u._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),Re(async()=>{var c;try{await((c=u.handleToolStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if(console.error(`Error in handler ${u.constructor.name}, handleToolStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new jv(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=dn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return ns(u)&&u._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),Re(async()=>{var c;try{await((c=u.handleRetrieverStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if(console.error(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Rv(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,s,i){await Promise.all(this.handlers.map(a=>Re(async()=>{var o;if(!a.ignoreCustomEvent)try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,r,this.tags,this.metadata))}catch(u){if(console.error(`Error in handler ${a.constructor.name}, handleCustomEvent: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new ut(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);r.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);r.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends ii{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:dn()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,s,i,a,o){return this._configureSync(e,t,r,s,i,a,o)}static _configureSync(e,t,r,s,i,a,o){var h,f;let u;(e||t)&&(Array.isArray(e)||!e?(u=new ut,u.setHandlers((e==null?void 0:e.map($a))??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map($a):t==null?void 0:t.handlers,!1));const c=Oe("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),l=((h=ks.getTraceableRunTree())==null?void 0:h.tracingEnabled)||Cv(),d=l||(Oe("LANGCHAIN_TRACING")??!1);if(c||d){if(u||(u=new ut),c&&!u.handlers.some(p=>p.name===Ad.prototype.name)){const p=new Ad;u.addHandler(p,!0)}if(d&&!u.handlers.some(p=>p.name==="langchain_tracer")&&l){const p=new ks;u.addHandler(p,!0),u._parentRunId=((f=ks.getTraceableRunTree())==null?void 0:f.id)??u._parentRunId}}return(r||s)&&u&&(u.addTags(r??[]),u.addTags(s??[],!1)),(i||a)&&u&&(u.addMetadata(i??{}),u.addMetadata(a??{},!1)),u}}function $a(n){return"name"in n?n:ii.fromMethods(n)}class $v{getStore(){}run(e,t){return t()}}const Lv=new $v,Zo=Symbol.for("ls:tracing_async_local_storage"),Od=Symbol.for("lc:child_config");class Mv{getInstance(){return globalThis[Zo]??Lv}getRunnableConfig(){var t,r;return(r=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:r[Od]}runWithConfig(e,t,r){var c;const s=ut._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),i=this.getInstance(),a=s==null?void 0:s.getParentRunId(),o=(c=s==null?void 0:s.handlers)==null?void 0:c.find(l=>(l==null?void 0:l.name)==="langchain_tracer");let u;return o&&a?u=o.convertToRunTree(a):r||(u=new Rn({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[Od]:e}),i.run(u,t)}initializeGlobalInstance(e){globalThis[Zo]===void 0&&(globalThis[Zo]=e)}}const hr=new Mv;class lt extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const t=e.getReader();return new lt({start(r){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){r.close();return}return r.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new lt({async pull(t){const{value:r,done:s}=await e.next();s&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function mp(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const i=await n.next();for(const a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function Gt(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,s]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=Gt(t[r],s):t[r]=s;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class Gr{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.setup=new Promise((t,r)=>{hr.runWithConfig(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(s=>t(void 0),r)},!0)})}async next(...e){return this.firstResultUsed?hr.runWithConfig(this.config,async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}async function Fv(n,e,t,...r){const s=new Gr({generator:e,startSetup:t}),i=await s.setup;return{output:n(s,i,...r),setup:i}}class Tn{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=Ra({},t);return new Qs({ops:t,state:r[r.length-1].newDocument})}}class Qs extends Tn{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=Ra(this.state,e.ops);return new Qs({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=Ra({},e.ops);return new Qs({ops:e.ops,state:t[t.length-1].newDocument})}}const gp=n=>n.name==="log_stream_tracer";async function Sd(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function Pd(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function Dv(n){return n!==void 0&&n.message!==void 0}class Td extends ai{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=lt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Tn({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Tn({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await Sd(e,this._schemaFormat)),await this.writer.write(new Tn({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await Sd(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await Pd(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Tn({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new Tn({ops:[{op:"replace",path:"/final_output",value:await Pd(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const i=e.inputs.messages!==void 0;let a;i?Dv(r==null?void 0:r.chunk)?a=r==null?void 0:r.chunk:a=new pr(t):a=t;const o=new Tn({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const kd="__run";class qr{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new qr({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Wr extends qr{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Wr({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function Ai({name:n,serialized:e}){return n!==void 0?n:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const _p=n=>n.name==="event_stream_tracer";class Uv extends ai{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=lt.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function i(o,u){return o==="llm"&&typeof u=="string"?new qr({text:u}):u}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(u=>{o=u}),this.tappedPromises.set(e,a);try{const u={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...u,data:{chunk:i(s.runType,r.value)}},s),yield r.value;for await(const c of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...u,data:{chunk:i(s.runType,c)}},s),yield c}finally{o()}}else{yield r.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var a,o;const t=Ai(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);const i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,r){const s=this.runInfoMap.get(e.id);let i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(e.parent_run_id!==void 0){if(s.runType==="chat_model")a="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?i=new pr({content:t}):i=r.chunk.message;else if(s.runType==="llm")a="on_llm_stream",(r==null?void 0:r.chunk)===void 0?i=new qr({text:t}):i=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var a,o,u;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(a=e.outputs)==null?void 0:a.generations;let i;if(t.runType==="chat_model"){for(const c of s??[]){if(i!==void 0)break;i=(o=c[0])==null?void 0:o.message}r="on_chat_model_end"}else if(t.runType==="llm")i={generations:s==null?void 0:s.map(c=>c.map(l=>({text:l.text,generationInfo:l.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var a,o;const t=Ai(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,i;const t=Ai(e),r={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},r)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var i,a;const t=Ai(e),s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},s)}async onRetrieverEnd(e){var r;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const Vo=25;async function Xt(n){return ut._configureSync(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function Cd(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const s=e[r]??[];e[r]=[...new Set(s.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="callbacks"){const s=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{const a=s.copy();for(const o of i)a.addHandler($a(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){const a=i.copy();for(const o of s)a.addHandler($a(o),!0);e.callbacks=a}else e.callbacks=new ut(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{const s=r;e[s]=t[s]??e[s]}return e}const Bv=new Set(["string","number","boolean"]);function de(n){var r;const e=hr.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:i,...a}=e;t=Object.entries(a).reduce((o,[u,c])=>(c!==void 0&&(o[u]=c),o),t)}if(n&&(t=Object.entries(n).reduce((s,[i,a])=>(a!==void 0&&(s[i]=a),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))Bv.has(typeof t.configurable[s])&&!((r=t.metadata)!=null&&r[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);return t}function qe(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:s,configurable:i,runId:a}={}){const o=de(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}const zv=[400,401,402,403,404,405,406,407,409],Hv=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&zv.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(n==null?void 0:n.message);throw s.name="InsufficientQuotaError",s}};class po{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Hv;const t="default"in mn?mn.default:mn;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Ia(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class yp extends ai{constructor({config:e,onStart:t,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}function $c(n){return n?n.lc_runnable:!1}class Zv{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||s.some(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&s.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}}const Vv=Symbol("Let zodToJsonSchema decide on which parser to use"),qv={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Wv=n=>({...qv,...n}),Kv=n=>{const e=Wv(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function bp(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function he(n,e,t,r,s){n[e]=t,bp(n,e,r,s)}function Jv(){return{}}function Gv(n,e){var r,s;const t={type:"array"};return((s=(r=n.type)==null?void 0:r._def)==null?void 0:s.typeName)!==k.ZodAny&&(t.items=ie(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&he(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&he(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(he(t,"minItems",n.exactLength.value,n.exactLength.message,e),he(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Xv(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?he(t,"minimum",r.value,r.message,e):he(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),he(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?he(t,"maximum",r.value,r.message,e):he(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),he(t,"maximum",r.value,r.message,e));break;case"multipleOf":he(t,"multipleOf",r.value,r.message,e);break}return t}function Qv(){return{type:"boolean"}}function Yv(n,e){return ie(n.type._def,e)}const e0=(n,e)=>ie(n.innerType._def,e);function wp(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>wp(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return t0(n,e)}}const t0=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":he(t,"minimum",r.value,r.message,e);break;case"max":he(t,"maximum",r.value,r.message,e);break}return t};function n0(n,e){return{...ie(n.innerType._def,e),default:n.defaultValue()}}function r0(n,e){return e.effectStrategy==="input"?ie(n.schema._def,e):{}}function s0(n){return{type:"string",enum:n.values}}const i0=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function a0(n,e){const t=[ie(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ie(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(i0(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;a=u}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function o0(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let qo;const Wn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(qo===void 0&&(qo=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),qo),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function vp(n,e){const t={type:"string"};function r(s){return e.patternStrategy==="escape"?u0(s):s}if(n.checks)for(const s of n.checks)switch(s.kind){case"min":he(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":he(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Et(t,"email",s.message,e);break;case"format:idn-email":Et(t,"idn-email",s.message,e);break;case"pattern:zod":At(t,Wn.email,s.message,e);break}break;case"url":Et(t,"uri",s.message,e);break;case"uuid":Et(t,"uuid",s.message,e);break;case"regex":At(t,s.regex,s.message,e);break;case"cuid":At(t,Wn.cuid,s.message,e);break;case"cuid2":At(t,Wn.cuid2,s.message,e);break;case"startsWith":At(t,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":At(t,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":Et(t,"date-time",s.message,e);break;case"date":Et(t,"date",s.message,e);break;case"time":Et(t,"time",s.message,e);break;case"duration":Et(t,"duration",s.message,e);break;case"length":he(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),he(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{At(t,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Et(t,"ipv4",s.message,e),s.version!=="v4"&&Et(t,"ipv6",s.message,e);break}case"emoji":At(t,Wn.emoji,s.message,e);break;case"ulid":{At(t,Wn.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Et(t,"binary",s.message,e);break}case"contentEncoding:base64":{he(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{At(t,Wn.base64,s.message,e);break}}break}case"nanoid":At(t,Wn.nanoid,s.message,e)}return t}const u0=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Et=(n,e,t,r)=>{var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):he(n,"format",e,t,r)},At=(n,e,t,r)=>{var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:Id(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):he(n,"pattern",Id(e,r),t,r)},Id=(n,e)=>{var c;const t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=r.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,u=!1;for(let l=0;l<s.length;l++){if(a){i+=s[l],a=!1;continue}if(r.i){if(o){if(s[l].match(/[a-z]/)){u?(i+=s[l],i+=`${s[l-2]}-${s[l]}`.toUpperCase(),u=!1):s[l+1]==="-"&&((c=s[l+2])!=null&&c.match(/[a-z]/))?(i+=s[l],u=!0):i+=`${s[l]}${s[l].toUpperCase()}`;continue}}else if(s[l].match(/[a-z]/)){i+=`[${s[l]}${s[l].toUpperCase()}]`;continue}}if(r.m){if(s[l]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[l]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&s[l]==="."){i+=o?`${s[l]}\r
`:`[${s[l]}\r
]`;continue}i+=s[l],s[l]==="\\"?a=!0:o&&s[l]==="]"?o=!1:!o&&s[l]==="["&&(o=!0)}try{const l=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function Ep(n,e){var r,s,i,a;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===k.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,u)=>({...o,[u]:ie(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:ie(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===k.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const o=Object.entries(vp(n.keyType._def,e)).reduce((u,[c,l])=>c==="type"?u:{...u,[c]:l},{});return{...t,propertyNames:o}}else if(((a=n.keyType)==null?void 0:a._def.typeName)===k.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function c0(n,e){if(e.mapStrategy==="record")return Ep(n,e);const t=ie(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=ie(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function l0(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function d0(){return{not:{}}}function h0(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const La={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function f0(n,e){if(e.target==="openApi3")return Rd(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in La&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=La[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return Rd(n,e)}const Rd=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>ie(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function p0(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:La[n.innerType._def.typeName],nullable:!0}:{type:[La[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ie(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=ie(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function m0(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",bp(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?he(t,"minimum",r.value,r.message,e):he(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),he(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?he(t,"maximum",r.value,r.message,e):he(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),he(t,"maximum",r.value,r.message,e));break;case"multipleOf":he(t,"multipleOf",r.value,r.message,e);break}return t}function g0(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":ie(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":ie(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function _0(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[s,i])=>{if(i===void 0||i._def===void 0)return r;const a=ie(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?r:{properties:{...r.properties,[s]:a},required:i.isOptional()?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:g0(n,e)};return t.required.length||delete t.required,t}const y0=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return ie(n.innerType._def,e);const t=ie(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},b0=(n,e)=>{if(e.pipeStrategy==="input")return ie(n.in._def,e);if(e.pipeStrategy==="output")return ie(n.out._def,e);const t=ie(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ie(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function w0(n,e){return ie(n.type._def,e)}function v0(n,e){const r={type:"array",uniqueItems:!0,items:ie(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&he(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&he(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function E0(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>ie(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:ie(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>ie(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function A0(){return{not:{}}}function x0(){return{}}const O0=(n,e)=>ie(n.innerType._def,e);function ie(n,e,t=!1){var a;const r=e.seen.get(n);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,n,e,r,t);if(o!==Vv)return o}if(r&&!t){const o=S0(r,e);if(o!==void 0)return o}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=T0(n,n.typeName,e);return i&&k0(n,e,i),s.jsonSchema=i,i}const S0=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:P0(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},P0=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},T0=(n,e,t)=>{switch(e){case k.ZodString:return vp(n,t);case k.ZodNumber:return m0(n,t);case k.ZodObject:return _0(n,t);case k.ZodBigInt:return Xv(n,t);case k.ZodBoolean:return Qv();case k.ZodDate:return wp(n,t);case k.ZodUndefined:return A0();case k.ZodNull:return h0(t);case k.ZodArray:return Gv(n,t);case k.ZodUnion:case k.ZodDiscriminatedUnion:return f0(n,t);case k.ZodIntersection:return a0(n,t);case k.ZodTuple:return E0(n,t);case k.ZodRecord:return Ep(n,t);case k.ZodLiteral:return o0(n,t);case k.ZodEnum:return s0(n);case k.ZodNativeEnum:return l0(n);case k.ZodNullable:return p0(n,t);case k.ZodOptional:return y0(n,t);case k.ZodMap:return c0(n,t);case k.ZodSet:return v0(n,t);case k.ZodLazy:return ie(n.getter()._def,t);case k.ZodPromise:return w0(n,t);case k.ZodNaN:case k.ZodNever:return d0();case k.ZodEffects:return r0(n,t);case k.ZodAny:return Jv();case k.ZodUnknown:return x0();case k.ZodDefault:return n0(n,t);case k.ZodBranded:return Yv(n,t);case k.ZodReadonly:return O0(n,t);case k.ZodCatch:return e0(n,t);case k.ZodPipeline:return b0(n,t);case k.ZodFunction:case k.ZodVoid:case k.ZodSymbol:return;default:return(r=>{})()}},k0=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),oi=(n,e)=>{const t=Kv(e),r=void 0,s=e==null?void 0:e.name,i=ie(n._def,t,!1)??{},a=s===void 0?r?{...i,[t.definitionPath]:r}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function Wo(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}function C0(n,e){const t=e[n.source]??n.source,r=e[n.target]??n.target;return[t,r]}function I0(n){let e="";for(const[t,r]of Object.entries(n))e+=`	classDef ${t}class fill:${r};
`;return e}function R0(n,e,t){const{firstNodeLabel:r,lastNodeLabel:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{};let c=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const d="default",h={[d]:"{0}([{1}]):::otherclass"};r!==void 0&&(h[r]="{0}[{0}]:::startclass"),s!==void 0&&(h[s]="{0}[{0}]:::endclass");for(const f of Object.values(n)){const p=h[f]??h[d],y=Wo(f),_=f.split(":"),b=_[_.length-1];c+=`	${p.replace(/\{0\}/g,y).replace(/\{1\}/g,b)};
`}}let l="";for(const d of e){const h=d.source.includes(":")?d.source.split(":")[0]:void 0,f=d.target.includes(":")?d.target.split(":")[0]:void 0;l!==""&&(l!==h||l!==f)&&(c+=`	end
`,l=""),l===""&&h!==void 0&&h===f&&(c=`	subgraph ${h}
`,l=h);const[p,y]=C0(d,n);let _="";if(d.data!==void 0){let b=d.data;const E=b.split(" ");E.length>u&&(b=E.reduce((v,L,U)=>(U%u===0&&v.push(""),v[v.length-1]+=` ${L}`,v),[]).join("<br>")),d.conditional?_=` -. ${b} .-> `:_=` -- ${b} --> `}else d.conditional?_=" -.-> ":_=" --> ";c+=`	${Wo(p)}${_}${Wo(y)};
`}return l!==""&&(c+=`end
`),a&&i!==void 0&&(c+=I0(i)),c}async function N0(n,e){let{backgroundColor:t="white"}=e??{};const r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${r}?bgColor=${t}`,i=await fetch(s);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}const Nd=42;function Ko(n){if(Tu(n.id))if($c(n.data))try{let e=n.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>Nd&&(e=`${e.substring(0,Nd)}...`),e}catch{return n.data.getName()}else return n.data.name??"UnknownSchema";else return n.id}function j0(n){return $c(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...oi(n.data.schema),title:n.data.name}}}class Ap{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=Tu(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...j0(t)})),edges:this.edges.map(t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const r=t||dn(),s={id:r,data:e};return this.nodes[r]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:r,conditional:s};return this.edges.push(i),i}firstNode(){const e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){const e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map(c=>c.id).every(Tu)&&(r="");const i=c=>r?`${r}:${c}`:c;Object.entries(e.nodes).forEach(([c,l])=>{this.nodes[i(c)]={...l,id:i(c)}});const a=e.edges.map(c=>({...c,source:i(c.source),target:i(c.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),u=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,u?{id:i(u.id),data:u.data}:void 0]}trimFirstNode(){const e=this.firstNode();if(e){const t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:s={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:i}=e??{},a={};for(const d of Object.values(this.nodes))a[d.id]=Ko(d);const o=this.firstNode(),u=o?Ko(o):void 0,c=this.lastNode(),l=c?Ko(c):void 0;return R0(a,this.edges,{firstNodeLabel:u,lastNodeLabel:l,withStyles:t,curveStyle:r,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){const t=this.drawMermaid(e);return N0(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function $0(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const s of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return lt.fromReadableStream(t)}function jd(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}const L0=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function Lu(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*$d(n,e){for(;;){const{value:t,done:r}=hr.runWithConfig(n,e.next.bind(e),!0);if(r)break;yield t}}async function*Ld(n,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:r,done:s}=await hr.runWithConfig(n,t.next.bind(e),!0);if(s)break;yield r}}function M0(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}class F0 extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function De(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class Ne extends cr{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new sr({bound:this,kwargs:e,config:{}})}map(){return new Ma({bound:this})}withRetry(e){return new D0({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new sr({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new B0({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(de);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,i)=>de(i===0?e:r))}return Array.from({length:t},()=>de(e))}async batch(e,t,r){var u;const s=this._getOptionsList(t??{},e.length),i=((u=s[0])==null?void 0:u.maxConcurrency)??(r==null?void 0:r.maxConcurrency),a=new po({maxConcurrency:i,onFailedAttempt:c=>{throw c}}),o=e.map((c,l)=>a.call(async()=>{try{return await this.invoke(c,s[l])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=de(t),s=new Gr({generator:this._streamIterator(e,r),config:r});return await s.setup,lt.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=de(e):t=de({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,[t,r]}async _callWithConfig(e,t,r){const s=de(r),i=await Xt(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),De(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{o=await e.call(this,t,s,a)}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}return await(a==null?void 0:a.handleChainEnd(De(o,"output"))),o}async _batchWithConfig(e,t,r,s){const i=this._getOptionsList(r??{},t.length),a=await Promise.all(i.map(Xt)),o=await Promise.all(a.map(async(c,l)=>{const d=await(c==null?void 0:c.handleChainStart(this.toJSON(),De(t[l],"input"),i[l].runId,i[l].runType,void 0,void 0,i[l].runName??this.getName()));return delete i[l].runId,d}));let u;try{u=await e.call(this,t,i,o,s)}catch(c){throw await Promise.all(o.map(l=>l==null?void 0:l.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(De(u,"output")))),u}async*_transformStreamWithConfig(e,t,r){let s,i=!0,a,o=!0;const u=de(r),c=await Xt(u);async function*l(){for await(const h of e){if(i)if(s===void 0)s=h;else try{s=Gt(s,h)}catch{s=void 0,i=!1}yield h}}let d;try{const h=await Fv(t.bind(this),l(),async()=>c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),u);delete u.runId,d=h.setup;const f=d==null?void 0:d.handlers.find(_p);let p=h.output;f!==void 0&&d!==void 0&&(p=f.tapOutputIterable(d.runId,p));const y=d==null?void 0:d.handlers.find(gp);y!==void 0&&d!==void 0&&(p=y.tapOutputIterable(d.runId,p));for await(const _ of p)if(yield _,o)if(a===void 0)a=_;else try{a=Gt(a,_)}catch{a=void 0,o=!1}}catch(h){throw await(d==null?void 0:d.handleChainError(h,void 0,void 0,void 0,{inputs:De(s,"input")})),h}await(d==null?void 0:d.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:De(s,"input")}))}getGraph(e){const t=new Ap,r=t.addNode({name:`${this.getName()}Input`,schema:rr.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:rr.any()});return t.addEdge(r,s),t.addEdge(s,i),t}pipe(e){return new hn({first:this,last:Qn(e)})}pick(e){return this.pipe(new z0(e))}assign(e){return this.pipe(new xp(new Xr({steps:e})))}async*transform(e,t){let r;for await(const s of e)r===void 0?r=s:r=Gt(r,s);yield*this._streamIterator(r,de(t))}async*streamLog(e,t,r){const s=new Td({...r,autoClose:!1,_schemaFormat:"original"}),i=de(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,r){const{callbacks:s}=r;if(s===void 0)r.callbacks=[t];else if(Array.isArray(s))r.callbacks=s.concat([t]);else{const u=s.copy();u.inheritableHandlers.push(t),r.callbacks=u}const i=this.stream(e,r);async function a(){try{const u=await i;for await(const c of u){const l=new Tn({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(l)}}finally{await t.writer.close()}}const o=a();try{for await(const u of t)yield u}finally{await o}}streamEvents(e,t,r){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,r);else if(t.version==="v2")s=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?$0(s):lt.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,r){var f;const s=new Uv({...r,autoClose:!1}),i=de(t),a=i.runId??dn();i.runId=a;const o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{const p=o.copy();p.inheritableHandlers.push(s),i.callbacks=p}const u=this;async function c(){try{const p=await u.stream(e,i),y=s.tapOutputIterable(a,p);for await(const _ of y);}finally{await s.finish()}}const l=c();let d=!1,h;try{for await(const p of s){if(!d){p.data.input=e,d=!0,h=p.run_id,yield p;continue}p.run_id===h&&p.event.endsWith("_end")&&(f=p.data)!=null&&f.input&&delete p.data.input,yield p}}finally{await l}}async*_streamEventsV1(e,t,r){let s,i=!1;const a=de(t),o=a.tags??[],u=a.metadata??{},c=a.runName??this.getName(),l=new Td({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Zv({...r}),h=this._streamLog(e,l,a);for await(const p of h){if(s?s=s.concat(p):s=Qs.fromRunLogPatch(p),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const E={...s.state},v={run_id:E.id,event:`on_${E.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};d.includeEvent(v,E.type)&&(yield v)}const y=p.ops.filter(E=>E.path.startsWith("/logs/")).map(E=>E.path.split("/")[2]),_=[...new Set(y)];for(const E of _){let v,L={};const U=s.state.logs[E];if(U.end_time===void 0?U.streamed_output.length>0?v="stream":v="start":v="end",v==="start")U.inputs!==void 0&&(L.input=U.inputs);else if(v==="end")U.inputs!==void 0&&(L.input=U.inputs),L.output=U.final_output;else if(v==="stream"){const R=U.streamed_output.length;if(R!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${R} instead. Encountered in: "${U.name}"`);L={chunk:U.streamed_output[0]},U.streamed_output=[]}yield{event:`on_${U.type}_${v}`,name:U.name,run_id:U.id,tags:U.tags,metadata:U.metadata,data:L}}const{state:b}=s;if(b.streamed_output.length>0){const E=b.streamed_output.length;if(E!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${E} instead. Encountered in: "${b.name}"`);const v={chunk:b.streamed_output[0]};b.streamed_output=[];const L={event:`on_${b.type}_stream`,run_id:b.id,tags:o,metadata:u,name:c,data:v};d.includeEvent(L,b.type)&&(yield L)}}const f=s==null?void 0:s.state;if(f!==void 0){const p={event:`on_${f.type}_end`,name:c,run_id:f.id,tags:o,metadata:u,data:{output:f.final_output}};d.includeEvent(p,f.type)&&(yield p)}}static isRunnable(e){return $c(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new sr({bound:this,config:{},configFactories:[s=>({callbacks:[new yp({config:s,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return H0(this,e)}}class sr extends Ne{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=Cd(this.config,...e);return Cd(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(de(t),this.kwargs))}async batch(e,t,r){const s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(de(i),this.kwargs))):await this._mergeConfig(de(t),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(de(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(de(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(de(t),this.kwargs))}streamEvents(e,t,r){const s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(de(t),s.kwargs),version:t.version},r)};return lt.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&Ne.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new sr({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new yp({config:s,onStart:e,onEnd:t,onError:r})]})]})}}class Ma extends Ne{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Ma({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,qe(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new Ma({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class D0 extends sr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const s=e>1?`retry:attempt:${e}`:void 0;return qe(t,{callbacks:r==null?void 0:r.getChild(s)})}async _invoke(e,t,r){return Ia(s=>super.invoke(e,this._patchConfigForRetry(s,t,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,s){const i={};try{await Ia(async a=>{const o=e.map((h,f)=>f).filter(h=>i[h.toString()]===void 0||i[h.toString()]instanceof Error),u=o.map(h=>e[h]),c=o.map(h=>this._patchConfigForRetry(a,t==null?void 0:t[h],r==null?void 0:r[h])),l=await super.batch(u,c,{...s,returnExceptions:!0});let d;for(let h=0;h<l.length;h+=1){const f=l[h],p=o[h];f instanceof Error&&d===void 0&&(d=f,d.input=u[h]),i[p.toString()]=f}if(d)throw d;return l},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class hn extends Ne{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){const r=de(t),s=await Xt(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),De(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=e,o;try{const u=[this.first,...this.middle];for(let c=0;c<u.length;c+=1)a=await u[c].invoke(a,qe(r,{callbacks:i==null?void 0:i.getChild(`seq:step:${c+1}`)}));o=await this.last.invoke(a,qe(r,{callbacks:i==null?void 0:i.getChild(`seq:step:${this.steps.length}`)}))}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}return await(i==null?void 0:i.handleChainEnd(De(o,"output"))),o}async batch(e,t,r){const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(Xt)),a=await Promise.all(i.map(async(u,c)=>{const l=await(u==null?void 0:u.handleChainStart(this.toJSON(),De(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName));return delete s[c].runId,l}));let o=e;try{for(let u=0;u<this.steps.length;u+=1)o=await this.steps[u].batch(o,a.map((l,d)=>{const h=l==null?void 0:l.getChild(`seq:step:${u+1}`);return qe(s[d],{callbacks:h})}),r)}catch(u){throw await Promise.all(a.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(a.map(u=>u==null?void 0:u.handleChainEnd(De(o,"output")))),o}async*_streamIterator(e,t){const r=await Xt(t),{runId:s,...i}=t??{},a=await(r==null?void 0:r.handleChainStart(this.toJSON(),De(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last];let u=!0,c;async function*l(){yield e}try{let d=o[0].transform(l(),qe(i,{callbacks:a==null?void 0:a.getChild("seq:step:1")}));for(let h=1;h<o.length;h+=1)d=await o[h].transform(d,qe(i,{callbacks:a==null?void 0:a.getChild(`seq:step:${h+1}`)}));for await(const h of d)if(yield h,u)if(c===void 0)c=h;else try{c=Gt(c,h)}catch{c=void 0,u=!1}}catch(d){throw await(a==null?void 0:a.handleChainError(d)),d}await(a==null?void 0:a.handleChainEnd(De(c,"output")))}getGraph(e){const t=new Ap;let r=null;return this.steps.forEach((s,i)=>{const a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&t.addEdge(r,o),r=a.lastNode()}),t}pipe(e){return hn.isRunnableSequence(e)?new hn({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new hn({first:this.first,middle:[...this.middle,this.last],last:Qn(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Ne.isRunnable(e)}static from([e,...t],r){return new hn({first:Qn(e),middle:t.slice(0,-1).map(Qn),last:Qn(t[t.length-1]),name:r})}}class Xr extends Ne{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Qn(r)}static from(e){return new Xr({steps:e})}async invoke(e,t){const r=de(t),s=await Xt(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{await Promise.all(Object.entries(this.steps).map(async([o,u])=>{a[o]=await u.invoke(e,qe(r,{callbacks:i==null?void 0:i.getChild(`map:key:${o}`)}))}))}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,t,r){const s={...this.steps},i=mp(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,u],c)=>{const l=u.transform(i[c],qe(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,l.next().then(d=>({key:o,gen:l,result:d}))]}));for(;a.size;){const{key:o,result:u,gen:c}=await Promise.race(a.values());a.delete(o),u.done||(yield{[o]:u.value},a.set(o,c.next().then(l=>({key:o,gen:c,result:l}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=de(t),i=new Gr({generator:this.transform(r(),s),config:s});return await i.setup,lt.fromAsyncGenerator(i)}}class Lc extends Ne{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Ic(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),s=await Xt(r);return await this.func(qe(r,{callbacks:s}),e)}async*_streamIterator(e,t){const r=await this.invoke(e,t);if(Lu(r)){for await(const s of r)yield s;return}if(L0(r)){for(;;){const s=r.next();if(s.done)break;yield s.value}return}yield r}static from(e){return new Lc({func:e})}}function U0(n){if(Ic(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class ui extends Ne{static lc_name(){return"RunnableLambda"}constructor(e){if(Ic(e.func))return Lc.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),U0(e.func),this.func=e.func}static from(e){return new ui({func:e})}async _invoke(e,t,r){return new Promise((s,i)=>{const a=qe(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??Vo)-1});hr.runWithConfig(a,async()=>{try{let o=await this.func(e,{...a,config:a});if(o&&Ne.isRunnable(o)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...a,recursionLimit:(a.recursionLimit??Vo)-1})}else if(Lu(o)){let u;for await(const c of Ld(a,o))if(u===void 0)u=c;else try{u=Gt(u,c)}catch{u=c}o=u}else if(jd(o)){let u;for(const c of $d(a,o))if(u===void 0)u=c;else try{u=Gt(u,c)}catch{u=c}o=u}s(o)}catch(o){i(o)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let s;for await(const o of e)if(s===void 0)s=o;else try{s=Gt(s,o)}catch{s=o}const i=qe(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??Vo)-1}),a=await new Promise((o,u)=>{hr.runWithConfig(i,async()=>{try{const c=await this.func(s,{...i,config:i});o(c)}catch(c){u(c)}})});if(a&&Ne.isRunnable(a)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const o=await a.stream(s,i);for await(const u of o)yield u}else if(Lu(a))for await(const o of Ld(i,a))yield o;else if(jd(a))for(const o of $d(i,a))yield o;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=de(t),i=new Gr({generator:this.transform(r(),s),config:s});return await i.setup,lt.fromAsyncGenerator(i)}}class B0 extends Ne{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=de(t),s=await Xt(t),{runId:i,...a}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),De(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName));let u;for(const c of this.runnables())try{const l=await c.invoke(e,qe(a,{callbacks:o==null?void 0:o.getChild()}));return await(o==null?void 0:o.handleChainEnd(De(l,"output"))),l}catch(l){u===void 0&&(u=l)}throw u===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(u)),u)}async batch(e,t,r){if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(u=>Xt(u))),a=await Promise.all(i.map(async(u,c)=>{const l=await(u==null?void 0:u.handleChainStart(this.toJSON(),De(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName));return delete s[c].runId,l}));let o;for(const u of this.runnables())try{const c=await u.batch(e,a.map((l,d)=>qe(s[d],{callbacks:l==null?void 0:l.getChild()})),r);return await Promise.all(a.map((l,d)=>l==null?void 0:l.handleChainEnd(De(c[d],"output")))),c}catch(c){o===void 0&&(o=c)}throw o?(await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Qn(n){if(typeof n=="function")return new ui({func:n});if(Ne.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=Qn(r);return new Xr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class xp extends Ne{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Xr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const s=this.mapper.getStepsKeys(),[i,a]=mp(e),o=this.mapper.transform(a,qe(r,{callbacks:t==null?void 0:t.getChild()})),u=o.next();for await(const c of i){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const l=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(l).length>0&&(yield l)}yield(await u).value;for await(const c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=de(t),i=new Gr({generator:this.transform(r(),s),config:s});return await i.setup,lt.fromAsyncGenerator(i)}}class z0 extends Ne{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=de(t),i=new Gr({generator:this.transform(r(),s),config:s});return await i.setup,lt.fromAsyncGenerator(i)}}class Md extends sr{constructor(e){const t=hn.from([ui.from(async r=>{let s;if(M0(r))try{s=await this.schema.parseAsync(r.args)}catch{throw new F0("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function H0(n,e){var s;const t=e.name??n.getName(),r=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===rr.ZodString?new Md({name:t,description:r,schema:rr.object({input:rr.string()}).transform(i=>i.input),bound:n}):new Md({name:t,description:r,schema:e.schema,bound:n})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var Z0=typeof window=="object"?window:{},Q="0123456789abcdef".split(""),V0=[-2147483648,8388608,32768,128],xt=[24,16,8,0],Ie=[];function $t(n){n?(Ie[0]=Ie[16]=Ie[1]=Ie[2]=Ie[3]=Ie[4]=Ie[5]=Ie[6]=Ie[7]=Ie[8]=Ie[9]=Ie[10]=Ie[11]=Ie[12]=Ie[13]=Ie[14]=Ie[15]=0,this.blocks=Ie):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}$t.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===Z0.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,s,i=n.length||0,a=this.blocks;r<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;r<i&&s<64;++r)a[s>>2]|=n[r]<<xt[s++&3];else for(s=this.start;r<i&&s<64;++r)t=n.charCodeAt(r),t<128?a[s>>2]|=t<<xt[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<xt[s++&3],a[s>>2]|=(128|t&63)<<xt[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<xt[s++&3],a[s>>2]|=(128|t>>6&63)<<xt[s++&3],a[s>>2]|=(128|t&63)<<xt[s++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),a[s>>2]|=(240|t>>18)<<xt[s++&3],a[s>>2]|=(128|t>>12&63)<<xt[s++&3],a[s>>2]|=(128|t>>6&63)<<xt[s++&3],a[s>>2]|=(128|t&63)<<xt[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};$t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=V0[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};$t.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4,i,a,o,u=this.blocks;for(a=16;a<80;++a)o=u[a-3]^u[a-8]^u[a-14]^u[a-16],u[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&r,o=n<<5|n>>>27,s=o+i+s+1518500249+u[a]<<0,e=e<<30|e>>>2,i=n&e|~n&t,o=s<<5|s>>>27,r=o+i+r+1518500249+u[a+1]<<0,n=n<<30|n>>>2,i=s&n|~s&e,o=r<<5|r>>>27,t=o+i+t+1518500249+u[a+2]<<0,s=s<<30|s>>>2,i=r&s|~r&n,o=t<<5|t>>>27,e=o+i+e+1518500249+u[a+3]<<0,r=r<<30|r>>>2,i=t&r|~t&s,o=e<<5|e>>>27,n=o+i+n+1518500249+u[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^r,o=n<<5|n>>>27,s=o+i+s+1859775393+u[a]<<0,e=e<<30|e>>>2,i=n^e^t,o=s<<5|s>>>27,r=o+i+r+1859775393+u[a+1]<<0,n=n<<30|n>>>2,i=s^n^e,o=r<<5|r>>>27,t=o+i+t+1859775393+u[a+2]<<0,s=s<<30|s>>>2,i=r^s^n,o=t<<5|t>>>27,e=o+i+e+1859775393+u[a+3]<<0,r=r<<30|r>>>2,i=t^r^s,o=e<<5|e>>>27,n=o+i+n+1859775393+u[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&r|t&r,o=n<<5|n>>>27,s=o+i+s-1894007588+u[a]<<0,e=e<<30|e>>>2,i=n&e|n&t|e&t,o=s<<5|s>>>27,r=o+i+r-1894007588+u[a+1]<<0,n=n<<30|n>>>2,i=s&n|s&e|n&e,o=r<<5|r>>>27,t=o+i+t-1894007588+u[a+2]<<0,s=s<<30|s>>>2,i=r&s|r&n|s&n,o=t<<5|t>>>27,e=o+i+e-1894007588+u[a+3]<<0,r=r<<30|r>>>2,i=t&r|t&s|r&s,o=e<<5|e>>>27,n=o+i+n-1894007588+u[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^r,o=n<<5|n>>>27,s=o+i+s-899497514+u[a]<<0,e=e<<30|e>>>2,i=n^e^t,o=s<<5|s>>>27,r=o+i+r-899497514+u[a+1]<<0,n=n<<30|n>>>2,i=s^n^e,o=r<<5|r>>>27,t=o+i+t-899497514+u[a+2]<<0,s=s<<30|s>>>2,i=r^s^n,o=t<<5|t>>>27,e=o+i+e-899497514+u[a+3]<<0,r=r<<30|r>>>2,i=t^r^s,o=e<<5|e>>>27,n=o+i+n-899497514+u[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0};$t.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return Q[n>>28&15]+Q[n>>24&15]+Q[n>>20&15]+Q[n>>16&15]+Q[n>>12&15]+Q[n>>8&15]+Q[n>>4&15]+Q[n&15]+Q[e>>28&15]+Q[e>>24&15]+Q[e>>20&15]+Q[e>>16&15]+Q[e>>12&15]+Q[e>>8&15]+Q[e>>4&15]+Q[e&15]+Q[t>>28&15]+Q[t>>24&15]+Q[t>>20&15]+Q[t>>16&15]+Q[t>>12&15]+Q[t>>8&15]+Q[t>>4&15]+Q[t&15]+Q[r>>28&15]+Q[r>>24&15]+Q[r>>20&15]+Q[r>>16&15]+Q[r>>12&15]+Q[r>>8&15]+Q[r>>4&15]+Q[r&15]+Q[s>>28&15]+Q[s>>24&15]+Q[s>>20&15]+Q[s>>16&15]+Q[s>>12&15]+Q[s>>8&15]+Q[s>>4&15]+Q[s&15]};$t.prototype.toString=$t.prototype.hex;$t.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]};$t.prototype.array=$t.prototype.digest;$t.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};const q0=n=>new $t(!0).update(n).hex(),Fd=(...n)=>q0(n.join("_"));class W0{}const K0=new Map;class Mc extends W0{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Fd(e,t))??null)}async update(e,t,r){this.cache.set(Fd(e,t),r)}static global(){return new Mc(K0)}}class Op extends cr{}class J0 extends Op{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new io(this.value)]}}class G0 extends Op{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return zf(this.messages)}toChatMessages(){return this.messages}}var mo={};mo.byteLength=Y0;mo.toByteArray=tE;mo.fromByteArray=sE;var qt=[],ht=[],X0=typeof Uint8Array<"u"?Uint8Array:Array,Jo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var wr=0,Q0=Jo.length;wr<Q0;++wr)qt[wr]=Jo[wr],ht[Jo.charCodeAt(wr)]=wr;ht[45]=62;ht[95]=63;function Sp(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function Y0(n){var e=Sp(n),t=e[0],r=e[1];return(t+r)*3/4-r}function eE(n,e,t){return(e+t)*3/4-t}function tE(n){var e,t=Sp(n),r=t[0],s=t[1],i=new X0(eE(n,r,s)),a=0,o=s>0?r-4:r,u;for(u=0;u<o;u+=4)e=ht[n.charCodeAt(u)]<<18|ht[n.charCodeAt(u+1)]<<12|ht[n.charCodeAt(u+2)]<<6|ht[n.charCodeAt(u+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=ht[n.charCodeAt(u)]<<2|ht[n.charCodeAt(u+1)]>>4,i[a++]=e&255),s===1&&(e=ht[n.charCodeAt(u)]<<10|ht[n.charCodeAt(u+1)]<<4|ht[n.charCodeAt(u+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function nE(n){return qt[n>>18&63]+qt[n>>12&63]+qt[n>>6&63]+qt[n&63]}function rE(n,e,t){for(var r,s=[],i=e;i<t;i+=3)r=(n[i]<<16&16711680)+(n[i+1]<<8&65280)+(n[i+2]&255),s.push(nE(r));return s.join("")}function sE(n){for(var e,t=n.length,r=t%3,s=[],i=16383,a=0,o=t-r;a<o;a+=i)s.push(rE(n,a,a+i>o?o:a+i));return r===1?(e=n[t-1],s.push(qt[e>>2]+qt[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],s.push(qt[e>>10]+qt[e>>4&63]+qt[e<<2&63]+"=")),s.join("")}var iE=Object.defineProperty,aE=(n,e,t)=>e in n?iE(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,oE=(n,e,t)=>(aE(n,e+"",t),t);function uE(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){const i=n.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,s])}if(r!=null){const s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function cE(n,e){return n.length===1?[e.get(n.join(","))]:uE(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function lE(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Mu=class{constructor(n,e){wn(this,"specialTokens");wn(this,"inverseSpecialTokens");wn(this,"patStr");wn(this,"textEncoder",new TextEncoder);wn(this,"textDecoder",new TextDecoder("utf-8"));wn(this,"rankMap",new Map);wn(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[i,a,...o]=s.split(" "),u=Number.parseInt(a,10);return o.forEach((c,l)=>r[c]=u+l),r},{});for(const[r,s]of Object.entries(t)){const i=mo.toByteArray(r);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,i])=>(r[i]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),s=Mu.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!a.has(c)):t);if(o.size>0){const c=Mu.specialTokenRegex([...o]),l=n.match(c);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let u=0;for(;;){let c=null,l=u;for(;s.lastIndex=l,c=s.exec(n),!(c==null||a.has(c[0]));)l=c.index+1;const d=(c==null?void 0:c.index)??n.length;for(const f of n.substring(u,d).matchAll(r)){const p=this.textEncoder.encode(f[0]),y=this.rankMap.get(p.join(","));if(y!=null){i.push(y);continue}i.push(...cE(p,this.rankMap))}if(c==null)break;let h=this.specialTokens[c[0]];i.push(h),u=c.index+c[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const a=n[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.length;return this.textDecoder.decode(r)}},Pp=Mu;oE(Pp,"specialTokenRegex",n=>new RegExp(n.map(e=>lE(e)).join("|"),"g"));function dE(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":return"o200k_base";default:throw new Error("Unknown model")}}const xi={},hE=new po({});async function fE(n){return n in xi||(xi[n]=hE.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new Pp(e)).catch(e=>{throw delete xi[n],e})),await xi[n]}async function pE(n){return fE(dE(n))}const mE=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n,gE=()=>!1;class _E extends Ne{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??gE(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class yE extends _E{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r.cache=="object"?this.cache=r.cache:r.cache?this.cache=Mc.global():this.cache=void 0,this.caller=new po(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await pE("modelName"in this?mE(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new J0(e):Array.isArray(e)?new G0(e.map(ps)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class Fa extends Ne{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const r=de(t);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,t){const r=de(t);let s,i=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,r))if(yield a,i)if(s===void 0)s=a;else try{s=Gt(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new xp(new Xr({steps:e}))}}function bE(n){return typeof(n==null?void 0:n.parse)=="function"}class kn extends yE{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[t,r]}async invoke(e,t){const r=kn._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===kn.prototype._streamResponseChunks)yield this.invoke(e,t);else{const s=kn._convertInputToPromptValue(e).toChatMessages(),[i,a]=this._separateRunnableConfigFromCallOptions(t),o={...i.metadata,...this.getLsParams(a)},u=await ut.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},l=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),[s],i.runId,void 0,c,void 0,void 0,i.runName));let d;try{for await(const h of this._streamResponseChunks(s,a,l==null?void 0:l[0]))h.message.response_metadata={...h.generationInfo,...h.message.response_metadata},yield h.message,d?d=d.concat(h):d=h}catch(h){throw await Promise.all((l??[]).map(f=>f==null?void 0:f.handleLLMError(h))),h}await Promise.all((l??[]).map(h=>h==null?void 0:h.handleLLMEnd({generations:[[d]]})))}}getLsParams(e){return{ls_model_type:"chat",ls_stop:e.stop}}async _generateUncached(e,t,r){var f;const s=e.map(p=>p.map(ps)),i={...r.metadata,...this.getLsParams(t)},a=await ut.configure(r.callbacks,this.callbacks,r.tags,this.tags,i,this.metadata,{verbose:this.verbose}),o={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1},u=await(a==null?void 0:a.handleChatModelStart(this.toJSON(),s,r.runId,void 0,o,void 0,void 0,r.runName)),c=[],l=[];if(!!(u!=null&&u[0].handlers.find(p=>_p(p)||gp(p)))&&s.length===1&&this._streamResponseChunks!==kn.prototype._streamResponseChunks)try{const p=await this._streamResponseChunks(s[0],t,u==null?void 0:u[0]);let y;for await(const _ of p)y===void 0?y=_:y=Gt(y,_);if(y===void 0)throw new Error("Received empty response from chat model call.");c.push([y]),await(u==null?void 0:u[0].handleLLMEnd({generations:c,llmOutput:{}}))}catch(p){throw await(u==null?void 0:u[0].handleLLMError(p)),p}else{const p=await Promise.allSettled(s.map((y,_)=>this._generate(y,{...t,promptIndex:_},u==null?void 0:u[_])));await Promise.all(p.map(async(y,_)=>{var b,E;if(y.status==="fulfilled"){const v=y.value;for(const L of v.generations)L.message.response_metadata={...L.generationInfo,...L.message.response_metadata};return v.generations.length===1&&(v.generations[0].message.response_metadata={...v.llmOutput,...v.generations[0].message.response_metadata}),c[_]=v.generations,l[_]=v.llmOutput,(b=u==null?void 0:u[_])==null?void 0:b.handleLLMEnd({generations:[v.generations],llmOutput:v.llmOutput})}else return await((E=u==null?void 0:u[_])==null?void 0:E.handleLLMError(y.reason)),Promise.reject(y.reason)}))}const h={generations:c,llmOutput:l.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...l):void 0};return Object.defineProperty(h,kd,{value:u?{runIds:u==null?void 0:u.map(p=>p.runId)}:void 0,configurable:!0}),h}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:s,handledOptions:i}){const a=e.map(_=>_.map(ps)),o={...i.metadata,...this.getLsParams(s)},u=await ut.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1,cached:!0},l=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),a,i.runId,void 0,c,void 0,void 0,i.runName)),d=[],f=(await Promise.allSettled(a.map(async(_,b)=>{const E=kn._convertInputToPromptValue(_).toString(),v=await t.lookup(E,r);return v==null&&d.push(b),v}))).map((_,b)=>({result:_,runManager:l==null?void 0:l[b]})).filter(({result:_})=>_.status==="fulfilled"&&_.value!=null||_.status==="rejected"),p=[];await Promise.all(f.map(async({result:_,runManager:b},E)=>{if(_.status==="fulfilled"){const v=_.value;return p[E]=v,v.length&&await(b==null?void 0:b.handleLLMNewToken(v[0].text)),b==null?void 0:b.handleLLMEnd({generations:[v]})}else return await(b==null?void 0:b.handleLLMError(_.reason)),Promise.reject(_.reason)}));const y={generations:p,missingPromptIndices:d};return Object.defineProperty(y,kd,{value:l?{runIds:l==null?void 0:l.map(_=>_.runId)}:void 0,configurable:!0}),y}async generate(e,t,r){let s;Array.isArray(t)?s={stop:t}:s=t;const i=e.map(f=>f.map(ps)),[a,o]=this._separateRunnableConfigFromCallOptions(s);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(i,o,a);const{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:l,missingPromptIndices:d}=await this._generateCached({messages:i,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:a});let h={};if(d.length>0){const f=await this._generateUncached(d.map(p=>i[p]),o,a);await Promise.all(f.generations.map(async(p,y)=>{const _=d[y];l[_]=p;const b=kn._convertInputToPromptValue(i[_]).toString();return u.update(b,c,p)})),h=f.llmOutput??{}}return{generations:l,llmOutput:h}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const s=e.map(i=>i.toChatMessages());return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e.map(ps)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const s=new io(e),i=await this.call([s],t,r);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');const r=e,s=t==null?void 0:t.name,i=r.description??"A function available to call.",a=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=s??"extract",c;bE(r)?c=[{type:"function",function:{name:u,description:i,parameters:oi(r)}}]:("name"in r&&(u=r.name),c=[{type:"function",function:{name:u,description:i,parameters:r}}]);const l=this.bindTools(c),d=ui.from(y=>{if(!y.tool_calls||y.tool_calls.length===0)throw new Error("No tool calls found in the response.");const _=y.tool_calls.find(b=>b.name===u);if(!_)throw new Error(`No tool call found with name ${u}.`);return _.args});if(!o)return l.pipe(d).withConfig({runName:"StructuredOutput"});const h=Fa.assign({parsed:(y,_)=>d.invoke(y.raw,_)}),f=Fa.assign({parsed:()=>null}),p=h.withFallbacks({fallbacks:[f]});return hn.from([{raw:l},p]).withConfig({runName:"StructuredOutputRunnable"})}}function wE(n){return{name:n.name,description:n.description,parameters:oi(n.schema)}}function Dd(n){return vE(n)||EE(n)?{type:"function",function:wE(n)}:n}function vE(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function EE(n){return n!==void 0&&Ne.isRunnable(n)&&"lc_name"in n.constructor&&typeof n.constructor.lc_name=="function"&&n.constructor.lc_name()==="RunnableToolLike"}class Fc extends Ne{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class Tp extends Fc{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Dc extends Error{constructor(e,t,r,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=s,s&&(r===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}function Fu(n,e){const t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;const r=n.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!Fu(n[s],e[s]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const a of r)if(!Fu(n[a],e[a]))return!1;return!0}return n===e}class AE extends Tp{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class xE extends AE{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,r;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(ab(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Wr({message:s,text:s.content})}else if(Tc(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Wr({message:cb(s),text:s.content})}else i=new qr({text:s});r===void 0?r=i:r=r.concat(i);const a=await this.parsePartialResult([r]);a!=null&&!Fu(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}}class OE extends Tp{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=rr.object(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,rr.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(oi(this.schema))}
\`\`\`
`}async parse(e){try{const r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,i)=>`"${i.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(t){throw new Dc(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class SE extends xE{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?jw(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return ad(e[0].text)}async parse(e){return ad(e,JSON.parse)}getFormatInstructions(){return""}}function kp(n,e){if(n.function===void 0)return;let t;if(e!=null&&e.partial)try{t=Sc(n.function.arguments??"{}")}catch{return}else try{t=JSON.parse(n.function.arguments)}catch(s){throw new Dc([`Function "${n.function.name}" arguments:`,"",n.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const r={name:n.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(r.id=n.id),r}function PE(n){if(n.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:n.id,type:"function",function:{name:n.name,arguments:JSON.stringify(n.args)}}}function TE(n,e){var t,r;return{name:(t=n.function)==null?void 0:t.name,args:(r=n.function)==null?void 0:r.arguments,id:n.id,error:e,type:"invalid_tool_call"}}class kE extends Fc{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}async parseResult(e){const t=e[0].message.additional_kwargs.tool_calls;if(!t)throw new Error(`No tools_call in message ${JSON.stringify(e)}`);const r=JSON.parse(JSON.stringify(t)),s=[];for(const i of r){const a=kp(i,{partial:!0});if(a!==void 0){const o={type:a.name,args:a.args,id:a.id};Object.defineProperty(o,"name",{get(){return this.type}}),Object.defineProperty(o,"arguments",{get(){return this.args}}),s.push(o)}}return s}}class Ud extends Fc{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.initialParser=new kE(e),this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new Dc(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){const r=(await this.initialParser.parseResult(e)).filter(a=>a.type===this.keyName);let s=r;return this.returnId||(s=r.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))}}function Cp(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a}=n;if((r||a)&&s&&e)return`${s}/${e}`;if(r||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function Ip(n){let e;return n.constructor.name===Vy.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===qy.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}function CE(n){if(n)return n==="any"||n==="required"?"required":n==="auto"?"auto":n==="none"?"none":typeof n=="string"?{type:"function",function:{name:n}}:n}function IE(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function RE(n){const e=["namespace functions {",""];for(const t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(Rp(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function Rp(n,e){var r;const t=[];for(const[s,i]of Object.entries(n.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(r=n.required)!=null&&r.includes(s)?t.push(`${s}: ${Da(i,e)},`):t.push(`${s}?: ${Da(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function Da(n,e){if(IE(n))return n.anyOf.map(t=>Da(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Rp(n,e+2),"}"].join(`
`);case"array":return n.items?`${Da(n.items,e)}[]`:"any[]";default:return""}}function NE(n){return n.role!=="system"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function Np(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!ri.isInstance(n))throw new Error("Invalid generic chat message");return NE(n)}default:throw new Error(`Unknown message type: ${e}`)}}function jE(n,e,t){const r=n.tool_calls;switch(n.role){case"assistant":{const s=[],i=[];for(const u of r??[])try{s.push(kp(u,{returnId:!0}))}catch(c){i.push(TE(u,c.message))}const a={function_call:n.function_call,tool_calls:r};t!==void 0&&(a.__raw_response=e);let o;return e.system_fingerprint&&(o={system_fingerprint:e.system_fingerprint}),new Uf({content:n.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:e.id})}default:return new ri(n.content||"",n.role??"unknown")}}function $E(n,e,t,r){var o,u;const s=n.role??t,i=n.content??"";let a;if(n.function_call?a={function_call:n.function_call}:n.tool_calls?a={tool_calls:n.tool_calls}:a={},r&&(a.__raw_response=e),s==="user")return new ao({content:i});if(s==="assistant"){const c=[];if(Array.isArray(n.tool_calls))for(const l of n.tool_calls)c.push({name:(o=l.function)==null?void 0:o.name,args:(u=l.function)==null?void 0:u.arguments,id:l.id,index:l.index,type:"tool_call_chunk"});return new pr({content:i,tool_call_chunks:c,additional_kwargs:a,id:e.id})}else return s==="system"?new oo({content:i}):s==="function"?new so({content:i,additional_kwargs:a,name:n.name}):s==="tool"?new kc({content:i,additional_kwargs:a,tool_call_id:n.tool_call_id}):new ro({content:i,role:s})}function Bd(n){return n.map(e=>{var r;const t={role:Np(e),content:e.content};return e.name!=null&&(t.name=e.name),e.additional_kwargs.function_call!=null&&(t.function_call=e.additional_kwargs.function_call,t.content=null),Bf(e)&&((r=e.tool_calls)!=null&&r.length)?(t.tool_calls=e.tool_calls.map(PE),t.content=null):(e.additional_kwargs.tool_calls!=null&&(t.tool_calls=e.additional_kwargs.tool_calls),e.tool_call_id!=null&&(t.tool_call_id=e.tool_call_id)),t})}class LE extends kn{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){var r,s,i,a,o,u,c,l;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??Oe("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??Oe("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=(e==null?void 0:e.azureADTokenProvider)??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??Oe("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??Oe("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??Oe("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??Oe("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??Oe("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??"",this.streamUsage=!1}this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:(t==null?void 0:t.basePath)??((s=e==null?void 0:e.configuration)==null?void 0:s.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((i=t==null?void 0:t.baseOptions)==null?void 0:i.headers)??((o=(a=e==null?void 0:e.configuration)==null?void 0:a.baseOptions)==null?void 0:o.headers),defaultQuery:((u=t==null?void 0:t.baseOptions)==null?void 0:u.params)??((l=(c=e==null?void 0:e.configuration)==null?void 0:c.baseOptions)==null?void 0:l.params),...t,...e==null?void 0:e.configuration}}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){return this.bind({tools:e.map(Dd),...t})}invocationParams(e,t){function r(a){return a!==void 0&&a.every(o=>Array.isArray(o.lc_namespace))}let s={};return(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}}),{model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:r(e==null?void 0:e.tools)?e==null?void 0:e.tools.map(Dd):e==null?void 0:e.tools,tool_choice:CE(e==null?void 0:e.tool_choice),response_format:e==null?void 0:e.response_format,seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var c;const s=Bd(e),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let u;for await(const l of o){const d=l==null?void 0:l.choices[0];if(l.usage&&(u=l.usage),!d)continue;const{delta:h}=d;if(!h)continue;const f=$E(h,l,a,this.__includeRawResponse);a=h.role??a;const p={prompt:t.promptIndex??0,completion:d.index??0};if(typeof f.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const y={...p};d.finish_reason!==void 0&&(y.finish_reason=d.finish_reason,y.system_fingerprint=l.system_fingerprint),this.logprobs&&(y.logprobs=d.logprobs);const _=new Wr({message:f,text:f.content,generationInfo:y});yield _,await(r==null?void 0:r.handleLLMNewToken(_.text??"",p,void 0,void 0,void 0,{chunk:_}))}if(u&&(yield new Wr({message:new pr({content:"",usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens}}),text:""})),(c=t.signal)!=null&&c.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,u;const s={},i=this.invocationParams(t),a=Bd(e);if(i.stream){const c=this._streamResponseChunks(e,t,r),l={};for await(const _ of c){_.message.response_metadata={..._.generationInfo,..._.message.response_metadata};const b=((o=_.generationInfo)==null?void 0:o.completion)??0;l[b]===void 0?l[b]=_:l[b]=l[b].concat(_)}const d=Object.entries(l).sort(([_],[b])=>parseInt(_,10)-parseInt(b,10)).map(([_,b])=>b),{functions:h,function_call:f}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,h,f),y=await this.getNumTokensFromGenerations(d);return s.promptTokens=p,s.completionTokens=y,s.totalTokens=p+y,{generations:d,llmOutput:{estimatedTokenUsage:s}}}else{const c=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}),{completion_tokens:l,prompt_tokens:d,total_tokens:h}=(c==null?void 0:c.usage)??{};l&&(s.completionTokens=(s.completionTokens??0)+l),d&&(s.promptTokens=(s.promptTokens??0)+d),h&&(s.totalTokens=(s.totalTokens??0)+h);const f=[];for(const p of(c==null?void 0:c.choices)??[]){const _={text:((u=p.message)==null?void 0:u.content)??"",message:jE(p.message??{role:"assistant"},c,this.__includeRawResponse)};_.generationInfo={...p.finish_reason?{finish_reason:p.finish_reason}:{},...p.logprobs?{logprobs:p.logprobs}:{}},Bf(_.message)&&(_.message.usage_metadata={input_tokens:s.promptTokens??0,output_tokens:s.completionTokens??0,total_tokens:s.totalTokens??0}),f.push(_)}return{generations:f,llmOutput:{tokenUsage:s}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){const i=RE(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let t=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const i=await Promise.all(e.map(async a=>{var h,f,p,y,_,b;const o=await this.getNumTokens(a.content),u=await this.getNumTokens(Np(a)),c=a.name!==void 0?s+await this.getNumTokens(a.name):0;let l=o+r+u+c;const d=a;if(d._getType()==="function"&&(l-=2),(h=d.additional_kwargs)!=null&&h.function_call&&(l+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(l+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(y=d.additional_kwargs.function_call)!=null&&y.arguments)try{l+=await this.getNumTokens(JSON.stringify(JSON.parse((_=d.additional_kwargs.function_call)==null?void 0:_.arguments)))}catch(E){console.error("Error parsing function arguments",E,JSON.stringify(d.additional_kwargs.function_call)),l+=await this.getNumTokens((b=d.additional_kwargs.function_call)==null?void 0:b.arguments)}return t+=l,l}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw Ip(s)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=Cp(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Se(i)}const t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,s,i,a;ME(e)?(r=e.schema,s=e.name,i=e.method,a=e.includeRaw):(r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,u;if(i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),zd(r)?u=OE.fromZodSchema(r):u=new SE;else{let h=s??"extract";if(zd(r)){const f=oi(r);o=this.bind({tools:[{type:"function",function:{name:h,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:h}}}),u=new Ud({returnSingle:!0,keyName:h,zodSchema:r})}else{let f;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(f=r,h=r.name):(h=r.title??h,f={name:h,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:h}}}),u=new Ud({returnSingle:!0,keyName:h})}}if(!a)return o.pipe(u);const c=Fa.assign({parsed:(h,f)=>u.invoke(h.raw,f)}),l=Fa.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[l]});return hn.from([{raw:o},d])}}function zd(n){return typeof(n==null?void 0:n.parse)=="function"}function ME(n){return n!==void 0&&typeof n.schema=="object"}const FE=(n,e)=>n.reduce((t,r,s)=>{const i=Math.floor(s/e),a=t[i]||[];return t[i]=a.concat([r]),t},[]);class DE{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new po(e??{})}}class UE extends DE{constructor(e,t){var c,l,d;const r={maxConcurrency:2,...e};super(r),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"text-embedding-ada-002"}),Object.defineProperty(this,"batchSize",{enumerable:!0,configurable:!0,writable:!0,value:512}),Object.defineProperty(this,"stripNewLines",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"dimensions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let s=(r==null?void 0:r.apiKey)??(r==null?void 0:r.openAIApiKey)??Oe("OPENAI_API_KEY");const i=(r==null?void 0:r.azureOpenAIApiKey)??Oe("AZURE_OPENAI_API_KEY");if(this.azureADTokenProvider=(e==null?void 0:e.azureADTokenProvider)??void 0,!i&&!s&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");const a=(r==null?void 0:r.azureOpenAIApiInstanceName)??Oe("AZURE_OPENAI_API_INSTANCE_NAME"),o=((r==null?void 0:r.azureOpenAIApiEmbeddingsDeploymentName)||(r==null?void 0:r.azureOpenAIApiDeploymentName))??(Oe("AZURE_OPENAI_API_EMBEDDINGS_DEPLOYMENT_NAME")||Oe("AZURE_OPENAI_API_DEPLOYMENT_NAME")),u=(r==null?void 0:r.azureOpenAIApiVersion)??Oe("AZURE_OPENAI_API_VERSION");if(this.azureOpenAIBasePath=(r==null?void 0:r.azureOpenAIBasePath)??Oe("AZURE_OPENAI_BASE_PATH"),this.organization=((c=r==null?void 0:r.configuration)==null?void 0:c.organization)??Oe("OPENAI_ORGANIZATION"),this.modelName=(r==null?void 0:r.model)??(r==null?void 0:r.modelName)??this.model,this.model=this.modelName,this.batchSize=(r==null?void 0:r.batchSize)??(i?1:this.batchSize),this.stripNewLines=(r==null?void 0:r.stripNewLines)??this.stripNewLines,this.timeout=r==null?void 0:r.timeout,this.dimensions=r==null?void 0:r.dimensions,this.azureOpenAIApiVersion=u,this.azureOpenAIApiKey=i,this.azureOpenAIApiInstanceName=a,this.azureOpenAIApiDeploymentName=o,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");s=s??""}this.clientConfig={apiKey:s,organization:this.organization,baseURL:t==null?void 0:t.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:(l=t==null?void 0:t.baseOptions)==null?void 0:l.headers,defaultQuery:(d=t==null?void 0:t.baseOptions)==null?void 0:d.params,...t,...e==null?void 0:e.configuration}}async embedDocuments(e){const t=FE(this.stripNewLines?e.map(a=>a.replace(/\n/g," ")):e,this.batchSize),r=t.map(a=>{const o={model:this.model,input:a};return this.dimensions&&(o.dimensions=this.dimensions),this.embeddingWithRetry(o)}),s=await Promise.all(r),i=[];for(let a=0;a<s.length;a+=1){const o=t[a],{data:u}=s[a];for(let c=0;c<o.length;c+=1)i.push(u[c].embedding)}return i}async embedQuery(e){const t={model:this.model,input:this.stripNewLines?e.replace(/\n/g," "):e};this.dimensions&&(t.dimensions=this.dimensions);const{data:r}=await this.embeddingWithRetry(t);return r[0].embedding}async embeddingWithRetry(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=Cp(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new Se(i)}const t={};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),this.caller.call(async()=>{try{return await this.client.embeddings.create(e,t)}catch(r){throw Ip(r)}})}}const jp=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},Hn=n=>(xh("data-v-d66a0509"),n=n(),Oh(),n),BE={class:"container"},zE={class:"input-section"},HE=Hn(()=>xe("label",{for:"user-question"},"請輸入您的問題：",-1)),ZE=["disabled"],VE={key:0,class:"warning"},qE={key:0,class:"loading-section"},WE=Hn(()=>xe("p",null,"正在處理您的問題，請稍候...",-1)),KE=[WE],JE={key:1},GE={key:0,class:"response-section"},XE=Hn(()=>xe("h2",null,"回答：",-1)),QE={key:1,class:"reference-section"},YE=Hn(()=>xe("h2",null,"參考資料：",-1)),eA={class:"reference-card"},tA=Hn(()=>xe("strong",null,"描述：",-1)),nA=Hn(()=>xe("p",null,[xe("strong",null,"特點：")],-1)),rA=Hn(()=>xe("strong",null,"尺寸：",-1)),sA=Hn(()=>xe("strong",null,"價格：",-1)),iA={__name:"MouseQASystem",setup(n){const e=cn(-1),t=cn(null),r=cn(""),s=cn(""),i=cn(!1),a=cn(!1),o=window.location.search.replace("?apiKey=",""),u=new UE({apiKey:o}),c=new LE({apiKey:o}),l=[{description:"較低鼠背設計，手掌較少支撐",features:["提供三種尺寸","對稱型滑鼠","低鼠背設計","只有掌心後半段接觸到鼠背，提供靈活的移動手感"],size:["XL","L","M"],price:"100",name:"FK 系列"},{description:"較高鼠背設計，掌心較多支撐",features:["提供三種尺寸","對稱型滑鼠","較高鼠背設計","高點處靠近滑鼠中後段，提供掌心較多支撐","前方兩端設計，提供抬鼠時指頭的支撐點"],size:["L","M","S"],dmImage:"https://image.benq.com/is/image/benqco/01-za11-b-top",price:"100",name:"ZA 系列"},{description:"較短設計，靈活移動",features:["提供兩種尺寸","對稱型滑鼠","鼠背高度適中","高點處較靠近中心，整體縮短設計，讓玩家能夠輕易包覆滑鼠","手掌邊緣與滑鼠下邊緣有足夠的運動空間，可於平面垂直靈活移動","前方側邊增高，供趴臥玩家有足夠空間擺放無名指"],size:["M","S"],dmImage:"https://image.benq.com/is/image/benqco/01-S1-top-2",price:"90",name:"S 系列"},{description:"對稱型設計",features:["左右側內縮設計的滑鼠，在多角度移動時提供靈活操作","左側腰身設計搭配背部整體曲線使大拇指擺放角度小，讓食指點擊更快速的滑鼠","右側腰身設計，使得無名指得以輕鬆擺放，給予手部整體更好的力量支撐"],size:["M"],dmImage:"https://image.benq.com/is/image/benqco/U2_top_W2",price:"110",name:"U 系列"}],d=(_,b)=>{let E=0,v=0,L=0;for(let R=0;R<_.length;R+=1)E+=_[R]*b[R],v+=_[R]*_[R],L+=b[R]*b[R];return v=Math.sqrt(v),L=Math.sqrt(L),E/(v*L)};async function h(){const _=await u.embedQuery(s.value),b=await Promise.all(l.map(E=>u.embedQuery(JSON.stringify(E))));return{questionEmbedding:_,referenceEmbeddings:b}}async function f(){if(!s.value.trim()){a.value=!0;return}a.value=!1,await p()}async function p(){i.value=!0,e.value=-1,t.value=null,r.value="";try{const{questionEmbedding:_,referenceEmbeddings:b}=await h();for(let E=0;E<l.length;E++){const v=d(_,b[E]);console.log(l[E],v),v>e.value&&(e.value=v,t.value=l[E])}console.log("最相關的回答是:",t.value),console.log("相似度分數:",e.value),await y()}catch(_){console.error("處理問題時發生錯誤:",_),r.value="抱歉，處理您的問題時發生錯誤。請稍後再試。"}finally{i.value=!1}}async function y(){try{const _=e.value>.78?`{"retrieved_document":${JSON.stringify(t.value)},"question":"${s.value}"}. 假設你是滑鼠的銷售人員，根據retrieved_document生成回答，並提供回答，不要添加任何額外內容。`:s.value,b=await c.invoke(_);r.value=b.content,console.log("response",r)}catch(_){console.log(_==null?void 0:_.message),r.value="抱歉，生成回答時發生錯誤。請稍後再試。"}}return cn({inputValue:"",response:"",bestMatch:null}),Ch(()=>{const _=localStorage.getItem("mouseQASystemData");if(_){const b=JSON.parse(_);s.value=b.inputValue,r.value=b.response,t.value=b.bestMatch}}),vs([s,r,t],()=>{const _={inputValue:s.value,response:r.value,bestMatch:t.value};localStorage.setItem("mouseQASystemData",JSON.stringify(_))},{deep:!0}),(_,b)=>(St(),sn("div",BE,[xe("div",zE,[HE,Sm(xe("input",{id:"user-question","onUpdate:modelValue":b[0]||(b[0]=E=>s.value=E),placeholder:"例如：哪種滑鼠適合手掌較大的人？"},null,512),[[Xg,s.value]]),xe("button",{onClick:f,disabled:i.value},"提交問題",8,ZE),a.value?(St(),sn("p",VE,"請輸入問題內容才能送出")):Eo("",!0)]),i.value?(St(),sn("div",qE,KE)):(St(),sn("div",JE,[r.value?(St(),sn("div",GE,[XE,xe("p",null,Kn(r.value),1)])):Eo("",!0),t.value?(St(),sn("div",QE,[YE,xe("div",eA,[xe("h3",null,Kn(t.value.name),1),xe("p",null,[tA,Ci(" "+Kn(t.value.description),1)]),nA,xe("ul",null,[(St(!0),sn(Ht,null,Dm(t.value.features,E=>(St(),sn("li",{key:E},Kn(E),1))),128))]),xe("p",null,[rA,Ci(" "+Kn(t.value.size.join(", ")),1)]),xe("p",null,[sA,Ci(" $"+Kn(t.value.price),1)])])])):Eo("",!0)]))]))}},aA=jp(iA,[["__scopeId","data-v-d66a0509"]]),oA=n=>(xh("data-v-2357e92d"),n=n(),Oh(),n),uA={class:"home"},cA=oA(()=>xe("h1",null,"滑鼠產品問答系統",-1)),lA={__name:"HomeView",setup(n){return(e,t)=>(St(),sn("div",uA,[cA,Ye(aA)]))}},dA=jp(lA,[["__scopeId","data-v-2357e92d"]]),hA=oy({history:L_("/rag-demo/"),routes:[{path:"/",name:"home",component:dA},{path:"/about",name:"about",component:()=>hy(()=>import("./AboutView-CUqCdqnX.js"),__vite__mapDeps([0,1]))}]}),Uc=e_(cy);Uc.use(i_());Uc.use(hA);Uc.mount("#app");export{jp as _,xe as a,sn as c,St as o};
